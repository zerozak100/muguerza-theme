/*!
 * Copyright (c) 2023 Oracle and/or its affiliates.
 * All rights reserved. Oracle Digital Assistant Client Web SDK, Release: 23.8.0
 */
!function(e,factory){"object"==typeof exports&&"object"==typeof module?module.exports=factory():"function"==typeof define&&define.amd?define("WebSDK",[],factory):"object"==typeof exports?exports.WebSDK=factory():e.WebSDK=factory();e.WebSDK=factory();}(self,(function(){return function(){"use strict";var e={358:function(e,t,s){s.d(t,{a:function(){return h},b:function(){return p},c:function(){return g},d:function(){return fe},e:function(){return l},f:function(){return ee},g:function(){return c},h:function(){return T},i:function(){return u},j:function(){return n},k:function(){return i},l:function(){return m},m:function(){return b},n:function(){return r},o:function(){return E},p:function(){return A},q:function(){return _},r:function(){return I},s:function(){return le},t:function(){return ie},u:function(){return oe},v:function(){return R},w:function(){return C},x:function(){return S},y:function(){return w},z:function(){return x},A:function(){return y},B:function(){return f},C:function(){return v},D:function(){return Q},E:function(){return a},F:function(){return be},G:function(){return W},H:function(){return q},I:function(){return se},J:function(){return te}});const i={DE_DE:"de-de",EN_AU:"en-au",EN_GB:"en-gb",EN_IN:"en-in",EN_US:"en-us",ES_ES:"es-es",FR_FR:"fr-fr",HI_IN:"hi-in",IT_IT:"it-it",PT_BR:"pt-br"},o=Object.keys(i).map((e=>i[e]));function a(e){return o.indexOf(e)>=0}const n={RecognitionNotAvailable:"RecognitionNotAvailable",RecognitionNotReady:"RecognitionNotReady",RecognitionNoAPI:"RecognitionNoAPI",RecognitionProcessingFailure:"RecognitionProcessingFailure",RecognitionTooMuchSpeechTimeout:"RecognitionTooMuchSpeechTimeout",RecognitionNoSpeechTimeout:"RecognitionNoSpeechTimeout",RecognitionMultipleConnection:"RecognitionMultipleConnection"},r={TTSStart:"tts:start",TTSStop:"tts:stop"},c=Object.assign(Object.assign({},r),{Open:"open",Close:"close",Error:"error",Message:"message",MessageReceived:"message:received",MessageSent:"message:sent",State:"state"}),l={Connecting:0,Open:1,Closing:2,Closed:3};var d=s(350);const h={Primary:"primary",Danger:"danger",Default:"default"},p={Call:"call",Location:"location",Postback:"postback",Share:"share",SubmitForm:"submitForm",Url:"url",Webview:"webview"},g={Image:"image",Video:"video",Audio:"audio",File:"file"},u={Attachment:"attachment",Card:"card",Location:"location",Postback:"postback",Raw:"raw",Suggest:"suggest",Text:"text",CloseSession:"closeSession",SessionClosed:"sessionClosed",Table:"table",Form:"form",TableForm:"tableForm",Status:"status",EditForm:"editForm",FormSubmission:"formSubmission",InboundEvent:"inboundEvent",OutboundEvent:"outboundEvent",TextStream:"textStream",Command:"command"},m={Skill:"bot",User:"user"},b={Agent:"AGENT",Bot:"BOT"};function f(e){return(0,d.isObject)(e)&&"type"in e}function v(e){return f(e)&&e.type===u.Postback}function w(e){return f(e)&&(e.type===u.InboundEvent||e.type===u.OutboundEvent)}function x(e){return void 0!==e.fields}function y(e){return void 0!==e.formRows}function C(e){return void 0!==e.fields}function S(e){return void 0!==e.formRows}const k={Text:"text",Link:"link",Action:"action",Media:"media"},T=Object.assign(Object.assign({},k),{SingleSelect:"singleSelect",MultiSelect:"multiSelect",DatePicker:"datePicker",TimePicker:"timePicker",Toggle:"toggle",TextInput:"textInput",NumberInput:"numberInput"});function A(e,t){const s=function(e){const t=e.split("/")[0].toLowerCase();switch(t){case g.Audio:case g.Image:case g.Video:return t;default:return g.File}}(e);return{messagePayload:{type:u.Attachment,attachment:{type:s,url:t}}}}function I(e,t){const s={messagePayload:{text:e,type:u.Text}};return t&&(s.sdkMetadata?s.sdkMetadata.speechId=t:s.sdkMetadata={speechId:t}),s}function E(e){let t;t="label"in e?e.label:e.text||L;return{messagePayload:{text:t,postback:e.postback,type:u.Postback}}}function _(e){return{messagePayload:e}}const M="; ",L="",P=/<[^>]+>/g,D=/&#(\d+);/g,O=/&#[xX]([\da-fA-F]+);/g;function R(e,t){const s=e.messagePayload;let i=L;if(s.voice)return H(function(e){var t;const s=[null===(t=e.voice)||void 0===t?void 0:t.text];switch(e.type){case u.Card:s.push(function(e){if(!e||!e.length)return L;return e.filter((e=>e.voice)).map((e=>{var t;const s=[];return e.voice&&s.push(null===(t=e.voice)||void 0===t?void 0:t.text),s.push(U(e.actions)),s.filter(Boolean).join(M)})).filter(Boolean).join(M)}(e.cards));break;case u.Form:case u.TableForm:s.push(function(e){if(!e||!e.length)return L;return e.filter(Boolean).map((e=>e.voice&&e.voice.text)).filter(Boolean).join(M)}(e.forms))}return s.push(U(e.actions)),s.push(U(e.globalActions)),s.filter(Boolean).join(M)}(e.messagePayload));switch(s.type){case u.Attachment:i=function(e,t){return`${t[`${e.type}_${e.attachment.type}`]}`}(s,t);break;case u.Card:i=function(e,t){const s=e.cards;let i=L;if(s&&s.length){const e=t.card,o=e?e.indexOf("{0}")>=0?e:`${e} {0}`:L,a=s.length>1;i=s.filter((e=>e.title)).map(((e,t)=>{const s=[a?o.replace("{0}",`${t+1}`):L];return e.voice?s.push(e.voice.text):(s.push(e.title),s.push(e.description)),s.push(B(e.actions)),s.filter(Boolean).join(M)})).filter(Boolean).join(M)}return i}(s,t);break;case u.Location:i=function(e){const t=e.location;return`${t.title?`${t.title}${M}`:L}${t.latitude},${t.longitude}`}(s);break;case u.Text:case u.TextStream:i=s.text;break;case u.Table:i=function(e,t){return z(e.paginationInfo)+e.rows.filter((e=>e&&e.fields&&e.fields.length)).map(((e,s)=>V(e,s,t))).filter(Boolean).join(M)}(s,t);break;case u.Form:i=function(e,t){return z(e.paginationInfo)+e.forms.filter((e=>e)).map(((e,s)=>{const i=(e.title?`${e.title}: `:L)+F(e,t);return i?`${(t.itemIterator||L).replace("{0}",`${s+1}`)}: ${i}`:L})).filter(Boolean).join(M)}(s,t);break;case u.TableForm:i=function(e,t){return z(e.paginationInfo)+e.rows.filter((e=>e&&e.fields&&e.fields.length)).map(((s,i)=>V(s,i,t)+M+F(e.forms[i],t))).filter(Boolean).join(M)}(s,t);break;case u.EditForm:i=function(e){return e.errorMessage||e.title||L}(s)}return(0,d.pipe)(function(e,t){if(e.type===u.EditForm&&e.errorMessage)return t;const s=[];return s.push(e.headerText),s.push(t),s.push(B(e.actions)),s.push(e.footerText),s.push(B(e.globalActions)),s.filter(Boolean).join(M)}(s,i),H,j,$)}function B(e){return e?e.filter((e=>e.type!==p.SubmitForm)).map((e=>e.voice?e.voice.text:e.label||L)).filter(Boolean).join(M):L}function z(e){if(e&&e.totalCount>e.rangeSize){const t=e.status;return t?t+M:L}return L}function F(e,t){let s=B(e.actions);return s&&(s=M+s),x(e)?N(e.fields,t)+s:e.formRows.filter((e=>e&&e.columns.length)).map((e=>e.columns.filter((e=>e&&e.fields.length)).map((e=>N(e.fields,t))).filter(Boolean).join(M))).filter(Boolean).join(M)+s}function V(e,t,s){return`${(s.itemIterator||L).replace("{0}",`${t+1}`)}: ${N(e.fields,s)}`}function N(e,t){return e&&e.length?e.filter((e=>e)).map((e=>function(e,t){const s=e.label||L,i=s?`${s}: `:L;switch(e.displayType){case k.Text:return`${i+e.value||L}`;case k.Link:return`${i+(t.linkField||L).replace("{0}",s)}`;case k.Action:const o=e.action;return`${i+(o.voice?o.voice.text:o.label)||L}`;default:return s}}(e,t))).filter(Boolean).join(M):L}function $(e){if(e&&e.length){const t=e.replace((0,d.resetRegex)(D),((e,t)=>String.fromCharCode(t))).replace((0,d.resetRegex)(O),((e,t)=>{const s=Number.parseInt(`0x${t}`,16);return String.fromCharCode(s)}));return(0,d.removeDisplayNoneAndDecode)(t).replace((0,d.resetRegex)(P),L)}return L}function U(e){return e&&e.length?e.filter((e=>e.type!==p.SubmitForm)).map((e=>e.voice&&e.voice.text)).filter(Boolean).join(M):L}const H=e=>e.replaceAll(/([-.,?:;!]);/g,"$1"),j=e=>e.replaceAll(/\r|\n|<br\/?>/gim,M);function W(e){const t=!1;if(s=e,!(0,d.isObject)(s)||!("messagePayload"in s))return t;var s;const i=e.messagePayload;return f(i)?i.actions&&!G(i.actions)||i.globalActions&&!G(i.globalActions)?t:function(e){switch(e.type){case u.Attachment:return function(e){const t=e.attachment;return!!(t&&t.type&&t.url)}(e);case u.Card:return function(e){let t=!1;if(e.layout&&e.cards.length){t=!0;for(const t of e.cards){if(!t.title)return!1;if(t.actions&&!G(t.actions))return!1}}return t}(e);case u.CloseSession:case u.SessionClosed:return!0;case u.Location:return function(e){const t=e.location;return!!(t&&t.latitude&&t.longitude)}(e);case u.Postback:return function(e){return!!e.postback}(e);case u.Text:return function(e){return!!e.text}(e);case u.TextStream:return function(e){return"string"==typeof e.text&&!!e.streamState}(e);case u.Table:return K(e);case u.Form:return Y(e);case u.TableForm:return function(e){return K(e)&&Y(e)}(e);case u.EditForm:return function(e){const t=e.fields,s=e.formColumns,i=e.formRows;return(null==t?void 0:t.length)>0&&t.every((e=>function(e){const t=e.displayType,s=e;return t&&Object.values(T).includes(t)&&(function(e){const t=e.id;let s=!1;switch(e.displayType){case T.SingleSelect:case T.MultiSelect:s=function(e){const t=e.layoutStyle,s=e.options;return void 0!==t&&"string"==typeof t&&t.length>0&&void 0!==s&&s.length>0&&s.every((e=>function(e){const t=e.label,s=e.value;return void 0!==t&&"string"==typeof t&&t.length>0&&void 0!==s}(e)))}(e);break;case T.Toggle:s=function(e){const t=e.valueOn,s=e.valueOff;return void 0!==t&&"string"==typeof t&&t.length>0&&void 0!==s&&"string"==typeof s&&s.length>0}(e);break;case T.DatePicker:case T.TimePicker:case T.TextInput:case T.NumberInput:s=!0}return s&&void 0!==t&&t.length>0}(s)||Z(e))}(e)))&&"number"==typeof s&&s>0||(null==i?void 0:i.length)>0}(e);case u.FormSubmission:return function(e){return!!e.submittedFields}(e);case u.InboundEvent:case u.OutboundEvent:return function(e){return!!e.eventType&&!!e.eventVersion&&!!e.eventData}(e);case u.Status:return function(e){return e.type===u.Status&&"status"in e}(e);case u.Command:return function(e){return e.type===u.Command&&"command"in e}(e)}return!1}(i):t}function G(e){for(const t of e)if(!t.type||!t.label||"string"!=typeof t.label)return!1;return!0}function q(e){return(0,d.isObject)(e)&&(0,d.isObject)(e.profile)}function K(e){const t=e.headings,s=e.rows;return t&&t.length>0&&s&&s.length>0&&t.every((e=>function(e){const t=e.label;return void 0!==t&&t.length>0}(e)))&&s.every((e=>J(e)))}function Y(e){const t=e.forms;return t&&t.length>0&&t.every((e=>x(e)&&J(e)||y(e)))}function J(e){const t=e.fields;return t&&t.length>0&&t.every((e=>Z(e)))}function Z(e){return!!e.displayType&&Q(e)}const X=Object.values(k);function Q(e){return e&&X.includes(e.displayType)}const ee=Object.assign(Object.assign(Object.assign({},{ConnectionNone:"ConnectionNone",ConnectionExplicitClose:"ConnectionExplicitClose",MessageInvalid:"MessageInvalid",NetworkFailure:"NetworkFailure",NetworkOffline:"NetworkOffline",ProfileInvalid:"ProfileInvalid",TtsNotAvailable:"TtsNotAvailable",TTSNoWebAPI:"TTSNoWebAPI",SuggestionsEmptyRequest:"SuggestionsEmptyRequest",SuggestionsInvalidRequest:"SuggestionsInvalidRequest",SuggestionsTimeout:"SuggestionsTimeout",UploadBadFile:"UploadBadFile",UploadMaxSize:"UploadMaxSize",UploadNetworkFail:"UploadNetworkFail",UploadNotAvailable:"UploadNotAvailable",UploadZeroSize:"UploadZeroSize",LocationNoAPI:"LocationNoAPI",LocationNotAvailable:"LocationNotAvailable",LocationTimeout:"LocationTimeout",LocationInvalid:"LocationInvalid"}),d.AuthError),n);function te(e,t,s){e.setRequestHeader(t,s)}function se(e,t,s){e.addEventListener(t,s)}function ie(e){return Error(e)}function oe(e){return Promise.reject(ie(e))}const ae=navigator,ne=ae&&ae.geolocation,re=1e5,ce=e=>Math.round(e*re)/re;function le(){return ne?new Promise(((e,t)=>{ne.getCurrentPosition((t=>{const s=t.coords,i=Object.assign(Object.assign({},s),{latitude:ce(s.latitude),longitude:ce(s.longitude)});e(i)}),(e=>{let s;switch(e.code){case e.POSITION_UNAVAILABLE:s=ee.LocationNotAvailable;break;case e.TIMEOUT:s=ee.LocationTimeout;break;case e.PERMISSION_DENIED:default:s=ee.LocationNoAPI}t(ie(s))}),{enableHighAccuracy:!0,timeout:5e3})})):oe(ee.LocationNoAPI)}function de(e){return"number"==typeof e}function he(e,t,s){return e>=t&&e<=s}const pe=-90,ge=90,ue=-180,me=180;function be(e){const{latitude:t,longitude:s}=e;return de(t)&&de(s)&&he(t,pe,ge)&&he(s,ue,me)}class fe{constructor(e){this.dispatcher=e,this.state=l.Closed}getState(){return this.state}isOpen(){return this.state===l.Open}isClosed(){return this.state===l.Closed}on(e,t){this.dispatcher.bind(e,t)}off(e,t){this.dispatcher.unbind(e,t)}setState(e){this.state=e,this.dispatcher.trigger(c.State,e)}}},756:function(e,t,s){s.r(t),s.d(t,{ActionType:function(){return o.b},AttachmentType:function(){return o.c},ConnectionState:function(){return o.e},CoreError:function(){return o.f},CoreEvent:function(){return o.g},CoreTTS:function(){return Ae},DisplayType:function(){return o.h},FILE_TYPES:function(){return Te},MAX_MB:function(){return Ce},MessageType:function(){return o.i},RecognitionLocale:function(){return o.k},SenderType:function(){return o.l},SkillMessageSource:function(){return o.m},SpeechSynthesisServiceEvent:function(){return o.n},WebCore:function(){return Ee},buildPostbackMessage:function(){return o.o},buildUserAttachmentMessage:function(){return o.p},buildUserMessage:function(){return o.q},buildUserTextMessage:function(){return o.r},getCurrentPosition:function(){return o.s},getError:function(){return o.t},getRejectPromiseError:function(){return o.u},getUtteranceText:function(){return o.v},isEditFormPayloadWithFields:function(){return o.w},isEditFormPayloadWithRows:function(){return o.x},isFormEntityWithFields:function(){return o.z},isFormEntityWithRows:function(){return o.A},isMessagePayload:function(){return o.B},isPostbackPayload:function(){return o.C},isValidLocale:function(){return o.E},isValidLocation:function(){return o.F},isValidMessage:function(){return o.G},isValidProfileMessage:function(){return o.H}});var i=s(350),o=s(358);let a=1,n=1,r=1;const c=window,l=c.addEventListener,d=c.speechSynthesis,h=c.SpeechSynthesisUtterance,p=c.navigator,g=clearTimeout;class u{constructor(){if(this.isActive=!1,this.dispatcher=(0,i.generateEventDispatcher)(),!c||!d||!h)throw Error("TTSNoWebAPI");w().then((e=>{this._voice=e})),l("beforeunload",(e=>{d.cancel(),g(this._pauser),delete e.returnValue})),l("click",(()=>{d&&(d.cancel(),d.resume(),d.speak(new h(" ")))}),{once:!0})}speak(e){if(this._voice){const t=new h(e);t.voice=this._voice,t.pitch=a,t.rate=n,t.volume=r,d.paused&&d.resume(),this.isActive||(this.isActive=!0,this.dispatcher.trigger(o.n.TTSStart)),d.speak(t),this._voice.localService||(g(this._pauser),y((e=>this._pauser=e)))}}cancel(){d.speaking&&(d.cancel(),g(this._pauser))}getVoices(){return m()}setVoice(e){return function(e){const t=e.map((e=>Object.assign({lang:"",name:""},e)));return m().then((e=>{for(const s of t)for(const t of e)if(C(s.lang,t.lang)&&C(s.name,t.name))return t;for(const s of t)for(const t of e)if(C(s.lang,t.lang))return t;for(const s of t)for(const t of e)if(t.lang.indexOf(s.lang)>=0)return t;return w()}))}(e).then((e=>{this._voice=e,a=e.pitch||1,n=e.rate||1,r=e.volume||1}))}getVoice(){return this._voice}on(e,t){this.dispatcher.bind(e,t)}off(e,t){this.dispatcher.unbind(e,t)}}function m(){return new Promise((e=>{b(e),d.addEventListener("voiceschanged",(()=>{b(e)}))}))}function b(e){const t=d.getVoices();if(t.length){e(function(e){if(!Array.isArray(e))return e._list;return e}(v(t)))}}const f=["Albert","Bad News","Bahh","Bells","Boing","Bubbles","Cellos","Good News","Jester","Organ","Superstar","Trinoids","Whisper","Wobble","Zarvox"],v=e=>e.filter((e=>f.indexOf(e.name)<0));function w(){return m().then((e=>{let t;const s=e.filter((e=>e.default));if(1===s.length&&(t=s[0]),!t){const s=p&&p.language;s&&(t=e.find((e=>C(e.lang,s))))}if(!t){const s=p&&p.language.substring(0,2);s&&(t=e.find((e=>S(e.lang).indexOf(s)>=0)))}return t||(t=e[0]),t}))}const x=1e4;function y(e){const t=c.setTimeout((()=>{d.speaking&&(d.pause(),d.resume(),y(e))}),x);e(t)}function C(e,t){return S(e)===S(t)}const S=e=>e.toLowerCase(),k={DEFAULT:0,VOICE_RECOGNITION:6},T=window.audioinput;function A(){return T}function I(e){return new Promise(((e,t)=>{const s=A();s.checkMicrophonePermission((i=>{i?e():s.getMicrophonePermission(((s,i)=>{s?e():t(i)}))}))})).then((()=>{const t=A();return t.start(e),t}))}function E(){return new Promise((e=>{const t=A();t.isCapturing()?(t.stop(e),t.disconnect()):e()}))}let _=window.AudioContext;const M=window.navigator;let L=M.mediaDevices;const P=M.webkitGetUserMedia,D=M.mozGetUserMedia,O=!!(L&&L.getUserMedia||P||D);var R=function(e,t,s,i){return new(s||(s=Promise))((function(o,a){function n(e){try{c(i.next(e))}catch(e){a(e)}}function r(e){try{c(i.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(n,r)}c((i=i.apply(e,t||[])).next())}))};const B=4096,z=48e3;let F,V=!0;class N{static getInstance(){return this._service||(this._service=new N),this._service}constructor(){this._streamBuffer=[],this._isRecording=!1,_=_||window.webkitAudioContext,O&&(void 0===L&&(L={}),void 0===L.getUserMedia&&(L.getUserMedia=e=>{const t=P||D;if(!t){const e=Error("getUserMedia is not implemented in this browser");return e.name="TypeError",Promise.reject(e)}return new Promise(((s,i)=>{t.call(navigator,e,s,i)}))}))}startRecognition(e){var t,s;return this._startPromise=new i.Deferred,e&&(this._onRecognitionText=e.onRecognitionText,this._onAnalyserReady=e.onAnalyserReady,this._onVisualData=e.onVisualData,this._onSpeechNetworkChange=e.onSpeechNetworkChange),(null===(t=this._connection)||void 0===t?void 0:t.readyState)===o.e.Closing||(null===(s=this._connection)||void 0===s?void 0:s.readyState)===o.e.Connecting?Promise.reject(new Error(o.j.RecognitionMultipleConnection)):(this._isRecording?this._startPromise.resolve():this._url?this._setupRecognition():this._buildServerURL().then((()=>this._setupRecognition())),this._startPromise.promise)}stopRecognition(){return this._stopPromise=new i.Deferred,this._isRecording?this._stopProcessing():this._stopPromise.resolve(),this._stopPromise.promise}setConfig(e){return e.recognitionLocale||(e.recognitionLocale=o.k.EN_US),e.tokenGenerator&&(this._authService=i.AuthTokenService.getInstance()),this._config=e,this._buildServerURL()}setLocale(e){(0,o.E)(e)&&this._config&&(this._config.recognitionLocale=e,this._buildServerURL())}_setConnectionState(e){var t;null===(t=this._onSpeechNetworkChange)||void 0===t||t.call(this,e)}_buildServerURL(){return(e=this._config,t=this._authService,new Promise(((s,i)=>{e.tokenGenerator?t.get().then((t=>{e.channelId=t.getClaim("channelId"),e.userId=t.getClaim("userId"),H(e,s,i)})).catch((e=>i(e))):H(e,s,i)}))).then((e=>{this._url=e}));var e,t}_setupRecognition(){return new Promise(((e,t)=>{O?function(e,t){navigator.mediaDevices.getUserMedia({audio:!0}).then((t=>{const s=new AudioContext;e({context:s,stream:s.createMediaStreamSource(t)})})).catch((()=>{t(Error(o.j.RecognitionNoAPI))}))}(e,t):void 0!==A()?function(e,t){E().then((()=>I({audioSourceType:k.VOICE_RECOGNITION,bufferSize:B,streamToWebAudio:!0}).then((t=>{e({context:A().getAudioContext(),stream:t})})))).catch((()=>{t(Error(o.j.RecognitionNoAPI))}))}(e,t):t(Error(o.j.RecognitionNoAPI))})).then((e=>{let t;this._streamBuffer=[],F=new Float32Array(0),this._connection=this._getSpeechServerConnection(this._url),function(e,t,s){return R(this,void 0,void 0,(function*(){const i=e.createAnalyser();i.smoothingTimeConstant=.8,i.fftSize=256;const o=`class RecorderProcessor extends AudioWorkletProcessor {\n        buffersize = ${B};\n\n        // Track the current buffer fill level\n        _bytesWritten = 0;\n\n        // Create  a buffer of fixed size\n        _buffer = new Float32Array(this.buffersize);\n\n        constructor() {\n            super();\n            this.initBuffer();\n        }\n\n        initBuffer() {\n            this._bytesWritten = 0;\n        }\n\n        isBufferEmpty() {\n            return this._bytesWritten === 0;\n        }\n\n        isBufferFull() {\n            return this._bytesWritten === this.buffersize;\n        }\n\n        flush() {\n            // trim the buffer if ended prematurely\n            this.port.postMessage(\n                this._bytesWritten < this.buffersize ? this._buffer.slice(0, this._bytesWritten) : this._buffer\n            );\n            this.initBuffer();\n        }\n\n        process(inputs) {\n            this.append(inputs[0][0]);\n\n            return true;\n        }\n\n        /**\n         *\n         * @param {Float32Array} channelData\n         * @returns\n         */\n        append(channelData) {\n            if (this.isBufferFull()) {\n                this.flush();\n            }\n\n            if (!channelData) return;\n\n            for (let i = 0; i < channelData.length; i++) {\n                this._buffer[this._bytesWritten++] = channelData[i];\n            }\n        }\n    }\n\n    registerProcessor('recorder.worklet', RecorderProcessor);`,a=URL.createObjectURL(new Blob([o],{type:"application/javascript"}));yield e.audioWorklet.addModule(a);const n=new AudioWorkletNode(e,"recorder.worklet");return URL.revokeObjectURL(a),t.connect(i),i.connect(n),n.connect(e.destination),n.port.onmessage=s,{analyser:i,processor:n}}))}(e.context,e.stream,this._onPortMessage.bind(this)).then((s=>{t=s,this._onAnalyserReady&&this._onAnalyserReady(t.analyser),this._context=e.context,this._stream=e.stream,this._analyser=t.analyser,this._audioWorklet=t.processor}))})).catch((e=>{this._startPromise&&this._startPromise.reject(e)}))}_getSpeechServerConnection(e){const t=new WebSocket(e);return t.onopen=this._onOpen.bind(this),t.onclose=this._onClose.bind(this),t.onmessage=this._onMessage.bind(this),t.onerror=this._onError.bind(this),t}_onOpen(){this._config.tokenGenerator?this._authService.get().then((e=>{this._connection.send(`Bearer ${e.token}`),this._setConnectionState(o.e.Open),this._sendPreConnectionBuffer()})):(this._setConnectionState(o.e.Open),this._sendPreConnectionBuffer())}_onClose(){this._isRecording&&this._stopProcessing(),this._stopPromise&&(this._stopPromise.resolve(),this._stopPromise=void 0),this._setConnectionState(o.e.Closed)}_onMessage(e){try{const t=JSON.parse(e.data);if(!t.event&&t.code)throw e;const s=function(e){let t,s;const i=e.requestId,a=e.nbest;"partialResult"===e.event?(t="partial",s=a[0].utterance):a&&a.length?(t="final",s=a[0].utterance):(t="error",s=e.resultCode?o.j.RecognitionTooMuchSpeechTimeout:o.j.RecognitionNoSpeechTimeout);return{requestId:i,type:t,text:s,message:e}}(t);"finalResult"===t.event&&this.stopRecognition(),this._onRecognitionText&&this._onRecognitionText(s)}catch(e){this._notifyError(o.j.RecognitionProcessingFailure),this.stopRecognition()}}_onError(){this._connection.readyState===o.e.Open&&(this._notifyError(o.j.RecognitionProcessingFailure),this._connection.close())}_notifyError(e){this._onRecognitionText&&this._onRecognitionText({requestId:"",text:e,type:"error"})}_onPortMessage(e){var t;this._startPromise&&(this._isRecording=!0,this._startPromise.resolve(),this._startPromise=void 0);const s=e.data,i=(null===(t=this._context)||void 0===t?void 0:t.sampleRate)||z;try{const e=function(e,t,s){if(s===t)return e;if(s>t)throw Error();let i=[];if(t===z)i=j;else{if(44100!==t)throw Error();i=W}const o=t/s;let a,n,r;V?(a=Math.floor(e.length%o),n=e.length-a,r=0===a?Array.from(e):e.slice(0,n)):(a=Math.floor((e.length+F.length-i.length)%o),n=e.length+F.length-i.length-a,r=new Float32Array(F.length+n),r.set(F),r.set(e.slice(0,n),F.length));const c=Math.floor(n/o),l=new Int16Array(c),d=-1,h=32767;if(t===z)for(let e=i.length;e<r.length;e+=o){let t=0;for(let s=0;s<i.length;s++)t+=r[e-s]*i[s];const s=Math.max(Math.min(t,1),d)*h;l[(e-i.length)/o]=s}else{const e=[];for(let t=i.length;t<r.length;t++){let s=0;for(let e=0;e<i.length;e++)s+=r[t-e]*i[e];e[t-i.length]=s}for(let t=0;t<c;t++){const s=3,i=t*o,a=Math.floor(i)-s+1,n=Math.floor(i)+s;let r=0;for(let t=a;t<=n;t++){r+=(t<0?e[0]:t>=e.length?e[e.length-1]:e[t])*G(s,i-t)}l[t]=Math.max(Math.min(r,1),d)*h}}F=V?e.slice(n-i.length-F.length):e.slice(n-i.length-(F.length-i.length));return V=!1,l.buffer}(s,i,16e3);this._onVisualData&&this._processAnalyser(this._analyser),this._sendBuffer(e)}catch(e){this._notifyError(o.j.RecognitionProcessingFailure),this.stopRecognition()}}_processAnalyser(e){if(e){const t=new Uint8Array(e.frequencyBinCount);e.getByteFrequencyData(t),this._onVisualData&&this._onVisualData(t)}}_sendBuffer(e){this._connection.readyState!==o.e.Open||this._streamBuffer.length?this._streamBuffer.push(e):this._connection.send(e)}_sendPreConnectionBuffer(){if(this._connection.readyState===o.e.Open)for(;this._streamBuffer.length;){const e=this._streamBuffer.shift();e&&this._connection.send(e)}}_stopProcessing(){this._isRecording=!1,this._connection&&(this._connection.readyState===o.e.Open&&(this._connection.send("Done"),this._connection.close()),this._audioWorklet&&this._audioWorklet.disconnect(),this._analyser&&this._analyser.disconnect(),A()?E():function(e,t){t&&(t.mediaStream&&t.mediaStream.getAudioTracks().forEach((e=>{e.stop()})),t.disconnect());e&&e.close()}(this._context,this._stream),this._audioWorklet=void 0,this._analyser=void 0,this._stream=void 0,this._context=void 0,this._streamBuffer=[],V=!0,F=new Float32Array(0))}}const $="/voice/stream/recognize",U="generic";function H(e,t,s){e.channelId&&e.userId||s(Error(o.j.RecognitionNotReady)),t(function(e){const t=`ws${e.isTLS?"s":""}://`,s=`${$}/${e.recognitionLocale}/${U}`,o={channelId:e.channelId||"",encoding:"audio/raw",userId:e.userId||""};e.tokenGenerator&&(o.jwtInBody="true");return(0,i.buildURL)(t,e.URI,o,s)}(e))}const j=[-25033838264794034e-21,-3645156113737857e-20,-11489993827892933e-21,393243788874656e-19,6998419352067277e-20,37556691270439976e-21,-476966455345305e-19,-.00011379935461751734,-8400957697117619e-20,4208817777607469e-20,.00016391587447478332,.00015508372993570357,-1253765788919669e-20,-.00021258262011091092,-.0002524059896175195,-51874329668708116e-21,.0002479230009768214,.00037351534477673157,.00016157590781788105,-.0002541085239198603,-.000510486865332593,-.0003246104617540939,.00021219136947965464,.0006488877825604561,.0005444416935293036,-.0001016639071691704,-.0007673001147209819,-.0008176720912938691,-972696982411551e-19,.0008376185852528038,.0011319450250252222,.0004008193339799052,-.0008262743020160207,-.0014643282305934196,-.0008183365045047033,.0006964471772153777,.001780467922489105,.0013489288090360295,-.00041122152287042,-.0020347535966250413,-.0019782994815083733,-6247794246099269e-20,.002171643809964705,.0026761621389245617,.00074944268608935,-.00212817775887288,-.003394541347147186,-.0016615884301227524,.001837545335885159,.004067170702246546,.0027936171643976352,-.001233420727213658,-.004610035314537476,-.004119319153202972,.00025459137646049936,.00492286494534436,.005588805700369816,.001150762425755883,-.004891042781491068,-.0071267634777626675,-.003021979039818941,.00438688631315642,.008631467181982988,.005385139236634672,-.003268406079325266,-.009973661255235284,-.008256256502745316,.0013719935383757782,.010993210336541666,.011651337116264694,.0015082475865128093,-.01148872195209017,-.015609515327517686,-.005671504441670989,.011188303272599716,.02024519058502148,.011637590928971467,-.009667754909210324,-.025878090076785515,-.020500381603699786,.006098908137700642,.033428666116203716,.03513487017573178,.001719739622764723,-.046085580848361105,-.06623078150315037,-.023349941728869696,.08292213207159124,.21069217442624302,.2973829711397418,.2973829711397419,.21069217442624305,.08292213207159124,-.023349941728869693,-.06623078150315037,-.046085580848361105,.0017197396227647225,.03513487017573178,.033428666116203716,.006098908137700641,-.020500381603699783,-.025878090076785508,-.009667754909210326,.011637590928971469,.020245190585021472,.011188303272599716,-.00567150444167099,-.015609515327517682,-.01148872195209017,.001508247586512809,.011651337116264699,.010993210336541666,.0013719935383757782,-.008256256502745314,-.009973661255235283,-.0032684060793252657,.00538513923663467,.008631467181982988,.004386886313156419,-.0030219790398189413,-.0071267634777626675,-.0048910427814910715,.0011507624257558842,.005588805700369813,.00492286494534436,.00025459137646049936,-.004119319153202973,-.004610035314537475,-.0012334207272136583,.002793617164397636,.004067170702246546,.0018375453358851592,-.0016615884301227509,-.0033945413471471847,-.0021281777588728797,.0007494426860893505,.0026761621389245612,.0021716438099647056,-6247794246099253e-20,-.001978299481508373,-.0020347535966250404,-.00041122152287042,.0013489288090360292,.0017804679224891048,.0006964471772153777,-.0008183365045047026,-.00146432823059342,-.0008262743020160207,.0004008193339799063,.0011319450250252222,.0008376185852528037,-9726969824115494e-20,-.0008176720912938694,-.0007673001147209783,-.00010166390716916983,.0005444416935293033,.0006488877825604562,.0002121913694796546,-.00032461046175409424,-.000510486865332593,-.00025410852391986036,.0001615759078178811,.0003735153447767315,.00024792300097682137,-5187432966870808e-20,-.0002524059896175194,-.00021258262011091095,-1253765788919669e-20,.0001550837299357036,.0001639158744747833,42088177776074685e-21,-8400957697117623e-20,-.00011379935461751733,-4769664553453051e-20,3755669127044002e-20,699841935206728e-19,393243788874656e-19,-11489993827892933e-21,-3645156113737856e-20,-2503383826479402e-20],W=[-5044267067893139e-21,5738740247594612e-21,1611195555688156e-20,10560179594562795e-21,-1242816862904201e-20,-3084430704328611e-20,-18160396924882423e-21,2303124169528074e-20,5216612702894834e-20,2806026886746509e-20,-389608521587068e-19,-8174245278012476e-20,-4037543061985353e-20,619375276294956e-19,.00012143092661620545,55083199655424166e-21,-9401891583478883e-20,-.00017326981522755043,-7198069055926206e-20,.0001376274218691789,.00023946132645647525,9064030545698025e-20,-.00019557611633250834,-.0003223511502826996,-.00011036322783022617,.0002710935667931249,.00042440564349633953,.00013013140955365376,-.00036784896615780913,-.0005481886438481025,-.00014855826094166272,.0004899798946967381,.000696340560985472,.00016383778624615643,-.0006421263408051642,-.0008715631880363658,-.00017369118859371453,.000829476349448821,.0010766146787146871,.00017530890385814463,-.0010578310750603923,-.001314320458073489,-.0001652844648711556,.0013337004262191077,.0015876076783199174,.000139534308084411,-.0016644454627712116,-.001899573527380014,-9319422024995832e-20,.002058491185395933,.0022536018141979036,20477911370491685e-21,-.0025256449668619525,-.0026535487754524955,8552498376473957e-20,.0030775744811722015,.0031040297261921,-.00023314744969763122,-.003728529808331677,-.003610856230113392,.000432598472497653,.0044964472481822506,.004181705019767344,-.0006966685466235378,-.005404666489478738,-.00482715710731867,.0010418556659416306,.006484667519607787,.00556235368742558,-.0014902159613265254,-.007780573986407925,-.0064097301786953595,.002072517010858728,.009356870546119134,.0074037416266333166,-.00283386009764953,-.011312323822665827,-.008599512596140524,.003844300507349054,.013806774337071994,.01008985372973804,-.005220460312862638,-.01711716324115331,-.01204196749753927,.007174046245357611,.021768247992024713,.01478690833035584,-.010136389804721707,-.02888735624896028,-.019078400739739057,.015146805312378952,.041410446665863104,.027068163980255515,-.025512027260482153,-.07011218378743589,-.04829678433503421,.06041368701604651,.21199607414538668,.3213532652447261,.3213532652447261,.21199607414538668,.060413687016046526,-.04829678433503422,-.07011218378743589,-.025512027260482153,.027068163980255515,.041410446665863104,.015146805312378952,-.019078400739739057,-.02888735624896028,-.010136389804721703,.01478690833035584,.021768247992024713,.007174046245357611,-.01204196749753927,-.01711716324115331,-.005220460312862639,.010089853729738038,.013806774337071994,.0038443005073490553,-.008599512596140524,-.011312323822665827,-.0028338600976495314,.007403741626633317,.009356870546119134,.002072517010858727,-.006409730178695359,-.007780573986407925,-.001490215961326526,.005562353687425577,.006484667519607787,.0010418556659416256,-.004827157107318673,-.005404666489478739,-.0006966685466235378,.004181705019767345,.004496447248182251,.0004325984724976533,-.003610856230113392,-.003728529808331677,-.0002331474496976315,.0031040297261921003,.003077574481172201,8552498376473897e-20,-.002653548775452496,-.002525644966861952,2047791137049164e-20,.002253601814197904,.002058491185395933,-9319422024995909e-20,-.001899573527380014,-.0016644454627712118,.00013953430808441038,.0015876076783199174,.0013337004262191077,-.0001652844648711556,-.0013143204580734896,-.0010578310750603925,.00017530890385814333,.0010766146787146878,.0008294763494488195,-.00017369118859371463,-.00087156318803637,-.0006421263408051633,.00016383778624615698,.0006963405609854716,.0004899798946967381,-.00014855826094166245,-.0005481886438481027,-.00036784896615780924,.00013013140955365368,.00042440564349633964,.00027109356679312505,-.00011036322783022619,-.0003223511502826996,-.00019557611633250842,9064030545698017e-20,.00023946132645647525,.00013762742186917883,-7198069055926207e-20,-.0001732698152275505,-9401891583478886e-20,5508319965542416e-20,.00012143092661620549,6193752762949557e-20,-4037543061985352e-20,-8174245278012477e-20,-38960852158706805e-21,28060268867465078e-21,52166127028948336e-21,2303124169528077e-20,-18160396924882423e-21,-30844307043286126e-21,-12428168629042018e-21,10560179594562806e-21,1611195555688157e-20,5738740247594605e-21,-5044267067893138e-21];function G(e,t){let s;if(0===t)s=1;else if(t>=e||t<=-e)s=0;else{const i=Math.PI*t;s=e*Math.sin(i)*Math.sin(i/e)/(i*i)}return s}const q="ended";const K=(e,t)=>{const s=Y(t),i=new Float32Array(e.length+s.length);return i.set(e,0),i.set(s,e.length),i},Y=e=>Float32Array.from(new Int16Array(e),(e=>e/32768)),J="speak",Z="channelId",X="userId",Q="https://",ee=/<[\w]+/g,te=J;class se{constructor(e){this.host="",this.voices=[],this.waveHeader=!1,this.isActive=!1,this.aborter=new AbortController,this.dispatcher=(0,i.generateEventDispatcher)(),this.config=e=>{this.params=e,this.host=`${e.URI}/tts/`,e.tokenGenerator&&(this.authService=i.AuthTokenService.getInstance())},this.loadTTS=e=>{let t=e;e.match(ee)&&(t=`<${te}>${e}</${te}>`);const s=Object.assign({text:encodeURIComponent(t),stream:"chunked"},this.voice&&{voice:this.voice.name});return this.getURL(J,s).then((e=>this.getResponse(e)))},this.getURL=(e,t={})=>{const s=this.params;if(s){if(s.tokenGenerator)return this.authService.get().then((s=>(t[Z]=s.getClaim(Z),t[X]=s.getClaim(X),Promise.resolve((0,i.buildURL)(Q,this.host,t,e)))));t[Z]=s.channelId,t[X]=s.userId}return Promise.resolve((0,i.buildURL)(Q,this.host,t,e))},this.getResponse=(e,t=!0)=>new Promise(((s,i)=>{const o=this.params,a=t?this.aborter.signal:void 0;o&&o.tokenGenerator?this.authService.get().then((t=>{fetch(e,{signal:a,headers:{Authorization:`Bearer ${t.token}`}}).then(s,i)})):fetch(e,{signal:a}).then(s,i)})),this.streamAudio=e=>{if(e&&e.body){const t=e.body.getReader();this.resetChunkProcessor(),this.isActive||(this.isActive=!0,this.dispatcher.trigger(o.n.TTSStart)),this.streamChunk(t)}},this.streamChunk=e=>{e.read().then((({done:t,value:s})=>{if(t)return void this.ttsQueue.next();let i=s.buffer;if(this.waveHeader||(this.waveHeader=!0,ne(i,this.player),i=ae(i)),void 0!==this.oddByte){const e=new Uint8Array(i),t=new Uint8Array(e.length+1);t[0]=this.oddByte,t.set(e,1),i=oe(t),this.oddByte=void 0}if(i.byteLength%2){const e=new Uint8Array(i),t=new Uint8Array(e.length-1);t.set(e.slice(0,e.length-1)),i=oe(t),this.oddByte=e[e.length-1]}this.player.play(i),this.streamChunk(e)})).catch((()=>{this.ttsQueue.next()}))},this.resetChunkProcessor=()=>{this.waveHeader=!1,this.oddByte=void 0},this.setInactive=()=>{this.isActive&&(this.isActive=!1,this.dispatcher.trigger(o.n.TTSStop))},this.config(e),this.ttsQueue=ie(this.streamAudio,(()=>{})),this.player=function(){let e,t,s,i=()=>{},o={sampleRate:22050,numChannels:1},a=0,n=!0;const r=()=>{if(!e||!s.length)return;if(n&&s.length<4096)return void(n=!1);n=!1;const i=s.length,r=new AudioBuffer({sampleRate:o.sampleRate,length:i});for(let e=0;e<o.numChannels;e++){const t=r.getChannelData(e);for(let e=0;e<i;e++)t[e]=s[e]}a<e.currentTime&&(a=e.currentTime),t&&t.removeEventListener(q,c),t=new AudioBufferSourceNode(e,{buffer:r}),t.connect(e.destination),t.start(a),t.addEventListener(q,c),a+=r.duration,s=new Float32Array},c=()=>{a=0,setTimeout((()=>{a||(n=!0,i())}),250)};return(()=>{const t=document.body,s=["touchend","click"];let i=!0;const o=()=>{i&&(e=new AudioContext,"suspended"!==e.state?a():e.resume().then((()=>{a()})))},a=()=>{s.forEach((e=>{t.removeEventListener(e,o),i=!1}))};s.forEach((e=>{t.addEventListener(e,o)}))})(),{play:t=>{e||(e=new AudioContext),s=s?K(s,t):Y(t),r()},stop:()=>{e&&(t&&t.stop(),s=new Float32Array,e.close(),e=void 0,n=!0,a=0,i())},config:e=>{o=Object.assign(Object.assign({},o),e)},onEnd:e=>{i=e}}}(),this.player.onEnd(this.setInactive),this.getVoices().then((e=>{this.voice=e.filter((e=>e.default))[0]})),window.addEventListener("beforeunload",(()=>{this.cancel()}))}speak(e){"string"==typeof e&&e.trim().length&&this.ttsQueue.push(this.loadTTS(e))}cancel(){this.isActive&&(this.aborter.abort(),this.player.stop(),this.ttsQueue.cancel(),this.aborter=new AbortController)}getVoices(){let e=this.voices;if(e.length)return Promise.resolve(e);const t=()=>{this.voicesPromise=void 0};return this.voicesPromise||(this.voicesPromise=this.getURL("voices").then((e=>this.getResponse(e,!1))).then((e=>e.json())).then((s=>{const i=s.voices||[];return e=i.map((e=>({name:e.name,lang:e.culture,default:!!e.default}))),setTimeout(t),this.voices=e,e})).catch((()=>(setTimeout(t),e)))),this.voicesPromise}getVoice(){return this.voice}setVoice(e){return e&&Array.isArray(e)&&e.length?this.voice&&1===e.length&&!e[0].name&&ce(e[0].lang)===ce(this.voice.lang)?Promise.resolve():this.getVoices().then((t=>{if(!t.length)return Promise.reject(Error("TTSNoVoices"));return e.find((e=>{let s,i=!1;if(e.name&&(s=t.find((t=>ce(e.name)===ce(t.name)))),!s&&e.lang){const i=t.filter((t=>ce(e.lang)===ce(t.lang)));s=i.find((e=>e.default))||i[0]}return s&&(this.voice=s,i=!0),i}))?Promise.resolve():Promise.reject(Error("TTSNoMatch"))})):Promise.reject(Error("TTSEmptyParam"))}on(e,t){this.dispatcher.bind(e,t)}off(e,t){this.dispatcher.unbind(e,t)}}const ie=(e,t)=>{const s=[],i=()=>{s.length&&s[0].then(e).catch(t)};return{push:e=>{e.catch((()=>{const t=s.indexOf(e);t>0&&s.splice(t,1)})),s.push(e),1===s.length&&i()},cancel:()=>{s.length=0},next:()=>{s.shift(),i()}}},oe=e=>e.buffer.slice(e.byteOffset,e.byteLength+e.byteOffset),ae=e=>{const t=new Uint8Array(e),s=new Uint8Array(t.length-44);return s.set(t.slice(44,t.length)),oe(s)},ne=(e,t)=>{const s=re(e),i=Array.from(s.slice(22,24)).reverse(),o=Array.from(s.slice(24,28)).reverse(),a=parseInt(i.join(""),16),n=parseInt(o.map((e=>e.toString(16))).join(""),16);t.config({numChannels:a,sampleRate:n})},re=e=>{const t=new Uint8Array(e),s=new Uint8Array(44);return s.set(t.slice(0,44)),s},ce=e=>e.toLowerCase(),le={Auth:"auth",Ping:"ping",Pong:"pong"},de="jwt";const he={state:{type:le.Ping}};class pe extends o.d{constructor(e){super(e.dispatcher),this.url=e.url,this.authService=e.authService}open(){return this.isOpen()?Promise.resolve():navigator.onLine?this.connect():(0,o.u)(o.f.NetworkOffline)}close(){return this.isClosed()?Promise.resolve():this.disconnect()}send(e){return new Promise(((t,s)=>{if(this.isOpen()){const i=new XMLHttpRequest;i.open("POST",this.url),(0,o.J)(i,"Content-Type","application/json"),i.onload=()=>{i.status>=200&&i.status<300?t(e):s(i.response)},i.onerror=()=>{s((0,o.t)(o.f.NetworkFailure))},this.sendRequest(i,JSON.stringify(e)).catch(s)}else s((0,o.t)(o.f.ConnectionNone))}))}updateConnectionUrl(e){this.url=(0,i.getLongPollURL)(e.URI,{channelId:e.channelId,userId:e.userId},e.isTLS)}connect(){return this.openPromise||(this.openPromise=new i.Deferred,this.setState(o.e.Connecting),this.openConnection().then((()=>{this.onOpen(),this.poll()})).catch((e=>{this.openPromise&&(this.openPromise.reject(e),this.openPromise=null),this.onClose()}))),this.openPromise.promise}disconnect(){return this.closePromise||(this.xhr.abort(),this.closePromise=new i.Deferred,this.setState(o.e.Closing),setTimeout((()=>{this.onClose()}),100)),this.closePromise.promise}openConnection(){return new Promise(((e,t)=>{const s=new XMLHttpRequest;s.open("POST",this.url),(0,o.J)(s,"Content-Type","application/json"),s.onload=()=>{s.status>=200&&s.status<300?e():t(s.response)},s.onerror=()=>{t((0,o.t)(o.f.NetworkFailure))},this.sendRequest(s,JSON.stringify(he)).catch((e=>{t(e)}))}))}poll(){let e=0;this.isOpen()&&(this.xhr=new XMLHttpRequest,this.xhr.open("GET",this.url),this.xhr.onload=()=>{e=0,this.xhr.status&&200===this.xhr.status&&this.onMessages(this.xhr.responseText),this.poll()},this.xhr.onerror=()=>{5===e?this.close():(e++,this.poll())},this.sendRequest(this.xhr))}sendRequest(e,t){return this.authService?new Promise(((s,i)=>{var a;null===(a=this.authService)||void 0===a||a.get().then((i=>{(0,o.J)(e,"Authorization",`Bearer ${i.token}`),e.send(t),s()})).catch((e=>{i(e)}))})):(e.send(t),Promise.resolve())}onMessages(e){try{JSON.parse(e).forEach((e=>{this.onMessage(JSON.parse(e))}))}catch(e){this.onError(e)}}onOpen(){this.openPromise&&(this.openPromise.resolve(),this.openPromise=null),this.closePromise&&(this.closePromise.reject(),this.closePromise=null),this.setState(o.e.Open),this.dispatcher.trigger(o.g.Open)}onClose(){this.closePromise&&(this.closePromise.resolve(),this.closePromise=null),this.openPromise=null,this.setState(o.e.Closed),this.dispatcher.trigger(o.g.Close)}onMessage(e){we(e),this.dispatcher.trigger(o.g.Message,e),this.dispatcher.trigger(o.g.MessageReceived,e)}onError(e){this.dispatcher.trigger(o.g.Error,e)}}const ge=Promise,ue=3e6,me=window;class be extends o.d{constructor(e){super(e.dispatcher),this.isExplicitClose=!1,this.isHeartBeatAlive=!1,this.isTokenValid=!1,this.retryAttempt=0,this.reconnectAttempted=!1,this.ws=null,this.url=e.url,this.authService=e.authService,this.retryInterval=e.retryInterval,this.retryMaxAttempts=e.retryMaxAttempts}open(){return this.isOpen()?ge.resolve():navigator.onLine?this.connect():(0,o.u)(o.f.NetworkOffline)}close(){return this.isExplicitClose=!0,clearTimeout(this.retryMonitor),this.isClosed()?ge.resolve():this.disconnect()}send(e){return new ge(((t,s)=>{if(this.ws&&this.isOpen()){this.isTokenValid=!0;try{this.ws.send(JSON.stringify(e)),t(e),(i=e).state&&i.state.type&&i.state.type===le.Ping||(this.dispatcher.trigger(o.g.Message,e),this.dispatcher.trigger(o.g.MessageSent,e))}catch(e){s((0,o.t)(o.f.NetworkFailure))}}else s((0,o.t)(o.f.ConnectionNone));var i}))}updateConnectionUrl(e){this.url=(0,i.getWebSocketURL)(e.URI,{channelId:e.channelId,userId:e.userId},e.isTLS,e.channel)}setSuggestionPromise(e){this.suggestionPromise=e}connect(){return this.openPromise||(this.openPromise=new i.Deferred,this.setState(o.e.Connecting),this.openConnection()),this.openPromise.promise}disconnect(){var e;return this.closePromise||(null===(e=this.ws)||void 0===e||e.close(),this.closePromise=new i.Deferred,this.setState(o.e.Closing)),this.closePromise.promise}openConnection(){try{this.ws=new WebSocket(this.url),this.ws.onopen=()=>{this.setState(o.e.Open),this.reconnectAttempted=!1,this.authService?this.authenticateConnection():this.onOpen()},this.ws.onclose=e=>{this.stopMonitors(),this.isExplicitClose?(this.setState(o.e.Closed),this.rejectAndCloseConnection(o.f.ConnectionExplicitClose,e)):this.authService&&!this.isTokenValid&&1006!==e.code?(this.setState(o.e.Closed),this.rejectAndCloseConnection(o.f.AuthExpiredToken,e)):this.reconnectAttempted||this.retryConnection(e)},this.ws.onmessage=this.onMessage.bind(this),this.ws.onerror=()=>{this.retryConnection(),this.reconnectAttempted=!0,this.onError.bind(this)}}catch(e){this.retryConnection()}}retryConnection(e){this.setState(o.e.Connecting),this.retryAttempt<this.retryMaxAttempts?(this.retryAttempt++,this.retryMonitor=me.setTimeout(this.openConnection.bind(this),this.retryInterval)):(this.setState(o.e.Closed),this.rejectAndCloseConnection(o.f.NetworkFailure,e))}rejectAndCloseConnection(e,t){this.openPromise&&this.openPromise.reject((0,o.t)(e)),this.onClose(t)}authenticateConnection(){var e;this.isTokenValid=!1,null===(e=this.authService)||void 0===e||e.get().then((e=>{this.send(function(e){return{state:{token:e,tokenType:de,type:le.Auth}}}(e.token)).then((()=>{setTimeout((()=>this.isTokenValid=!0),1e4),this.onOpen()}))})).catch((e=>{var t;null===(t=this.openPromise)||void 0===t||t.reject(e),this.close()}))}onOpen(){var e;this.stopMonitors(),clearTimeout(this.retryMonitor),this.heartBeatMonitor=this.initHeartBeat(),this.refreshMonitor=(e=this,me.setTimeout((()=>{fe(e)}),ue)),this.retryAttempt=0,this.isExplicitClose=!1,this.isTokenValid=!1,this.openPromise&&(this.openPromise.resolve(),this.openPromise=null),this.closePromise&&(this.closePromise.reject(),this.closePromise=null),this.dispatcher.trigger(o.g.Open)}onClose(e){this.retryAttempt=0,this.isExplicitClose=!1,this.isTokenValid=!1,this.closePromise&&(this.closePromise.resolve(),this.closePromise=null),this.openPromise=null,this.dispatcher.trigger(o.g.Close,e)}onMessage(e){try{const t=JSON.parse(e.data);!function(e){return e.state&&e.state.type&&e.state.type===le.Pong}(t)?t.suggestions&&this.suggestionPromise?this.suggestionPromise.resolve(t.suggestions):(we(t),this.dispatcher.trigger(o.g.Message,t),this.dispatcher.trigger(o.g.MessageReceived,t)):this.isHeartBeatAlive=!0}catch(e){this.onError(e)}}onError(e){this.dispatcher.trigger(o.g.Error,e)}initHeartBeat(){return me.setInterval((()=>{this.send(he).then((()=>{this.isHeartBeatAlive=!1,this.pongMonitor=me.setTimeout((()=>{this.isOpen()&&!this.isHeartBeatAlive&&fe(this)}),1e4)}))}),3e4)}stopMonitors(){clearTimeout(this.refreshMonitor),clearInterval(this.heartBeatMonitor),clearTimeout(this.pongMonitor)}}function fe(e){e.close().then((()=>e.open()))}class ve{constructor(e){this.options=e,e.isLongPoll&&(this.options.retryInterval=2e3,this.options.retryMaxAttempts=5),this.dispatcher=(0,i.generateEventDispatcher)(),this.wsConnection=new be({authService:e.authService,url:(0,i.getWebSocketURL)(e.baseURL,e.searchParams,e.isTLS,e.channel),retryInterval:e.retryInterval,retryMaxAttempts:e.retryMaxAttempts,dispatcher:this.dispatcher}),this.currentConnection=this.wsConnection}open(){return this.options.isLongPoll?new Promise(((e,t)=>{this.wsConnection.open().then((()=>{this.useWS(e)})).catch((()=>{this.useLongPoll(e,t)}))})):this.currentConnection.open()}close(){return clearTimeout(this.upgradeToWebSocketMonitor),this.currentConnection.close()}send(e){return this.currentConnection.send(e)}isOpen(){return this.currentConnection.isOpen()}isClosed(){return this.currentConnection.isClosed()}getState(){return this.currentConnection.getState()}updateConnectionUrl(e){var t;this.wsConnection.updateConnectionUrl(e),this.options=Object.assign(Object.assign({},this.options),{baseURL:e.URI,searchParams:{channelId:e.channelId,userId:e.userId},isTLS:e.isTLS,channel:e.channel}),null===(t=this.longPollConnection)||void 0===t||t.updateConnectionUrl(e)}on(e,t){this.dispatcher.bind(e,t)}off(e,t){this.dispatcher.unbind(e,t)}setSuggestionPromise(e){this.wsConnection.setSuggestionPromise(e)}useWS(e){var t;this.currentConnection=this.wsConnection,clearTimeout(this.upgradeToWebSocketMonitor),(null===(t=this.longPollConnection)||void 0===t?void 0:t.isOpen())&&this.longPollConnection.close(),e()}useLongPoll(e,t){this.currentConnection=this.getLongPollConnection(),this.currentConnection.open().then((()=>{this.upgradeToWebSocketMonitor=this.initUpgradeToWebSocketTimer(),e()})).catch((e=>{t(e)}))}getLongPollConnection(){return this.longPollConnection||(this.longPollConnection=new pe({url:(0,i.getLongPollURL)(this.options.baseURL,this.options.searchParams,this.options.isTLS),authService:this.options.authService,dispatcher:this.dispatcher})),this.longPollConnection}initUpgradeToWebSocketTimer(){return window.setTimeout((()=>{this.currentConnection.close().then((()=>{this.open()}))}),3e5)}}const we=e=>{const t=e.messagePayload;t&&t.type===o.i.TextStream&&(t.streamState=t.streamState.toLowerCase())},xe={isLongPoll:!1,isTLS:!0};class ye{constructor(e){this.areNewConnectionParamsPassed=(e,t,s)=>{let i=!1;return(e&&e!==this.config.URI||t&&t!==this.config.channelId||s&&s!==this.config.userId)&&(i=!0),i},this.updateConnectionParams=(e,t,s)=>new Promise(((i,o)=>{e&&"string"==typeof e&&e.length&&(this.config.URI=e),this.authService?this.authService.get().then((e=>{this.config.channelId=e.getClaim("channelId"),this.config.userId=e.getClaim("userId"),this.connection.updateConnectionUrl({URI:this.config.URI,channelId:this.config.channelId,userId:this.config.userId,isTLS:this.config.isTLS,channel:this.config.channel}),i()})).catch((e=>o(e))):("string"==typeof t&&t.length&&(this.config.channelId=t),"string"==typeof s&&s.length&&(this.config.userId=s),this.connection.updateConnectionUrl({URI:this.config.URI,channelId:this.config.channelId,userId:this.config.userId,isTLS:this.config.isTLS,channel:this.config.channel}),i())})),this.config=Object.assign(Object.assign({},xe),e),this.config.tokenGenerator&&(this.authService=i.AuthTokenService.getInstance()),this.connection=new ve({baseURL:this.config.URI,isLongPoll:this.config.isLongPoll,isTLS:this.config.isTLS,channel:this.config.channel,retryInterval:void 0!==this.config.retryInterval&&this.config.retryInterval>=0?1e3*this.config.retryInterval:5e3,retryMaxAttempts:void 0!==this.config.retryMaxAttempts&&this.config.retryMaxAttempts>=0?this.config.retryMaxAttempts:5,searchParams:{channelId:this.config.channelId,userId:this.config.userId},authService:this.authService}),window.addEventListener("online",(()=>this.open())),window.addEventListener("offline",(()=>this.close()))}open(e){const{URI:t,userId:s,channelId:i}=e||{};if(this.isOpen()){if(this.areNewConnectionParamsPassed(t,i,s)){const e=t&&this.config.URI!==t;return!this.authService||e?this.close().then((()=>this.updateConnectionParams(t,i,s).then((()=>this.connection.open())))):Promise.resolve()}return Promise.resolve()}return this.updateConnectionParams(t,i,s).then((()=>this.connection.open()))}close(){return this.connection.close()}isOpen(){return this.connection.isOpen()}send(e,t,s){let i;return i="string"==typeof e?(0,o.r)(e,t):(0,o.C)(e)?(0,o.o)(e):(0,o.B)(e)?(0,o.q)(e):e,(0,o.G)(i)?((null==s?void 0:s.sdkMetadata)&&(i=this.updateMetadata(i,s.sdkMetadata)),i.userId=this.config.userId,this.connection.send(i)):(0,o.u)(o.f.MessageInvalid)}updateUser(e,t){let s=e;return(null==t?void 0:t.sdkMetadata)&&(s=this.updateMetadata(e,t.sdkMetadata)),this.connection.send(s)}sendDeviceToken(e,t){const s={state:{type:"token",deviceToken:e,deviceType:t}};return this.connection.send(s)}getSuggestions(e){const t=new i.Deferred;this.connection.setSuggestionPromise(t);const s={messagePayload:{query:e,threshold:30,type:o.i.Suggest}};return this.connection.send(s).catch(null==t?void 0:t.reject),setTimeout((()=>{null==t||t.reject((0,o.t)(o.f.SuggestionsTimeout))}),1e4),null==t?void 0:t.promise}on(e,t){this.connection.on(e,t)}off(e,t){this.connection.off(e,t)}updateMetadata(e,t){return t&&(e.sdkMetadata=Object.assign(Object.assign({},e.sdkMetadata),t)),e}}const Ce=25,Se=1024*Ce*1024;class ke{static getInstance(){return this.service||(this.service=new ke),this.service}setParams(e){this.params=e,this.URL=function(e,t,s){const o=`http${s?"s":""}://`;return(0,i.buildURL)(o,e,t,"/chat/v1/attachments")}(e.URI,{channelId:e.channelId,userId:e.userId},e.isTLS)}upload(e,t){return new Promise(((s,a)=>{const n=e.size;if(0===n)return void a(Error(o.f.UploadZeroSize));if(n>Se)return void a(Error(o.f.UploadMaxSize));const r=new XMLHttpRequest,c=()=>a(Error(o.f.UploadNetworkFail));(0,o.I)(r,"readystatechange",(()=>{if(4===r.readyState)switch(r.status){case 200:{const e=JSON.parse(r.responseText);s(e);break}case 413:a(Error(o.f.UploadMaxSize));break;case 415:a(Error(o.f.UploadBadFile));break;default:c()}})),(0,o.I)(r,"abort",c),(0,o.I)(r,"error",c),(0,o.I)(r,"timeout",c),this.params.tokenGenerator?i.AuthTokenService.getInstance().get().then((s=>this.send(r,{file:e,options:t,token:s.token}))).catch((e=>a(e))):this.send(r,{file:e,options:t})}))}send(e,{file:t,options:s,token:i}){const a=new FormData;a.append("attachment",t,encodeURI(t.name)),e.open("POST",this.URL),(0,o.J)(e,"x-oda-meta-file-size",t.size.toString()),i&&((0,o.J)(e,"Authorization",`Bearer ${i}`),this.params.enableAttachmentSecurity&&((0,o.J)(e,"x-oda-meta-file-isProtected","True"),(0,o.J)(e,"x-oda-meta-file-authType","ChannelClientAuth"))),e.send(a),s&&s.onInitUpload&&s.onInitUpload(e)}}const Te={AUDIO:".aac, .amr, .m4a, .mp3, .mp4a, .mpga, .oga, .ogg, .wav, audio/*",FILE:".7z, .csv, .doc, .docx, .eml, .ics, .key, .log, .msg, .neon, .numbers, .odt, .pages, .pdf, .pps, .ppsx, .ppt, .pptx, .rtf, .txt, .vcf, .xls, .xlsx, .xml, .yml, .yaml, application/msword, application/vnd.openxmlformats-officedocument.wordprocessingml.document",IMAGE:".gif, .jfif, .jpeg, .jpg, .png, .svg, .tif, .tiff, .webp, image/*",VIDEO:".3g2, .3gp, .avi, .m4v, .mov, .mp4, .mpeg, .mpg, .ogv, .qt, .webm, .wmv, video/*",ALL:""};Te.ALL=`${Te.AUDIO},${Te.FILE},${Te.IMAGE},${Te.VIDEO}`;const Ae={oracle:"oracle",platform:"platform"},Ie=Ae.oracle;class Ee{constructor(e){this.config=e,this.recognizedText=null,this.ttsMap=new Map,this.config.URI=(0,i.stripHTTP)(e.URI),this.initServices(e),this.chatService=new ye(e),this.chatService.on(o.g.Open,(()=>{this.uploadService&&this.uploadService.setParams(e),this.recognitionService&&this.recognitionService.setConfig(e)}))}connect(e){return(null==e?void 0:e.URI)&&(e.URI=(0,i.stripHTTP)(e.URI)),this.chatService.open(e)}disconnect(){const e=this.chatService.close();return e.then(this.onChatServiceClose.bind(this)),e}isConnected(){return this.chatService.isOpen()}sendMessage(e,t){if(!e)return(0,o.u)(o.f.MessageInvalid);let s="",i="";if("string"==typeof e)i=e;else if((0,o.B)(e)){i=e.text}return this.recognizedText&&this.recognizedText.text===i&&(s=this.recognizedText.requestId),this.recognizedText=null,this.chatService.send(e,s,t)}updateUser(e,t){return(0,o.H)(e)?this.chatService.updateUser(e,t):(0,o.u)(o.f.ProfileInvalid)}sendDeviceToken(e,t){return this.chatService.sendDeviceToken(e,t)}uploadAttachment(e,t){return this.isConnected()?this.uploadService?this.uploadService.upload(e,t).then((e=>(0,o.p)(e.type,e.url))):(0,o.u)(o.f.UploadNotAvailable):(0,o.u)(o.f.ConnectionNone)}sendAttachment(e,t){return this.uploadAttachment(e,t).then((e=>this.chatService.send(e,"",{sdkMetadata:null==t?void 0:t.sdkMetadata})))}sendLocation(e){return this.isConnected()?e?(0,o.F)(e)?this.chatService.send({messagePayload:{type:o.i.Location,location:e}}):(0,o.u)(o.f.LocationInvalid):(0,o.s)().then((e=>this.chatService.send({messagePayload:{type:o.i.Location,location:{latitude:e.latitude,longitude:e.longitude}}}))):(0,o.u)(o.f.ConnectionNone)}sendUserTypingStatus(e,t){return this.sendMessage((0,o.q)({partyType:"user",source:"sdk",status:e,type:o.i.Status,text:t}))}getSuggestions(e){return e?"string"!=typeof e?(0,o.u)(o.f.SuggestionsInvalidRequest):this.chatService.getSuggestions(e):(0,o.u)(o.f.SuggestionsEmptyRequest)}destroy(){this.disconnect();for(const e in this)this[e]&&delete this[e]}setTTSService(e){this.ttsService="string"==typeof e?this.getTTSServiceByName(e):e}getTTSService(){return this.ttsService}getTTSVoices(){return this.ttsService?this.ttsService.getVoices():(0,o.u)(o.f.TtsNotAvailable)}setTTSVoice(e){return this.ttsService?this.ttsService.setVoice(e):(0,o.u)(o.f.TtsNotAvailable)}getTTSVoice(){if(this.ttsService)return this.ttsService.getVoice();throw(0,o.t)(o.f.TtsNotAvailable)}speakTTS(e,t){if(this.ttsService){let s;if("string"==typeof e)s=e;else{if(!(0,o.G)(e))return;s=(0,o.v)(e,t)}this.ttsService.speak(s)}}cancelTTS(){this.ttsService&&this.ttsService.cancel()}startRecognition(e){return this.recognitionService?this.isConnected()?this.recognitionService.startRecognition(Object.assign(Object.assign({},e),{onRecognitionText:t=>{"final"===t.type&&(this.recognizedText=t),e.onRecognitionText(t)}})):(0,o.u)(o.f.ConnectionNone):(0,o.u)(o.f.RecognitionNotAvailable)}stopRecognition(){return this.recognitionService?this.recognitionService.stopRecognition():(0,o.u)(o.f.RecognitionNotAvailable)}setRecognitionLocale(e){if(e&&"string"==typeof e&&this.recognitionService){const t=e.toLowerCase();this.recognitionService.setLocale(t)}}on(e,t){var s;switch(e){case o.n.TTSStart:case o.n.TTSStop:null===(s=this.ttsService)||void 0===s||s.on(e,t);break;default:this.chatService.on(e,t)}}off(e,t){var s;switch(e){case o.n.TTSStart:case o.n.TTSStop:null===(s=this.ttsService)||void 0===s||s.off(e,t);break;default:this.chatService.off(e,t)}}getAuthToken(){var e;return null===(e=this.authService)||void 0===e?void 0:e.get()}onChatServiceClose(){console.log("The chat service is closed.")}initServices(e){e.URI=e.URI.replace(/^https?:\/\//gi,(e=>(console.warn(`Please remove "${e}" from URI.`),""))),this.initAttachmentService(e),this.initAuthService(e),this.initTTSService(e),this.recognitionService=N.getInstance()}initAttachmentService(e){e.enableAttachment&&(this.uploadService=ke.getInstance())}initAuthService(e){e.tokenGenerator&&(this.authService=i.AuthTokenService.getInstance(),this.authService.setFetch(e.tokenGenerator))}initTTSService(e){if(e.isTTS){let t;const s=e.TTSService;t=s?"string"==typeof s?this.getTTSServiceByName(s):s:this.getTTSServiceByName(Ie),this.ttsService=t}}getTTSServiceByName(e){const t=this.ttsMap.get(e);if(t)return t;let s;try{e===Ae.oracle?s=new se(this.config):e===Ae.platform&&(s=new u),this.ttsMap.set(e,s)}catch(e){console.log(e)}return s}}Ee.TTS=Ae},249:function(e,t,s){s.r(t),s.d(t,{ChatEvent:function(){return o},DOMUtil:function(){return De},Logger:function(){return R},MESSAGE_SIDE:function(){return z},MessageComponent:function(){return F},MessageComponentFactory:function(){return zt},SDK_VERSION:function(){return j},ShareCategory:function(){return Ve},StorageType:function(){return ze},WidgetComponent:function(){return ws},WidgetTheme:function(){return Fe},appendStyle:function(){return k},configureColorCustomization:function(){return T},configureLocale:function(){return x},debounce:function(){return y},isAnyVoiceAvailable:function(){return c},syncTTSLocaleIfUnavailable:function(){return f}});var i=s(358);const o=Object.assign(Object.assign({},i.n),{CHAT_LANG:"chatlanguagechange",CLICK_AUDIO_RESPONSE_TOGGLE:"click:audiotoggle",CLICK_ERASE:"click:erase",CLICK_VOICE_TOGGLE:"click:voicetoggle",DESTROY:"destroy",CHAT_END:"chatend",MESSAGE:"message",MESSAGE_RECEIVED:"message:received",MESSAGE_SENT:"message:sent",NETWORK:"networkstatuschange",READY:"ready",TYPING:"typing",UNREAD:"unreadCount",WIDGET_CLOSED:"widget:closed",WIDGET_OPENED:"widget:opened"}),a=()=>{var e;return(null===(e=navigator.languages)||void 0===e?void 0:e.map((e=>e.toLowerCase())))||[]},n=e=>{let t;try{t=window[e];const s="__storage_test__";return t.setItem(s,s),t.removeItem(s),!0}catch(e){return e instanceof DOMException&&(22===e.code||1014===e.code||"QuotaExceededError"===e.name||"NS_ERROR_DOM_QUOTA_REACHED"===e.name)&&t&&0!==t.length}};var r=s(350);function c(e,t){if(!t)return Promise.resolve(!1);if(Array.isArray(t)||(t=[t]),!t.length)return Promise.resolve(!1);const s=t.map((e=>{var t;return null===(t=e.lang)||void 0===t?void 0:t.toLowerCase()}));return e.getVoices().then((e=>{let t=!1;const i=e.map((e=>e.lang.toLowerCase()));for(const e of s)if(i.indexOf(e)>=0){t=!0;break}return t}))}const l=/(?:youtube\.com\/watch\?v=|youtu.be\/)([^#&?\s]*)/gim;function d(e){let t;return e.replace((0,r.resetRegex)(l),((e,s)=>(s&&s.length&&(t=s),e))),t}const h=/(?:https?:\/\/)?videohub\.oracle\.com\/media\/\S+\/([\w]+)/gim;function p(e){let t;return e.replace((0,r.resetRegex)(h),((e,s)=>(s&&s.length&&(t=s),e))),t}const g=[{match:/<([a-z])/gi,replace:(e,t)=>`&#x3c;${t}`},{match:/<\/([a-z])/gi,replace:(e,t)=>`&#x3c;&#47;${t}`}];function u(e){return g.forEach((t=>{e=e.replace((0,r.resetRegex)(t.match),t.replace)})),e}function m(e,t){for(let s=0;s<e.childElementCount;s++){const i=e.children[s];if("a"===i.tagName.toLowerCase()){const e=i;e.rel="noreferrer noopener",t.onclick&&(e.onclick=t.onclick.bind(e)),t.target&&(e.target=t.target)}i.hasChildNodes()&&m(i,t)}}function b(e){for(let t=0;t<e.childElementCount;t++){const s=e.children[t];"a"===s.tagName.toLowerCase()&&(s.onclick=e=>(window.open(s.href,"","height=450px,width=800px,menubar,toolbar,personalbar,status,resizable,noopener,noreferrer"),e.preventDefault(),e.stopPropagation(),!1)),s.hasChildNodes()&&b(s)}}const f=(()=>{let e=!1;return(t={hasRecognition:!1,hasSynthesis:!1,isReset:!1,recognitionLocale:"",synthesisLocales:[]})=>{var s;t.isReset&&(e=!1);let i=t.synthesisLocales;return Array.isArray(i)||(i=[]),t.hasRecognition&&t.hasSynthesis&&(null===(s=t.recognitionLocale)||void 0===s?void 0:s.length)&&(!e&&t.synthesisLocales.length||(e=!0,i=[{lang:t.recognitionLocale}])),i}})();function v(e,t){const s=e.toLowerCase();for(const e in t)if(s===e.toLowerCase())return!0;return!1}function w(e,t){const s=e.toLowerCase().split("-")[0];for(const e in t)if(s===e.toLowerCase())return!0;return!1}function x(e,t){let s=[e.toLowerCase()],i="en";s=s.concat(a()),s.indexOf(i)<0&&s.push(i);for(const e of s){if(v(e,t)){i=e;break}if(w(e,t)){i=e.split("-")[0];break}}return i}function y(e,t){let s;return function(){const i=this,o=arguments;clearTimeout(s),s=setTimeout((function(){s=null,e.apply(i,o)}),t)}}function C(e,t){let s=!1;return function(){const i=this;s||(e.apply(i,arguments),s=!0,setTimeout((()=>{s=!1}),t))}}function S(e,t=!1){let s=e.title?`${e.title} - `:"";return(0,i.z)(e)?e.fields.forEach((e=>{s+=e.value?`${e.value} - `:""})):e.formRows.forEach((e=>{e.columns.forEach((e=>{e.fields.forEach((e=>{(0,i.D)(e)&&(s+=e.value?`${e.value} - `:"")}))}))})),t?A(s):s}function k(e,t,s){if(t){const i=e.replace(/(\.)([a-zA-Z_-]+)(?=[^}]+{)/gi,`$1${s}-$2`);t.innerText=t.innerText+i}}function T(e,t){if(e){const s=["headerBackground","visualizer","ratingStarFill"],i=["botText","userText"],o=Object.assign({},e);s.forEach((t=>{o[t]=e[t]||e.branding})),i.forEach((t=>{o[t]=e[t]||e.text})),Object.keys(o).forEach((e=>{const s=o[e];if(s)if("shareMenuText"===e)t=(0,r.updateCSSVar)(t,s,"--color-popup-button-text");else{const i=`--color-${e.replace(/([A-Z&])/g,"-$1").toLowerCase()}`;t=(0,r.updateCSSVar)(t,s,i)}}))}return t}function A(e){return e.length?e.slice(0,e.length-3):e}function I(e){return e.filter((e=>{const t=e.getActionType();return t===i.b.Postback||t===i.b.Location||t===i.b.SubmitForm}))}class E{constructor(e,t){this.util=e,this._disabled=!1,this._type=t.type,this._label=t.label,this._imageUrl=t.imageUrl,this.style=t.style}render(){const e=this.util;if(this._htmlElement=e.createButton(["action-postback",this.style===i.a.Primary?"primary":this.style===i.a.Danger?"danger":""]),this._htmlElement.onclick=this.handleOnClick.bind(this),this._imageUrl){const t=e.createImage(this._imageUrl,["action-image"],this._label||"");this._htmlElement.appendChild(t)}if(this._label){const t=e.linkify(this._label,{emHTML:!0}),s=e.createDiv();s.innerHTML=t,this._htmlElement.appendChild(s)}return this._disabled&&e.addCSSClass(this._htmlElement,"disabled"),this._htmlElement}handleOnClick(e){if(this.onActionClick&&!this._disabled){const e={getPayload:this.getEventPayload.bind(this),label:this._label,type:this._type};this.onActionClick(e)}this._type!==i.b.Postback&&this._type!==i.b.Location&&this._type!==i.b.Share||(e.preventDefault(),e.stopPropagation())}disable(){this._disabled=!0,this._htmlElement&&(this.util.addCSSClass(this._htmlElement,"disabled"),this._htmlElement.disabled=!0)}enable(){this._disabled=!1,this._htmlElement&&(this.util.removeCSSClass(this._htmlElement,"disabled"),this._htmlElement.disabled=!1)}getActionType(){return this._type}}class _ extends E{constructor(e,t){super(e,t),this._phoneNumber=t.phoneNumber}render(){const e=this.util,t=super.render();e.addCSSClass(t,"action-call");const s=e.createAnchor(`tel:${this._phoneNumber}`,"");return this.onActionClick=()=>{s.click()},t}getEventPayload(){return Promise.resolve(this._phoneNumber)}}class M extends E{render(){const e=this.util,t=super.render();return e.addCSSClass(t,"action-location"),t}getEventPayload(){return(0,i.s)()}}class L extends E{constructor(e,t){super(e,t),this._postback=t.postback}getEventPayload(){return Promise.resolve(this._postback)}}class P extends E{constructor(e,t,s){super(e,t),this.shareText=s}render(){const e=this.util,t=super.render();return e.addCSSClass(t,"action-share"),t}getEventPayload(){return Promise.resolve(this.shareText)}}class D extends E{constructor(e,t){super(e,t),this._postback=t.postback}getEventPayload(){return Promise.resolve(this._postback)}}class O extends E{constructor(e,t,s=!1,i){super(e,t),this._openInWindow=s,this._linkHandler=i,this._url=t.url}render(){const e=this.util,t=super.render();if(e.addCSSClass(t,"action-url"),this._url){const s=e.createAnchor(this._url,"",[],this._openInWindow,this._linkHandler);t.onclick=()=>{s.click()}}return t}getEventPayload(){return Promise.resolve(this._url)}}class R{constructor(e){this.module=e}debug(...e){this._log(R.LOG_LEVEL.DEBUG,e)}error(...e){this._log(R.LOG_LEVEL.ERROR,e)}info(...e){this._log(R.LOG_LEVEL.INFO,e)}warn(...e){this._log(R.LOG_LEVEL.WARN,e)}_log(e,t){if(R.logLevel>=e){let s;switch(t.unshift(`[${R.appName}.${R.appVersion}.${this.module}]`),R.logLevel){case R.LOG_LEVEL.ERROR:s=console.error;break;case R.LOG_LEVEL.WARN:s=console.warn;break;case R.LOG_LEVEL.INFO:s=console.info;break;case R.LOG_LEVEL.DEBUG:s=console.debug}R.historyEnabled&&(R.history.push(Object.assign(Object.assign({},t),{level:e})),R._historySize<=R.history.length&&R.history.shift()),s.apply(console,t)}}}R.LOG_LEVEL={DEBUG:4,ERROR:1,INFO:3,NONE:0,WARN:2},R.logLevel=R.LOG_LEVEL.ERROR,R.history=[],R.historyEnabled=!1,R._historySize=100;class B{static fromActionPayload(e,t,s,o,a,n){switch(e.type){case i.b.Postback:return new L(t,e);case i.b.Url:return new O(t,e,s,a);case i.b.Webview:return new O(t,e,s,n.webviewLinkHandler);case i.b.Location:return new M(t,e);case i.b.Call:return new _(t,e);case i.b.Share:return new P(t,e,o);case i.b.SubmitForm:return new D(t,e);default:return B.logger.error(`Payload contains wrong action type:${e.type}`),null}}}B.logger=new R("ActionComponentFactory");const z={LEFT:"left",RIGHT:"right"};class F{constructor(e,t,s,o,a,n){this.settings=e,this.util=t,this.payload=s,this.side=o,this.source=a,this.options=n,this.actions=[],this.globalActions=[],this._postActions=[],this.locale=e.locale,this.translations=e.i18n[this.locale],this.shareText=function(e){let t="";switch(e.type){case i.i.Card:return e.cards.forEach((e=>{var s;t+=(e.title?`${e.title} - `:"")+(e.description?`${e.description} - `:"")+(null!==(s=e.url)&&void 0!==s?s:"")+"\n"})),t;case i.i.Text:return e.text;case i.i.Attachment:return e.attachment.url;case i.i.Location:const s=e.location;return`${s.title?`${s.title} - `:""}${s.latitude}, ${s.longitude}`;case i.i.Table:e.rows.forEach((e=>{e.fields.forEach((e=>{t+=e.value?`${e.value} - `:""}))}));break;case i.i.Form:e.forms.forEach((e=>{const s=S(e);t+=s?`${s} - `:""}));break;case i.i.EditForm:const o=e;t=o.title?`${o.title} - `:"",(0,i.w)(o)?o.fields.forEach((e=>{(0,i.D)(e)?t+=e.value?`${e.value} - `:"":t+=e.label?`${e.label} - `:""})):o.formRows.forEach((e=>{e.columns.forEach((e=>{e.fields.forEach((e=>{(0,i.D)(e)?t+=e.value?`${e.value} - `:"":t+=e.label?`${e.label} - `:""}))}))}));break;case i.i.TableForm:const a=e;a.rows.forEach(((e,s)=>{e.fields.forEach((e=>{t+=e.value?`${e.value} - `:""})),t+=S(a.forms[s])}))}return A(t)}(s),n&&n.locale&&(this.locale=n.locale,this.translations=Object.assign(Object.assign({},this.translations),this.settings.i18n[n.locale])),s.actions&&(this.actions=this.buildActions(s.actions,this.shareText)),s.globalActions&&(this.globalActions=this.buildActions(s.globalActions,this.shareText)),this.headerText=s.headerText,this.footerText=s.footerText,this._postActions=I(this.actions).concat(I(this.globalActions))}handleOnActionClick(e){if(this.onActionClick){const t=e;t.messageComponent=this,this.onActionClick(t)}}hasActions(){return this.actions.length>0||this.globalActions.length>0}focusFirstAction(){var e;null===(e=this.firstActionButton)||void 0===e||e.focus()}disableActions(){this.actions.forEach((e=>{e.disable()})),this.globalActions.forEach((e=>{e.disable()}))}disablePostbacks(){this._postActions.forEach((e=>{e.disable()}))}enableActions(){this.actions.forEach((e=>{e.enable()})),this.globalActions.forEach((e=>{e.enable()}))}enablePostbacks(){this._postActions.forEach((e=>{e.enable()}))}render(e){const t=this,s=t.util,i=t.actions,o=t.globalActions;this.element&&(this.element.innerHTML="");const a=this.element?this.element:s.createDiv(["message"]);a.lang=t.locale;const n=s.createDiv(["message-wrapper"]);a.appendChild(n);const r=t.getContent(e);if(t.headerText&&n.appendChild(t.getHeader()),n.appendChild(r),i&&i.length){const e=t.getActions();(this.settings.displayActionsAsPills?n:r).appendChild(e),t.firstActionButton||(t.firstActionButton=e.firstElementChild)}if(t.footerText&&n.appendChild(t.getFooter()),o&&o.length){const e=t.getGlobalActions();a.appendChild(e),t.firstActionButton||(t.firstActionButton=e.firstElementChild)}return this.element=a,a}getHeader(){return V(this.headerText,"message-header",this.util,this.settings.embeddedVideo)}getContent(e){const t=this.util.createDiv(["message-bubble"]);return t.style.padding=this.settings.messagePadding||t.style.padding,e&&t.appendChild(e),t}getActions(){const e=this.settings,t=e.displayActionsAsPills?["message-global-actions"]:["message-actions"];return"horizontal"!==e.actionsLayout&&t.push("col"),N(this.actions,t,this.util)}getFooter(){return V(this.footerText,"message-footer",this.util,this.settings.embeddedVideo)}getGlobalActions(){const e=["message-global-actions"];return this.settings.icons.avatarBot&&e.push("has-message-icon"),"horizontal"!==this.settings.globalActionsLayout&&e.push("col"),N(this.globalActions,e,this.util)}buildActions(e,t){const s=this.settings;return function(e,t,s,i,o,a,n){const r=[];return e.forEach((e=>{const c=B.fromActionPayload(e,t,s,i,o,a);c&&(c.onActionClick=n,r.push(c))})),r}(e,this.util,s.openLinksInNewWindow,t,s.linkHandler,this.options,this.handleOnActionClick.bind(this))}}function V(e,t,s,i){const o=s.createDiv(["message-bubble",t]),a=s.createDiv();return a.innerHTML=s.linkify(e,{emHTML:!0,emVideo:i}),o.appendChild(a),o}function N(e,t,s){const i=s.createDiv(t);return e.forEach((e=>{i.appendChild(e.render())})),i}class $ extends F{constructor(e,t,s,i,o,a){super(e,t,s,i,o,a),this.lastChunk="",this.state=s.streamState,this.text=s.text,this.lastChunk=s.text;let n="";this.buffer=U((e=>{n+=`${e} `;const s=t.linkify(n,{emHTML:!0,emVideo:!0});this.textElement.innerHTML=s}),(()=>{this.text=this.textElement.innerHTML,this.render()}),e.typingDelay||40)}update(e){const t=e.streamState;switch(this.state=t,t){case"start":this.renderClean(e);break;case"running":this.buffer.push(e.text.split(" ")),this.lastChunk=e.text;break;case"end":const t=this.lastChunk;if(this.lastChunk="",t.length){const s=e.text.lastIndexOf(t);if(s>=0){const i=e.text.substring(s+t.length);this.buffer.push(i.split(" ")),this.setAddOnComponents(e);break}}this.renderClean(e)}}getContent(){const e=this.settings,t=this.util,s=t.createDiv();return s.setAttribute("aria-hidden","true"),"start"===this.state?(this.textElement=s,this.buffer.push(this.text.split(" "))):(s.innerHTML=t.linkify(this.text,{emHTML:!0,emVideo:!0}),"end"===this.state&&s.removeAttribute("aria-hidden"),e.linkHandler?m(s,e.linkHandler):e.openLinksInNewWindow&&b(s)),super.getContent(s)}renderClean(e){this.buffer.cancel(),this.text=e.text,this.setAddOnComponents(e),this.render()}setAddOnComponents(e){this.headerText=e.headerText,e.actions&&(this.actions=this.buildActions(e.actions)),this.footerText=e.footerText,e.globalActions&&(this.globalActions=this.buildActions(e.globalActions)),this._postActions=I(this.actions).concat(I(this.globalActions))}}const U=(e,t,s)=>{const i=[];let o=!0;const a=()=>{if(!i.length)return o=!0,void setTimeout((()=>t()));setTimeout((()=>{i.length&&(e(i.shift()),a())}),s)};return{push:e=>{i.push(...e),o&&(o=!1,a())},cancel:()=>{i.length=0}}};class H{}H.GEOLOCATION_REQUEST_DENIED=1,H.CHAT_SCROLL_DELAY=300,H.WEBSOCKET_READY_STATE=["CONNECTING","OPEN","CLOSING","CLOSED"],H.WEBSOCKET_CLOSE_EVENT={CODE:{ABNORMAL_CLOSURE:1006}},H.ATTACHMENT_HEADER={AUTHORIZATION:"Authorization",FILE_AUTH_TYPE:"x-oda-meta-file-authType",FILE_IS_PROTECTED:"x-oda-meta-file-isProtected",FILE_SIZE:"x-oda-meta-file-size"},H.MAX_SUGGESTIONS_COUNT=5,H.MIN_SUGGESTIONS_COUNT=1,H.SUGGESTIONS_COUNT_THRESHOLD=30,H.TIME={MIN_FIFTY:3e6};const j="23.08",W=1024,G=26214400,q=1e3,K=ke('<path d="M11.007 15.117A1 1 0 0 0 13 15V7l-.005-.176A3 3 0 0 0 7 7v8l.005.217A5 5 0 0 0 17 15V5h2v10a7 7 0 1 1-14 0V7a5 5 0 0 1 10 0v8l-.005.176A3 3 0 0 1 9 15V9h2v6z"/>'),Y=ke('<path d="M4 2h10.414L20 7.586V10h-2V9h-5V4H6v16h12v-1h2v3H4zm11 3.414L16.586 7H15z"/><path d="m7.764 17 1.849-4.87h1.012L12.486 17H11.32l-.32-.998H9.204L8.882 17zm1.722-1.883h1.226l-.617-1.916zm3.278-.415v-2.573h1.045v2.553c0 .531.079.916.235 1.152.156.233.404.349.744.349.344 0 .591-.116.743-.349.157-.236.235-.62.235-1.152v-2.553h1.045v2.573c0 .822-.165 1.427-.496 1.816-.326.384-.835.576-1.527.576s-1.204-.192-1.535-.576c-.326-.389-.489-.994-.489-1.816zM17.686 17v-4.87h1.635c.795 0 1.396.205 1.802.616.407.41.61 1.018.61 1.822 0 .795-.203 1.4-.61 1.816-.402.41-1.002.616-1.802.616zm1.622-4.02h-.577v3.17h.577c.45 0 .786-.128 1.005-.383.223-.259.335-.659.335-1.2s-.11-.94-.329-1.198c-.218-.26-.556-.389-1.011-.389z"/>'),J=ke('<path d="M6.35 8L5 9.739 12 16l7-6.261L17.65 8 12 13.054z"/>'),Z=ke('<path d="M8 17.65L9.739 19 16 12 9.739 5 8 6.35 13.054 12z"/>'),X=ke('<path d="M16 17.65L14.261 19 8 12l6.261-7L16 6.35 10.946 12z"/>'),Q=ke('<path d="M6 11h8v2H6zm0-4h12v2H6z"/><path d="M2 2v20h3.5l3-4H14v-2H7.5l-3 4H4V4h16v6h2V2z"/><path d="M20.3 12.3L19 13.6l-1.3-1.3-1.4 1.4 1.3 1.3-1.3 1.3 1.4 1.4 1.3-1.3 1.3 1.3 1.4-1.4-1.3-1.3 1.3-1.3z"/>'),ee=ke('<path d="M17.524 5 19 6.476 13.475 12 19 17.524 17.524 19 12 13.475 6.476 19 5 17.524 10.525 12 5 6.476 6.476 5 12 10.525z"/>'),te=ke('<path d="M11 13v9H9v-5.586l-6.293 6.293-1.414-1.414L7.586 15H2v-2zM21.293 1.293l1.414 1.414L16.414 9H22v2h-9V2h2v5.586z"/>'),se=ke('<path d="M4 15v5h16v-5h2v7H2v-7zm9-13v10.587l3.293-3.294 1.414 1.414L12 16.414l-5.707-5.707 1.414-1.414L11 12.585V2z"/>'),ie=ke('<path d="M12 2C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2zM8.707 7.293l8 8-1.414 1.414-8-8z"/></svg>'),oe=ke('<path class="st0" d="M20 20H4V4h7V2H2v20h20v-9h-2z"/><path xmlns="http://www.w3.org/2000/svg" class="st0" d="M14 2v2h4.6L8.3 14.3l1.4 1.4L20 5.4V10h2V2z"/>'),ae=ke('<path d="M14.414 2 21 8.584V22H3V2.009zM13 3.999l-8 .007v15.995h14V9.996l-6 .001zm4.585 3.998L15 5.413v2.585z"/>'),ne=ke('<path d="M4 2h10.414L20 7.586V22H4zm2 2v16h12V9h-5V4zm9 1.414L16.586 7H15z"/><path d="M16 12a1 1 0 11-2 0 1 1 0 012 0zm-6.143 1L7 19h10l-2.857-4.5L12 16.75z"/>'),re=ke('<path d="M22 5v14H2V5zm-2 2H4v10h16zM7 13v2H5v-2zm12 0v2h-2v-2zm-4 0v2H9v-2zM7 9v2H5V9zm12 0v2h-2V9zm-4 0v2h-2V9zm-4 0v2H9V9z" />'),ce=ke('<path d="M13 14c-1.5 0-2.9-.4-4-1.1 1.1-2.4 1.7-5 1.9-6.9h9V4H7V2H5v2H2v2h6.9c-.2 1.7-.7 3.7-1.5 5.6C6.5 10.5 6 9.2 6 8H4c0 1.9.9 4 2.5 5.5C5.3 15.5 3.8 17 2 17v2c2.6 0 4.6-1.9 6.1-4.3 1.4.8 3 1.3 4.9 1.3zm7.6 4.6L17 10.5l-3.6 8.1-1.3 3 1.8.8L15 20h4l1.1 2.4 1.8-.8zm-4.7-.6l1.1-2.5 1.1 2.5z"/>'),le='<svg width="36" height="36" viewBox="0 0 36 36"><path fill-rule="evenodd" clip-rule="evenodd" d="M7.875 8.625a2.25 2.25 0 00-2.25 2.25v16c0 .621.504 1.125 1.125 1.125h.284c.298 0 .585-.119.796-.33l2.761-2.76a2.25 2.25 0 011.59-.66h15.944a2.25 2.25 0 002.25-2.25V10.875a2.25 2.25 0 00-2.25-2.25H7.875zM24.75 18a2.25 2.25 0 100-4.5 2.25 2.25 0 000 4.5zm-4.5-2.25a2.25 2.25 0 11-4.5 0 2.25 2.25 0 014.5 0zm-9 2.25a2.25 2.25 0 100-4.5 2.25 2.25 0 000 4.5z" fill="#fff"/></svg>',de=ke('<path d="M4.014 3C2.911 3 2 3.888 2 4.992v15c0 .6.408 1.008 1.007 1.008h.6a.887.887 0 0 0 .695-.288l3.094-3.12c.407-.384.91-.6 1.415-.6h11.175C21.089 16.992 22 16.104 22 15V4.992C22 3.888 21.089 3 19.986 3zm3.981 7.008A1.986 1.986 0 0 1 6.005 12c-1.103 0-1.99-.888-1.99-1.992s.887-2.016 1.99-2.016 1.99.912 1.99 2.016zm5.995 0C13.99 11.112 13.103 12 12 12s-1.99-.888-1.99-1.992.887-2.016 1.99-2.016 1.99.912 1.99 2.016zm5.996 0c0 1.104-.888 1.992-1.99 1.992s-1.991-.888-1.991-1.992.887-2.016 1.99-2.016 1.99.912 1.99 2.016z" fill="#fff"/>'),he=ke('<path d="M7 22v-2h4v-2.062C7.06 17.444 4 14.073 4 10h2c0 3.309 2.691 6 6 6s6-2.691 6-6h2c0 4.072-3.059 7.444-7 7.938V20h4v2h-6zm5-20c2.206 0 4 1.794 4 4v4c0 2.206-1.794 4-4 4s-4-1.794-4-4V6c0-2.206 1.794-4 4-4zm0 2c-1.103 0-2 .897-2 2v4c0 1.103.897 2 2 2s2-.897 2-2V6c0-1.103-.897-2-2-2z"/>'),pe=ke('<path d="M19.33 23.02l-7.332-3.666-7.332 3.666 1.418-7.995L1 9.555l7.331-1.222L11.998 1l3.666 7.333 7.332 1.222-5.084 5.47z"/>'),ge=ke('<path d="M10 2a8 8 0 016.317 12.91l5.383 5.384-1.414 1.414-5.386-5.384A8 8 0 1110 2zm0 2a6 6 0 100 12 6 6 0 000-12z" fill="rgb(22, 21, 19)"/>'),ue=ke('<path d="M13 22V5.414l5.293 5.293 1.414-1.414L12 1.585 4.293 9.293l1.414 1.414L11 5.414V22h2z" fill="#161513"/>'),me=ke('<path d="M22 2v20H2V2zm-2 2H4v16h16zm-3 1.674V14a2 2 0 11-2.15-1.995L15 12V8.326l-5 1.428V16a2 2 0 11-2.15-1.995L8 14V8.246z"/>'),be=ke('<path d="M13.414 2L17 5.586V7h.414L21 10.586V22H7v-4H3V2zM17 9.414V18H9v2h10v-8.586zm-2-3L12.586 4H5v12h10zM13 11v2H7v-2zm-2-4v2H7V7z"/>'),fe=ke('<path d="M12 2c3.874 0 6.994 3.28 6.99 7.214l.011.285c.008.927-.202 2.23-.787 3.837-.96 2.639-2.73 5.452-5.49 8.353L12 22.45l-.724-.761c-2.76-2.901-4.53-5.714-5.49-8.353-.627-1.722-.823-3.095-.782-4.03l.006-.252C5.134 5.147 8.205 2 12 2zm0 2C9.254 4 7.006 6.362 7.002 9.386L7 9.529c-.004.694.168 1.753.667 3.123.741 2.036 2.038 4.221 4.014 6.507l.32.365.32-.365c1.867-2.159 3.127-4.228 3.886-6.166l.128-.34c.535-1.469.694-2.58.664-3.259l-.008-.32C16.879 6.244 14.676 4 12 4zm0 2a3 3 0 1 1-.001 6A3 3 0 0 1 12 6zm0 2a1 1 0 1 0 .001 2A1 1 0 0 0 12 8z"/>'),ve=ke('<path d="M22 2v16h-4v4H2V6h4V2zm-9.036 12.378L6.93 20H16v-2.585zM16 8H4v11.999l9.036-8.377L16 14.585zm4-4H8v2h10v10h2zM7 9a2 2 0 110 4 2 2 0 010-4z"/>'),we=ke('<path d="M1.707.293l22 22-1.414 1.414L12 13.414V21l-6.35-5.114H1V7.954h4.65l.5-.39L.293 1.707zM19.67 4.446c2.119 1.967 3.302 4.613 3.33 7.452a10.363 10.363 0 01-1.392 5.295l-1.476-1.476c.58-1.18.88-2.472.868-3.8-.023-2.29-.981-4.43-2.697-6.025zM7.583 8.996l-1.232.955H3v3.964h3.351L10 16.875v-5.461zm8.051-1.68C17.15 8.547 17.991 10.21 18 11.999c.003.482-.055.956-.17 1.416l-1.86-1.86c-.133-1.017-.691-1.964-1.604-2.706zM12 3v4.586L9.424 5.01z"/>'),xe=ke('<path d="M13 3v18l-6.35-5.114H2V7.954h4.65zm5.67 1.446c2.119 1.967 3.302 4.613 3.33 7.452.029 2.904-1.15 5.658-3.316 7.75l-1.396-1.421c1.772-1.71 2.735-3.95 2.712-6.31-.023-2.29-.981-4.43-2.697-6.025zM11 7.125L7.351 9.95H4v3.964h3.351L11 16.875zm4.634.19C17.15 8.548 17.991 10.212 18 12c.01 1.806-.828 3.5-2.358 4.771l-1.284-1.519c1.065-.885 1.65-2.037 1.642-3.242-.006-1.187-.587-2.309-1.634-3.16z"/>'),ye=ke('<path d="M4 2h10.414L20 7.586V10h-2V9h-5V4H6v16h12v-1h2v3H4zm11 3.414L16.586 7H15z"/><path d="m12.36 17-1.796-4.87h1.18l1.138 3.584 1.153-3.585h1.132L13.37 17zm3.33 0v-4.87h1.046V17zm1.996 0v-4.87h1.635c.795 0 1.396.205 1.802.616.407.41.61 1.018.61 1.822 0 .795-.203 1.4-.61 1.816-.402.41-1.002.616-1.802.616zm1.622-4.02h-.577v3.17h.577c.45 0 .786-.128 1.005-.383.223-.259.335-.659.335-1.2s-.11-.94-.329-1.198c-.218-.26-.556-.389-1.011-.389z"/>'),Ce=ke('<path d="M11 11h2v4h-2zm0 6h2v2h-2z"/><path d="M12 1.8L1.9 22h20.2L12 1.8zm0 4.4L18.9 20H5.1L12 6.2z"/>'),Se=ke('<path d="M11 2a9 9 0 017.032 14.617l3.675 3.676-1.414 1.414-3.676-3.675A9 9 0 1111 2zm0 2a7 7 0 100 14 7 7 0 000-14zm1 3v3h3v2h-3v3h-2v-3H7v-2h3V7z"/>');function ke(e){return`<svg xmlns="http://www.w3.org/2000/svg" height="20" width="20" viewBox="0 0 24 24">${e}</svg>`}const Te="aria-expanded",Ae="aria-activedescendant",Ie="expand",Ee=/http/gi,_e=/www/gi,Me=new Map,Le=/(\b(https?|ftp):\/\/[-A-Z0-9+&@#/%?=~_|!:,.;]*[-A-Z0-9+&@#/%=~_|])/gim,Pe=/([-+&@#/%?=~_|!:,.;])?(\bwww\.[-A-Z0-9+&@#/%?=~_|!:,.;]*[-A-Z0-9+&@#/%=~_|])/gim;class De{constructor(e){this.openPopupList=[],this.generateMask=e=>{const t=Math.floor(1e4+9e4*Math.random()).toString();return Me.set(t,e),t},this.cssPrefix=e.name,this.locale=e.i18n[e.locale]}addCSSClass(e,...t){e.classList?t.forEach((t=>e.classList.add(`${this.cssPrefix}-${t}`))):e.setAttribute("class",t.reduce(((e,t)=>`${e} ${this.cssPrefix}-${t}`),""))}createAnchor(e,t,s=[],i=!1,o){const a=this.createElement("a",s);a.rel="noreferrer noopener";let n=!1;return a.href=e,a.innerText=t,o&&(o.onclick&&(a.onclick=o.onclick.bind(a),n=!0),o.target&&(a.target=o.target,n=!0)),n||(i?a.addEventListener("click",(t=>(window.open(e,"","height=450px,width=800px,menubar,toolbar,personalbar,status,resizable,noopener,noreferrer"),t.preventDefault(),t.stopPropagation(),!1))):a.target="_blank"),a}createButton(e=[]){const t="button",s=this.createElement(t,[...e,"flex"]);return s.type=t,s}createDiv(e=[]){return this.createElement("div",e)}createElement(e,t=[]){const s=document.createElement(e);return this.addClasses(s,t),s}createElementFromString(e,t=[]){const s=this.createDiv();s.innerHTML=e.trim();const i=s.firstElementChild;return t&&this.addClasses(s.firstElementChild,t),i}createIconButton({css:e,icon:t,title:s,iconCss:i}){const o=this.createButton(["icon",...e]);o.innerHTML="",o.title=s;const a=this.createImageIcon({icon:t,iconCss:i,title:s});return o.appendChild(a),o}createImage(e,t=[],s=""){const i=this.createElement("img",t);return e&&(i.src=e),i.alt=s,i.setAttribute("draggable","false"),i}createImageIcon({icon:e,title:t,iconCss:s}){if((e=>{const t=e.match(/<svg\s/gi);return t&&t.length>0})(e)){const i=this.createElementFromString(e,s);return i.setAttribute("role","img"),t&&i.setAttribute("aria-label",t),i}return this.createImage(e,s,t)}createInputElement(e,t=[]){const s=this.createElement("input",t);return this.setAttributes(s,e),s}setAttributes(e,t){const s=["valueOn","valueOff"];Object.keys(t).forEach((i=>{const o=t[i];o&&("errorMsg"===i?e.setAttribute("data-error",o):s.includes(i)?e.setAttribute(i,o):e[i]=o)}))}createListItem(e,t,s,i,o,a,n=!1,r=!0){const c=this.createElement("li",[o,n&&"with-sub-menu"]);if(c.id=e,c.tabIndex=-1,c.setAttribute("dir","auto"),c.setAttribute("role","menuitem"),s&&c.setAttribute("data-value",s),i){const e=this.createImageIcon({icon:i,iconCss:["icon",`${o}-icon`]});c.appendChild(e)}const l=this.createElement("span",["text",`${o}-text`,r?"ellipsis":""]);return l.innerText=t,c.title=t,c.appendChild(l),a&&Re(c,"click",a),c}createMedia(e,t,s=[]){const i=this.createElement(e,s);return t&&(i.src=t),i.autoplay=!1,i}getBanner(e,t){const s=this.createDiv(["dialog-wrapper"]),i="prompt-banner",o=this.createDiv([`${i}-background`]),a=this.createDiv([`${i}-main-content`,"flex"]),n=this.createDiv([`${i}-content`]),r=this.createDiv([i]);if(e.icon){const t=this.createImageIcon({icon:e.icon,title:""}),s=this.createDiv([`${i}-icon`]);Oe(s,t),Oe(a,s)}const c=this.createDiv([`${i}-text`]);if(c.innerText=e.text,c.setAttribute("role","alert"),Oe(n,c),e.description){const t=this.createDiv([`${i}-description`]);t.innerText=e.description,Oe(n,t)}Oe(a,n),Oe(r,a);const l=e.closeIcon||ee,d=`${i}-close-button`,h=this.createIconButton({css:[d,"flex"],icon:l,title:e.closeText,iconCss:[`${d}-icon`]}),p=`${i}-out`;Re(h,"click",(()=>{this.addCSSClass(r,p),setTimeout((()=>{this.removeCSSClass(r,p),s.remove()}),200)})),e.autoClose&&setTimeout((()=>{h&&h.click()}),6e3);const g=e.actions;if(g&&g.length){const e=this.createDiv(["action-wrapper","flex"]);g.forEach((s=>{const i=["popup-action"];"filled"===s.type&&i.push("filled");const o=this.createButton(i);o.innerHTML=s.label,o.onclick=s.handler.bind(t),e.appendChild(o)})),r.appendChild(e)}return Oe(r,h),Oe(s,o),Oe(s,r),s}getMenu(e){const t=this.createElement("ul",["popup",...e.menuClassList]);t.id=e.menuId,t.tabIndex=-1,t.setAttribute("role","menu"),t.setAttribute("aria-labelledby",e.buttonId);const s=e.menuItems;if(s.forEach((e=>t.appendChild(e))),e.defaultValue){const s=t.querySelector(`[data-value="${e.defaultValue}"]`);this.addCSSClass(s,"active")}return Re(t,"click",(()=>this.popupClose(t,e.menuButton))),Re(t,"keydown",(i=>{let o=!1;if(!(i.ctrlKey||i.altKey||i.metaKey)){if(i.shiftKey&&i.code===r.KeyCode.Tab)this.popupClose(e.menuButton,t);else switch(i.code){case r.KeyCode.Return:case r.KeyCode.Space:i.target.click(),o=!0;break;case r.KeyCode.Esc:case r.KeyCode.Tab:this.popupClose(e.menuButton,t),i.code===r.KeyCode.Esc&&(e.menuButton.focus(),o=!0);break;case r.KeyCode.Up:this.popupFocusPreviousItem(t),o=!0;break;case r.KeyCode.Down:this.popupFocusNextItem(t),o=!0;break;case r.KeyCode.Home:case r.KeyCode.PageUp:this.popupFocusFirstItem(t,s),o=!0;break;case r.KeyCode.End:case r.KeyCode.PageDown:this.popupFocusLastItem(t,s),o=!0}o&&(i.stopPropagation(),i.preventDefault())}})),t}getMenuButton(e){const t=e.button,s=e.menu,i=s.querySelectorAll("li"),o=t.classList.contains(`${this.cssPrefix}-with-sub-menu`);return t.setAttribute("role","button"),t.setAttribute("aria-haspopup","true"),t.setAttribute(Te,"false"),t.setAttribute("aria-controls",e.menuId),Re(t,"click",(()=>{const s=document.getElementById(e.menuId);"true"===t.getAttribute(Te)?this.popupClose(t,s):this.popupOpen(t,s,o)})),Re(t,"keydown",(e=>{let a=!1;switch(e.code){case r.KeyCode.Return:case r.KeyCode.Down:case r.KeyCode.Space:this.popupOpen(t,s,o),this.popupFocusFirstItem(s,i),a=!0;break;case r.KeyCode.Up:this.popupOpen(t,s,o),this.popupFocusLastItem(s,i),a=!0}a&&(e.stopPropagation(),e.preventDefault())})),t}wrapMessageBlock(e,t,s=z.LEFT){const i="message",o=this.createDiv([`${i}-block`,"flex",s]),a=this.createDiv([`${i}s-wrapper`]),n=this.createDiv([`${i}-list`,"flex","col"]);if(t){const e=this.createImageIcon({icon:t,iconCss:["message-icon"],title:s===z.LEFT?this.locale.avatarBot:this.locale.avatarUser}),i=this.createDiv(["icon-wrapper"]);i.appendChild(e),o.appendChild(i)}return n.appendChild(e),a.appendChild(n),o.appendChild(a),o}getMessageBlock(e,t,s,i=!1){const o="message",a=this.createDiv([o]),n=this.createDiv([`${o}-wrapper`]),r=this.createDiv([`${o}-bubble`,i&&"error"]);return r.appendChild(t),n.appendChild(r),a.appendChild(n),this.wrapMessageBlock(a,s,e)}linkify(e,t){t=t||{};const s=this.maskElements(e),i=t.emHTML?s:u(s),o=i&&i.replace((0,r.resetRegex)(Le),((e,s)=>this.parseVideoOrLink(s,t.emVideo))),a=o&&o.replace((0,r.resetRegex)(Pe),((e,s,i)=>s?e:this.parseVideoOrLink(i,t.emVideo,!0))),n=this.unmaskElements(a);Me.clear();return n.replace(/<video/gi,(e=>`${e} class="oda-chat-video-wrapper"`))}removeCSSClass(e,...t){var s,i;if(e.classList)t.forEach((t=>e.classList.remove(`${this.cssPrefix}-${t}`)));else{const t="class",o=null!==(i=null===(s=e.getAttribute(t))||void 0===s?void 0:s.split(" "))&&void 0!==i?i:[];if(o.length){const s=o.filter((e=>o.indexOf(`${this.cssPrefix}-${e}`)<0)).join(" ");e.setAttribute(t,s)}}}setLocale(e){this.locale=e}addClasses(e,t=[]){return e.setAttribute("dir","auto"),t&&this.addCSSClass(e,...t),e}embedYouTube(e){return`<div class="${this.cssPrefix}-youtube-wrapper"><iframe class="${this.cssPrefix}-video-wrapper" src="https://www.youtube.com/embed/${e}" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></div>`}getEmbedOVH(e){return`<div class="${this.cssPrefix}-ovh-wrapper"><iframe class="${this.cssPrefix}-video-wrapper" src="https://cdnapisec.kaltura.com/p/2171811/sp/217181100/embedIframeJs/uiconf_id/35965902/partner_id/2171811?iframeembed=true&playerId=kaltura_player&entry_id=${e}&flashvars[streamerType]=auto&amp;flashvars[localizationCode]=en&amp;flashvars[leadWithHTML5]=true&amp;flashvars[sideBarContainer.plugin]=true&amp;flashvars[sideBarContainer.position]=left&amp;flashvars[sideBarContainer.clickToClose]=true&amp;flashvars[chapters.plugin]=true&amp;flashvars[chapters.layout]=vertical&amp;flashvars[chapters.thumbnailRotator]=false&amp;flashvars[streamSelector.plugin]=true&amp;flashvars[EmbedPlayer.SpinnerTarget]=videoHolder&amp;flashvars[dualScreen.plugin]=true&amp;flashvars[hotspots.plugin]=1&amp;flashvars[Kaltura.addCrossoriginToIframe]=true&amp;&wid=1_yz4xoltb" height="auto" allowfullscreen webkitallowfullscreen mozAllowFullScreen allow="autoplay *; fullscreen *; encrypted-media *" sandbox="allow-forms allow-same-origin allow-scripts allow-top-navigation allow-pointer-lock allow-popups allow-modals allow-orientation-lock allow-popups-to-escape-sandbox allow-presentation allow-top-navigation-by-user-activation" frameborder="0"></iframe></div>`}maskElements(e){const t=this.createDiv();t.innerHTML=e;const s=t.children;for(let e=0;e<s.length;e++)s[e].outerHTML=s[e].outerHTML.replace((0,r.resetRegex)(Ee),this.generateMask).replace((0,r.resetRegex)(_e),this.generateMask);return t.innerHTML}unmaskElements(e){let t=e;return Me.forEach(((e,s)=>{t=t.replace(s,e)})),t}parseVideoOrLink(e,t,s=!1){const i=t?d(e):null;if(i)return this.embedYouTube(i);const o=t?p(e):null;if(o)return this.getEmbedOVH(o);return`<a href="${s?`https://${e}`:e}" target="_blank" rel="noreferrer">${e}</a>`}popupClose(e,t){e.getAttribute(Te)&&(this.removeCSSClass(t,Ie),e.setAttribute(Te,"false"))}popupFocusFirstItem(e,t){this.popupFocusItem(t[0],e)}popupFocusLastItem(e,t){this.popupFocusItem(t[t.length-1],e)}popupFocusPreviousItem(e){const t=e.getAttribute(Ae),s=e.querySelector(`#${t}`);this.popupFocusItem(s.previousSibling||e.lastChild,e)}popupFocusNextItem(e){const t=e.getAttribute(Ae),s=e.querySelector(`#${t}`);this.popupFocusItem(s.nextSibling||e.firstChild,e)}popupFocusItem(e,t){e.focus(),t.setAttribute(Ae,e.id)}popupOpen(e,t,s=!1){if("false"===e.getAttribute(Te)){this.addCSSClass(t,Ie),e.setAttribute(Te,"true");const i=document.querySelector(`.${this.cssPrefix}-widget`),o=i.getBoundingClientRect(),a=e.getBoundingClientRect(),n="rtl"===window.getComputedStyle(t).direction;if(s){const s=48;t.style.top=`${e.offsetTop+e.offsetHeight+60}px`,n?t.style.left=`${s}px`:t.style.right=`${s}px`,t.style.maxWidth=i.offsetWidth-s+"px"}else{let e=o.right-a.right;n?(e=a.left-o.left,t.style.left=`${e}px`):t.style.right=`${e}px`,t.style.maxWidth=i.offsetWidth-e+"px"}setTimeout((()=>{const s=document.querySelectorAll(`.${this.cssPrefix}-with-sub-menu`);document.addEventListener("click",(i=>{let o=!1;s.forEach((e=>{e.contains(i.target)&&(o=!0)})),o?this.openPopupList.push({menu:t,menuButton:e}):(this.openPopupList.length&&this.openPopupList.forEach((e=>{this.popupClose(e.menuButton,e.menu)})),this.popupClose(e,t))}),{once:!0})}))}}}function Oe(e,t){e.appendChild(t)}function Re(e,t,s,i){e.addEventListener(t,s,i)}class Be{remove(){this.element.remove()}appendToElement(e){e.appendChild(this.element)}prependToElement(e){const t=e.firstChild;t?e.insertBefore(this.element,t):e.appendChild(this.element)}appendContentChildElement(e){this._getContentElement().appendChild(e)}appendContentChild(e){this._getContentElement().appendChild(e.element)}_getContentElement(){return this.element}}const ze={SESSION:"sessionStorage",LOCAL:"localStorage"},Fe={CLASSIC:"classic",DEFAULT:"default",REDWOOD_DARK:"redwood-dark"},Ve={AUDIO:"audio",FILE:"file",LOCATION:"location",VISUAL:"visual"},Ne={ARROW_DOWN:"ArrowDown",ARROW_UP:"ArrowUp",ENTER:"Enter"},$e="keyboard",Ue="voice",He={AUDIO:".aac, .amr, .m4a, .mp3, .mp4a, .mpga, .oga, .ogg, .wav, audio/*",FILE:".7z, .csv, .doc, .docx, .eml, .ics, .key, .log, .msg, .neon, .numbers, .odt, .pages, .pdf, .pps, .ppsx, .ppt, .pptx, .rtf, .txt, .vcf, .xls, .xlsx, .xml, .yml, .yaml, application/msword, application/vnd.openxmlformats-officedocument.wordprocessingml.document",IMAGE:".gif, .jfif, .jpeg, .jpg, .png, .svg, .tif, .tiff, .webp, image/*",VIDEO:".3g2, .3gp, .avi, .m4v, .mov, .mp4, .mpeg, .mpg, .ogv, .qt, .webm, .wmv, video/*",ALL:""};He.ALL=`${He.AUDIO},${He.FILE},${He.IMAGE},${He.VIDEO}`;const je=window.setTimeout;class We extends Be{constructor(e,t,s,i,a,n,c,l,d,h,p){if(super(),this.util=e,this.onSend=t,this.onUpload=s,this.settings=i,this.onQueryChange=a,this.onSpeechToggle=n,this.onShareLocation=c,this.sendUserTypingStatusMessage=l,this.eventDispatcher=d,this.widget=h,this.setHotkeyMap=p,this.mode=void 0,this.fileMaxSize=G,this._navKeys=[],this.isDisabledVoiceButtonLang=!1,this.isDisabledVoiceButtonNetwork=!1,this.recognitionRequested=!1,this.isFocusableDevice=!0,this.isTyping=!1,this.triggerTypingEvent=C((()=>{this.eventDispatcher.trigger(o.TYPING,this.isTyping)}),1e3),this.sendTypingStatus=C((e=>{this.sendUserTypingStatusMessage("RESPONDING",this.settings.enableAgentSneakPreview?e:"...")}),this.settings.typingStatusInterval*q),this.cssPrefix=i.name,this.i18n=i.i18n,this.icons=i.icons,this.locale=this.i18n[i.locale],this.isFocusableDevice=!(0,r.isMobile)(),this._shareBtnID=`${this.cssPrefix}-share-button`,this.element=this._createElement(),i.enableSpeech){const e=this._createVoiceComponent();this.element.appendChild(e)}const g=this._createKeyboardComponent();this.element.appendChild(g),this.setInputMode($e),this.disable(),window.addEventListener("resize",y((()=>{this._expand()}),100))}setInputMode(e){e!==this.mode&&(this.settings.enableSpeech?(this.mode=e,this.mode===$e?this._showKeyboardMode():this._showVoiceMode()):(this.mode=$e,this._showKeyboardMode()))}setUserInputText(e,t=!0){this._textArea&&(this._textArea.value=e,this._textArea.setSelectionRange(e.length,e.length),this.focusTextArea(),this.updateSendButton(!t))}getUserInputText(){return this._textArea.value}setUserInputPlaceholder(e){this._textArea&&(this.mode===$e?Je(this._textArea,e):this._inputPlaceholder=e)}setVoiceRecording(e){this.settings.enableSpeech&&(e&&this.recognitionRequested?this.setInputMode(Ue):e||this.setInputMode($e))}updateVisualizer(e,t){this.mode===Ue&&(0,r.drawVisualizer)(e,this._visualizerCanvas,t)}focusTextArea(){this.isFocusableDevice&&this._textArea.focus(),this._textArea.scrollTop=this._textArea.scrollHeight}render(){}disable(e=!0){const t=this.util,s="disabled";this.settings.enableAttachment&&(this._shareButton.disabled=e),e?(t.addCSSClass(this._textArea,s),this.settings.enableAutocomplete&&(this._invalidateSuggestions(),this._removeSuggestionsPopup()),this.updateSendButton(!0)):(t.removeCSSClass(this._textArea,s),this.updateSendButton()),this.settings.enableSpeech&&(this.setInputMode($e),this.disableVoiceModeButton(e,{src:"network"})),this.isFooterDisabled=e}isDisabled(){return this.isFooterDisabled}disableVoiceModeButton(e,{src:t}){if(this.settings.enableSpeech){switch(t){case"lang":this.isDisabledVoiceButtonLang=e;break;case"network":this.isDisabledVoiceButtonNetwork=e}this.settings.multiLangChat&&(this.isDisabledVoiceButtonLang||this.isDisabledVoiceButtonNetwork)?this._switchToVoiceModeButton.disabled=!0:this._switchToVoiceModeButton.disabled=this.isDisabledVoiceButtonNetwork}}displaySuggestions(e){if(this._removeSuggestionsPopup(),0===e.length)this._suggestions=e,this._isSuggestionsValid=!1;else if(this._textArea.value){this._currentSuggestionFocus=e.length>H.MAX_SUGGESTIONS_COUNT?H.MAX_SUGGESTIONS_COUNT:e.length<H.MIN_SUGGESTIONS_COUNT?H.MIN_SUGGESTIONS_COUNT:e.length,this._suggestions=e,this._isSuggestionsValid=!0;const t=this.util.createDiv(this.settings.enableAttachment?["autocomplete-items"]:["autocomplete-items","no-attach"]);t.setAttribute("role","list");const s=this._textArea.value.trim();t.id=We.SUGGESTIONS_ID;for(let i=this._currentSuggestionFocus-1;i>-1;i--){const o=this._createSuggestionListItem(e[i],s);t.appendChild(o)}this.element.appendChild(t)}}getSuggestions(){return this._suggestions}getSuggestionsValid(){return this._isSuggestionsValid}setLocale(e){if(this.locale=e,this._shareButton){const t=e.upload;qe(this._uploadFileInput,t),this._shareMenu.querySelectorAll("li").forEach((e=>{const t=e.dataset.value,s=this.locale[`share${t.charAt(0).toUpperCase()+t.substring(1).toLowerCase()}`]||this.locale[t]||e;e.querySelector("span").innerText=s}))}this.setUserInputPlaceholder(e.inputPlaceholder),this._sendButton&&Ye(this._sendButton,e.send),this._switchToVoiceModeButton&&Ye(this._switchToVoiceModeButton,e.speak)}_createElement(){return this.util.createDiv(["footer"])}_showKeyboardMode(){var e;const t=this.util;t.removeCSSClass(this.element,"mode-voice"),t.addCSSClass(this.element,"mode-keyboard"),Ke(this._textArea,this._inputPlaceholder),this._textArea.disabled=!1,this.updateSendButton(),this.settings.enableAutocomplete&&(null===(e=this._textArea.value)||void 0===e?void 0:e.trim().length)>=3&&this._setSuggestionsRequestTimer()}_showVoiceMode(){const e=this.util;e.removeCSSClass(this.element,"mode-keyboard"),e.addCSSClass(this.element,"mode-voice"),this._inputPlaceholder=this._textArea.placeholder,Ke(this._textArea,this.locale.recognitionTextPlaceholder),this._textArea.disabled=!0,this.updateSendButton(),this._textArea&&this._removeSuggestionsPopup()}_createKeyboardComponent(){const e=this.util,t=e.createDiv(["footer-mode-keyboard","flex"]);this._textArea=this._createInputTextArea(),t.appendChild(this._textArea);const s=e.createDiv(["footer-actions","flex"]),i=this._createSendMessageButton();if(this._sendButton=i,this.setHotkeyMap("send",i),s.appendChild(i),this.settings.enableSpeech){this._switchToVoiceModeButton=this._createVoiceSwitchButton(),s.appendChild(this._switchToVoiceModeButton);const e=this._createKeyboardSwitchButton();s.appendChild(e)}if(this.settings.enableAttachment){const e=this._createShareComponent();s.appendChild(e)}return t.appendChild(s),t}_createShareComponent(){const e=this.util,t=e.createDiv(),s=Ge(this.util,{css:["button-upload","flex"],customIcon:this.icons.shareMenu,defaultIcon:K,title:this.locale.upload});s.id=this._shareBtnID;const i=e.createElement("input",["none"]);i.type="file",i.tabIndex=-1,i.setAttribute("aria-hidden","true"),qe(i,this.locale.upload),this._uploadFileInput=i,this._shareMenu=this._getShareMenu(s);const o=e.getMenuButton({button:s,menuId:this._shareMenu.id,menu:this._shareMenu});return Re(o,"click",(e=>{this._removeSuggestionsPopup()})),this._shareButton=o,this.setHotkeyMap("shareMenu",o),document.addEventListener("deviceready",(()=>{const e=globalThis?globalThis.device:window?window.device:void 0;"Android"===(null==e?void 0:e.platform)&&this._uploadFileInput.removeAttribute("accept")}),!1),Re(i,"click",(()=>i.value=null)),Re(i,"change",(e=>{const t=e.target;t.files&&t.files.length&&this._onUpload(t.files[0])})),t.appendChild(this._shareButton),t.appendChild(this._shareMenu),t.appendChild(i),t}_getShareMenu(e){return this.util.getMenu({menuId:`${this.settings.name}-share-menu`,menuClassList:["share-popup-list"],buttonId:this._shareBtnID,menuItems:this._getShareItems(),menuButton:e})}_getShareItems(){const e=this.util,t=this.icons,s=this.locale,i=this._uploadFileInput,o=`${this.cssPrefix}-share-`;let a=this.settings.shareMenuItems;const n=[],r=[Ve.AUDIO,Ve.FILE,Ve.LOCATION,Ve.VISUAL],c=new Set;if((null==a?void 0:a.length)&&!a.every((e=>"string"==typeof e&&r.indexOf(e.toLowerCase())<0))||(a=r),a.forEach((e=>{"string"==typeof e&&c.add(e.toLowerCase())})),c.has(Ve.VISUAL)){const a=`${o}visual`,r=t.shareMenuVisual||ve,c=e.createListItem(a,s.shareVisual,"visual",r,"share-popup-item",(()=>{i.accept=`${He.IMAGE},${He.VIDEO}`,i.click()}));n.push(c),this.setHotkeyMap("shareMenuVisual",c)}if(c.has(Ve.AUDIO)){const a=`${o}audio`,r=t.shareMenuAudio||me,c=e.createListItem(a,s.shareAudio,"audio",r,"share-popup-item",(()=>{i.accept=He.AUDIO,i.click()}));n.push(c),this.setHotkeyMap("shareMenuAudio",c)}if(c.has(Ve.FILE)){const a=`${o}file`,r=t.shareMenuFile||be,c=e.createListItem(a,s.shareFile,"file",r,"share-popup-item",(()=>{i.accept=He.FILE,i.click()}));n.push(c),this.setHotkeyMap("shareMenuFile",c)}if(c.has(Ve.LOCATION)){const i=`${o}location`,a=t.shareMenuLocation||fe,r=e.createListItem(i,s.shareLocation,"location",a,"share-popup-item",(()=>this.onShareLocation()));n.push(r),this.setHotkeyMap("shareMenuLocation",r)}const l=t.shareMenuFile||be;return this.settings.shareMenuItems.filter((e=>"string"!=typeof e&&"string"==typeof e.type)).forEach((t=>{const o=t.type.toLowerCase(),a=`share_${o.indexOf("*")>=0?"all":o.replace(/ /g,"_")}`,r=`${this.cssPrefix}-${a}`,c=s[a]||this.i18n.en[a];let d=t.label;c?d=c:this.i18n.en[a]=d;const h=t.icon||l,p=t.maxSize&&t.maxSize>=1?Math.min(t.maxSize*W,G):G,g=o.indexOf("*")>=0?He.ALL:o.split(" ").filter((e=>He.ALL.indexOf(e)>=0)).map((e=>`.${e} `)).join(",");n.push(e.createListItem(r,d,a,h,"share-popup-item",(()=>{this.fileMaxSize=p,i.accept=g,i.click()})))})),n}_createInputTextArea(){const e=["user-input"];this.settings.enableSpeech&&e.push("user-input-inline-send");const t=this.util.createElement("textarea",e);return Ke(t,this.locale.inputPlaceholder),this._inputPlaceholder=this.locale.inputPlaceholder,t.rows=1,t.onkeydown=this.onInputKeyDown.bind(this),t.onkeyup=this.onInputKeyUp.bind(this),t.oninput=()=>{const e=t.value;this.widget.speechFinalResult=this.widget.speechFinalResult||{speechId:"",text:""},this.widget.speechFinalResult.text=e,this._expand()},Re(t,"paste",(()=>{this.isFooterDisabled||je(this.updateSendButton.bind(this))})),this._handleInputChange(t),this.setHotkeyMap("input",t),t}_handleInputChange(e){const t=Object.getOwnPropertyDescriptor(HTMLTextAreaElement.prototype,"value");Object.defineProperty(e,"value",{set:s=>{t.set.call(e,s),this.updateSendButton(),this._expand()},get:t.get})}_createSendMessageButton(){const e=Ge(this.util,{css:["button-send"],customIcon:this.icons.send,defaultIcon:ue,title:this.locale.send});return e.onclick=()=>{var e;this._isUserInputEmpty()||(this._previousInputValue=void 0,this._textArea.value=null===(e=this._textArea)||void 0===e?void 0:e.value.trim(),this.settings.enableAutocomplete&&(this._invalidateSuggestions(),this._removeSuggestionsPopup()),this._onSend())},e}_createVoiceSwitchButton(){const e=Ge(this.util,{css:["button-switch-voice"],customIcon:this.icons.mic,defaultIcon:he,title:this.locale.speak});return e.onclick=()=>{this.onSpeechToggle(!0),this.recognitionRequested=!0},this.setHotkeyMap("mic",e),e}_createVoiceComponent(){const e=this.util,t=e.createDiv(["footer-mode-voice","flex"]),s=e.createDiv(["footer-visualizer-wrapper"]);return this._visualizerCanvas=e.createElement("canvas"),this._visualizerCanvas.width=244,this._visualizerCanvas.height=32,s.appendChild(this._visualizerCanvas),t.appendChild(s),t}_createKeyboardSwitchButton(){const e=Ge(this.util,{css:["button-switch-kbd"],customIcon:this.icons.keyboard,defaultIcon:re,title:this.locale.inputPlaceholder});return e.onclick=()=>{this.recognitionRequested=!1,this.onSpeechToggle(!1)},this.setHotkeyMap("keyboard",e),e}updateSendButton(e=!1){const t=this._sendButton;if(t&&t.nodeType){const s=this.util,i="none",o=this._textArea;this._sendButton.disabled=e,o&&o.value&&o.value.trim().length&&this.mode!==Ue?s.removeCSSClass(this._sendButton,i):s.addCSSClass(t,i)}}_isUserInputEmpty(){return!this._textArea||0===this._textArea.value.trim().length}onInputKeyDown(e){var t;this.isDisabled()||e.isComposing||229===e.keyCode||e.key===r.KeyCode.Return&&!e.shiftKey&&(null===(t=this._textArea.value)||void 0===t?void 0:t.trim().length)>0&&(e.preventDefault(),this._sendButton.click())}onInputKeyUp(e){var t;const s=null===(t=this._textArea.value)||void 0===t?void 0:t.trim();if(this.isDisabled())return this._invalidateSuggestions(),void this._removeSuggestionsPopup();if(this.triggerTypingEvent(),this.settings.enableSendTypingStatus&&(s?(this.sendTypingStatus(s),clearTimeout(this.listeningStatusTimer),this.listeningStatusTimer=je((()=>{this.sendUserTypingStatusMessage("LISTENING")}),this.settings.typingStatusInterval*q)):this.sendUserTypingStatusMessage("LISTENING")),this.updateSendButton(),!e.isComposing&&!this.isFooterDisabled&&this.settings.enableAutocomplete){if(this._onNavigateSuggestion(e))return;e.code===r.KeyCode.Backspace&&(this._previousInputValue=void 0,this._invalidateSuggestions(),this._removeSuggestionsPopup(),clearTimeout(this._suggestionsRequest)),this._getNavKeys().indexOf(e.code)<0&&(s.length>=3?this._previousInputValue!==this._textArea.value&&(this._previousInputValue=this._textArea.value,clearTimeout(this._suggestionsRequest),this._setSuggestionsRequestTimer()):(this._previousInputValue=void 0,this._removeSuggestionsPopup(),clearTimeout(this._suggestionsRequest)))}}_expand(){this._textArea.style.height=null;const e=.6*this.widget.chatWidgetDiv.clientHeight,t=this._textArea.scrollHeight;this._textArea.style.height=`${t<e?t:e}px`}_onNavigateSuggestion(e){let t=!1;const s=document.getElementById(We.SUGGESTIONS_ID);if(s){const i=s.getElementsByTagName("div");e.code===r.KeyCode.Down?(e.preventDefault(),this._currentSuggestionFocus<i.length-1?(this._currentSuggestionFocus++,this._addActive(i)):(this._removeActive(i),this._textArea.value=this._currentInputValue?this._currentInputValue:this._textArea.value,this._currentSuggestionFocus=i.length),t=!0):e.code===r.KeyCode.Up&&(e.preventDefault(),this._currentSuggestionFocus===i.length&&(this._currentInputValue=this._textArea.value),this._currentSuggestionFocus>0&&this._currentSuggestionFocus--,this._addActive(i),t=!0)}return t}_addActive(e){e&&(this._removeActive(e),this.util.addCSSClass(e[this._currentSuggestionFocus],"autocomplete-active"),e[this._currentSuggestionFocus].scrollIntoView(),this._textArea.value=e[this._currentSuggestionFocus].innerText)}_removeActive(e){for(const t of e)this.util.removeCSSClass(t,"autocomplete-active")}_removeSuggestionsPopup(){const e=document.getElementById(We.SUGGESTIONS_ID);e&&e.remove()}_onSend(){this.onSend(this._textArea.value),this._textArea.value="",this._textArea.innerText="",je(this._expand.bind(this))}_onUpload(e){const t=this.fileMaxSize;this.fileMaxSize=G,this.onUpload(e,{maxSize:t}),this._uploadFileInput.value=""}_onQueryChange(){this.onQueryChange(this._textArea.value.trim()).catch((()=>{}))}_setSuggestionsRequestTimer(){this._suggestionsRequest=je((()=>{this._onQueryChange()}),300)}_invalidateSuggestions(){this._suggestions=null,this._isSuggestionsValid=!1}_getNavKeys(){if(!this._navKeys.length)for(const e of Object.keys(Ne))this._navKeys.push(Ne[e]);return this._navKeys}_createSuggestionListItem(e,t){const s=this.util,i=s.createDiv();i.setAttribute("role","listitem"),i.onclick=()=>{this._textArea.value=i.innerText,this._removeSuggestionsPopup(),this._sendButton.click()};const o=new RegExp(t,"i"),a=e.match(o);if(a){if(0!==a.index){const t=s.createElement("span");t.textContent=e.substr(0,a.index),i.appendChild(t)}const o=s.createElement("strong");if(o.textContent=e.substr(a.index,t.length),i.appendChild(o),a.index+t.length!==e.length){const o=s.createElement("span");o.textContent=e.substring(a.index+t.length),i.appendChild(o)}}else i.textContent=e;return i}}function Ge(e,{css:t,customIcon:s,defaultIcon:i,title:o}){const a=s||i;return e.createIconButton({css:["footer-button","flex"].concat(t),icon:a,iconCss:[],title:o})}function qe(e,t){Ye(e,t),Ze(e,t)}function Ke(e,t){Je(e,t),Ze(e,t)}function Ye(e,t){e.title=t}function Je(e,t){e.placeholder=t}function Ze(e,t){e.setAttribute("aria-label",t)}We.SUGGESTIONS_ID="chat_widget_suggestions";const Xe="end-conversation",Qe="collapse",et="clear",tt="tts";class st extends Be{constructor(e,t,s,i,o,a,n,r){super(),this.settings=e,this.util=t,this.onClose=s,this.onClearMessage=i,this.onAudioToggle=o,this.core=a,this.onEndConversation=n,this.setHotkeyMap=r,this.logger=new R("ChatHeaderComponent"),this.headerActions=[],this.menuActions=[],this.cssPrefix=e.name,this.i18n=this.settings.i18n}render(){this.element=this._createElement(),this.settings.showConnectionStatus&&this.core.on(i.g.State,(e=>this.updateStatusMessage(e))),this.disable()}addLanguageSelect(e){const t=!(!this.menuActions||!this.menuActions.length);this.multiLangControl=e.render(t),this.setHotkeyMap("language",this.multiLangControl),this.multiLangControl&&(t?this.actionsMenu.appendChild(this.multiLangControl):this.actionsContainer.prepend(this.multiLangControl))}closeWidgetPopup(){this.onClose()}clearHistory(){this.onClearMessage()}showTTSButton(e){const t=this.findActionElement(tt);t&&(t.style.display=e?"flex":"none")}disableTTSButton(e){const t=this.findActionElement(tt);if(t){const s=this.util;if("LI"===t.tagName){const i="disable";e?s.addCSSClass(t,i):s.removeCSSClass(t,i)}else t.disabled=e}}setLocale(e){var t;const s=`${this.cssPrefix}-none`;this.currentTranslations=e;const i=e.chatTitle;i&&(this.title.innerText=i,this.title.title=i,this.logo&&(this.logo.title=i));const o=e.chatSubtitle;function a(e,t){if("LI"===e.tagName){const s=e.querySelector("svg")||e.querySelector("img");"img"===s.localName?s.alt=t:s.setAttribute("aria-label",t),e.querySelector("span").innerText=t}else e.title=t}o?(this.subtitle.innerText=o,this.subtitle.title=o,this.subtitle.classList.remove(s),this.networkStatus.classList.add(s)):this.settings.showConnectionStatus&&(this.updateStatusMessage(this.chatStatus),this.networkStatus.classList.remove(s),this.subtitle.classList.add(s)),null===(t=this.headerActions)||void 0===t||t.forEach((t=>{a(t.element,e[t.title])})),this.multiLangControl&&a(this.multiLangControl,e.languageSelectDropdown)}disable(e=!0){if(this.settings.enableEndConversation)for(const t of this.headerActions)t.name===Xe&&(t.element.disabled=e)}addAction(e){this.headerActions.push(e)}_createElement(){var e;const t=this.util,s=this.settings,i=s.icons,o=t.createDiv(["header","flex"]),a=t.createDiv(["header-info-wrapper"]),n=t.createDiv(["header-actions","flex"]),r=s.locale,c=this.i18n[r],l=c.chatTitle,d=c.chatSubtitle;if(!("logo"in i)||i.logo){const e=t.createImageIcon({icon:i.logo||de,iconCss:["logo"],title:l});o.appendChild(e),this.logo=e}if(l){const e=t.createDiv(["title"]);e.id=`${s.name}-title`,e.innerText=l,e.title=l,a.appendChild(e),this.title=e}this.subtitle=t.createDiv(["subtitle"]),a.appendChild(this.subtitle),this.networkStatus=t.createDiv(["connection-status","disconnected"]),a.appendChild(this.networkStatus),d?(this.subtitle.innerText=d,this.subtitle.title=d,s.showConnectionStatus=!1,this.networkStatus.classList.add(`${this.cssPrefix}-none`)):s.showConnectionStatus&&(this.networkStatus.innerText=c.disconnected,this.networkStatus.title=this.networkStatus.innerText,this.subtitle.classList.add(`${this.cssPrefix}-none`)),o.appendChild(a);const h=t.createDiv(["header-gap"]);if(o.appendChild(h),s.customHeaderElementId){const e=document.getElementById(s.customHeaderElementId);if(e){const s=t.createDiv(["header-custom-element"]);s.appendChild(e),o.appendChild(s)}else this.logger.error(`Could not find element with ID '${s.customHeaderElementId}'. No custom element added to the chat header.`)}if(this.actionsContainer=n,s.enableEndConversation){const e=i.close||ee;this.headerActions.push({name:Xe,title:"endConversation",icon:e,clickHandler:this.onEndConversation.bind(this),order:10})}if(!s.embedded){const e=i.collapse||te;this.headerActions.push({name:Qe,title:"close",icon:e,clickHandler:this.closeWidgetPopup.bind(this),order:20})}if(s.enableBotAudioResponse&&(this._audioActionElemOn=!s.initBotAudioMuted,this.headerActions.push({name:tt,title:this._audioActionElemOn?"audioResponseOn":"audioResponseOff",icon:this._audioActionElemOn?i.ttsOn||xe:i.ttsOff||we,clickHandler:()=>{this._audioActionElemOn=!this._audioActionElemOn,this.setAudioResponseIcon(c),this.onAudioToggle(this._audioActionElemOn)},order:30})),s.enableClearMessage){const e=i.clearHistory||Q;this.headerActions.push({name:et,title:"clear",icon:e,clickHandler:this.clearHistory.bind(this),order:40})}return this.headerActions.sort(((e,t)=>e.order>t.order?1:-1)),null===(e=this.headerActions)||void 0===e||e.forEach(((e,s)=>{const i=this.settings.multiLangChat?this.headerActions.length+1:this.headerActions.length;if(!this.settings.enableHeaderActionCollapse||s<2&&!(i>2&&1===s)){const s=t.createIconButton({css:["header-button"],icon:e.icon,iconCss:[],title:c[e.title]});s.onclick=e.clickHandler,this.mapActionElems(e,s),e.element=s,this.actionsContainer.prepend(s)}else this.menuActions.push(e)})),this.menuActions&&this.menuActions.length&&this.createActionMenu(this.menuActions),o.appendChild(n),o}mapActionElems(e,t){switch(t.id=`${this.cssPrefix}-${e.name}`,e.name){case Xe:this.setHotkeyMap("close",t);break;case Qe:case tt:this.setHotkeyMap(e.name,t);break;case et:this.setHotkeyMap("clearHistory",t)}}createActionMenu(e){const t=this.util,s=this.currentTranslations||this.i18n[this.settings.locale],i=`${this.settings.name}-action-menu`,o=`${i}-button`,a=e.map((e=>{const i=t.createListItem(`action-menu-option-${e.name}`,s[e.title],e.name,e.icon,"action-item",e.clickHandler);return this.mapActionElems(e,i),e.element=i,i})),n=t.createIconButton({css:["header-button","button-close"],icon:'<svg xmlns="http://www.w3.org/2000/svg" height="20" width="20" viewBox="0 0 20 20"><path d="M4.99935 9.99967C4.99935 10.9201 4.25316 11.6663 3.33268 11.6663C2.41221 11.6663 1.66602 10.9201 1.66602 9.99967C1.66602 9.0792 2.41221 8.33301 3.33268 8.33301C4.25316 8.33301 4.99935 9.0792 4.99935 9.99967Z" fill="#161513"/><path d="M11.666 9.99967C11.666 10.9201 10.9198 11.6663 9.99935 11.6663C9.07887 11.6663 8.33268 10.9201 8.33268 9.99967C8.33268 9.0792 9.07887 8.33301 9.99935 8.33301C10.9198 8.33301 11.666 9.0792 11.666 9.99967Z" fill="#161513"/><path d="M18.3327 9.99967C18.3327 10.9201 17.5865 11.6663 16.666 11.6663C15.7455 11.6663 14.9993 10.9201 14.9993 9.99967C14.9993 9.0792 15.7455 8.33301 16.666 8.33301C17.5865 8.33301 18.3327 9.0792 18.3327 9.99967Z" fill="#161513"/></svg',iconCss:[],title:this.i18n[this.settings.locale].showOptions}),r=t.getMenu({menuId:i,menuClassList:["action-menu"],menuItems:a,buttonId:o,menuButton:n}),c=t.getMenuButton({button:n,menuId:i,menu:r});this.actionsContainer.prepend(c),this.actionsContainer.appendChild(r),this.actionsMenu=r}findAction(e){for(const t of this.headerActions)if(t.name===e)return t;return null}findActionElement(e){var t;return null===(t=this.findAction(e))||void 0===t?void 0:t.element}setAudioResponseIcon(e){const t=this.settings.icons,s=this.findAction(tt);s.title=this._audioActionElemOn?"audioResponseOn":"audioResponseOff",s.icon=this._audioActionElemOn?t.ttsOn||xe:t.ttsOff||we,this.updateHeaderAction(tt)}updateHeaderAction(e){const t=this.util,s=this.currentTranslations||this.i18n[this.settings.locale],i=this.findAction(e),o=this.findActionElement(e);if(o){o.innerHTML="";const e=s[i.title],a=i.icon,n="LI"===o.tagName,r=t.createImageIcon({icon:a,iconCss:[n?"icon":"","action-item-icon"],title:e});if(n){o.appendChild(r);const s=t.createElement("span",["text","action-item-text","ellipsis"]);s.innerText=e,o.appendChild(s)}else o.appendChild(r),o.title=e}}updateStatusMessage(e){const t=this.util,s="connecting",o="connected",a="disconnected",n=this.networkStatus;this.chatStatus=e;const r=this.currentTranslations||this.i18n[this.settings.locale];switch(e){case i.e.Open:n.innerText=r.connected,t.removeCSSClass(n,s,a),t.addCSSClass(n,o);break;case i.e.Closed:n.innerText=r.disconnected,t.removeCSSClass(n,s,o),t.addCSSClass(n,a);break;case i.e.Closing:n.innerText=r.closing,t.removeCSSClass(n,o,a),t.addCSSClass(n,s);break;case i.e.Connecting:n.innerText=r.connecting,t.removeCSSClass(n,o,a),t.addCSSClass(n,s)}n.title=n.innerText}}class it extends Be{constructor(e){super(),this.element=e.createDiv(["conversation"])}render(){}}class ot{static capitalize(e){return e.charAt(0).toUpperCase()+e.slice(1)}constructor(e,t,s,i,o){this.settings=e,this.util=t,this.side=i,this.hasActions=o,this._url=s.url,this._type=s.type;const a=s.url.split("/");this._title=decodeURI(s.title||a[a.length-1])}createDownloadButton(e){const t=this.util,s=this.settings,i=t.createElement("a"),o=t.createIconButton({css:["attachment-control-icon","attachment-button","flex"],icon:s.icons.download||se,iconCss:["attachment-download-icon"],title:s.i18n[s.locale].download});return i.setAttribute("href",e),i.setAttribute("download",""),i.setAttribute("target","_blank"),i.appendChild(o),i}createAttachment(e,t){const s=this.util,o=this.settings,a=s.createDiv(["attachment"]),n=s.createDiv(["attachment-placeholder","flex"]),r=s.createDiv(["attachment-icon"]),c=s.createImageIcon({icon:e,title:""});r.appendChild(c);const l=this._title,d=s.createDiv(["attachment-footer","flex",this.hasActions&&"with-actions"]),h=s.createElement("label",["attachment-title"]),p=s.createDiv(["attachment-controls","flex"]);if(h.innerText=l,h.setAttribute("title",l),d.appendChild(h),this._type===i.c.Image){const e=s.createIconButton({css:["attachment-control-icon","attachment-button","flex"],icon:o.icons.expandImage||Se,iconCss:["attachment-expand-icon"],title:o.i18n[o.locale].imageViewerOpen});e.onclick=()=>{this.createImagePreview(this._url,l)},p.appendChild(e)}if(this.side===z.LEFT&&p.appendChild(this.createDownloadButton(this._url)),t)switch(n.appendChild(t),t.onerror=()=>{t.remove(),n.appendChild(r)},this._type){case i.c.Image:t.onload=()=>{t.clientHeight>211&&(n.style.alignItems="flex-start"),d.appendChild(p)},t.onclick=()=>{this.createImagePreview(this._url,this._title)};break;case i.c.Audio:case i.c.Video:t.onloadeddata=()=>{d.appendChild(p)}}else n.appendChild(r),d.appendChild(p);return a.appendChild(n),null==a||a.appendChild(d),a}createImagePreview(e,t){const s=this.util,i="image-preview",o=this.settings,a=s.createDiv([`${i}-wrapper`]),n=s.createImage(e,[i]),r=s.createElement("label",[`${i}-title`]);r.innerText=t;const c=document.querySelector(`.${this.settings.name}-wrapper`),l=o.icons.close||ee,d=s.createIconButton({css:[`${i}-close`],icon:l,iconCss:[`${i}-close-icon`],title:o.i18n[o.locale].imageViewerClose});d.onclick=()=>{a.remove()},d.onkeydown=e=>{"Tab"===e.code&&(a.focus(),e.preventDefault())};const h=s.createDiv([`${i}-header`]);h.appendChild(r),h.appendChild(d),a.appendChild(h),a.appendChild(n),a.setAttribute("tabindex","-1"),a.onkeydown=e=>{"Escape"===e.code&&a.remove()},c.appendChild(a),a.focus()}}class at extends ot{render(){const e=this.util,t=this.settings,s=t.icons.fileAudio||Y,i=e.createMedia("video",this._url,["attachment-audio"]);i.controls=!0,i.preload="metadata",z.RIGHT===this.side&&i.setAttribute("controlsList","nodownload");const o=`<a href="${this._url}">`,a=t.i18n[t.locale].attachmentAudioFallback.replace("{0}",o).replace("{/0}","</a>");return i.innerHTML=a,t.linkHandler?m(i,t.linkHandler):t.openLinksInNewWindow&&b(i),this.createAttachment(s,i)}}class nt extends ot{render(){const e=this.settings.icons.fileGeneric||ae;return this.createAttachment(e)}}class rt extends ot{render(){const e=this.util,t=this.settings.icons.fileImage||ne,s=e.createImage(this._url,["attachment-image"],this._title);return this.createAttachment(t,s)}}class ct extends ot{render(){const e=this.util,t=this.settings,s=t.icons.fileVideo||ye;if(d(this._url)){const s=e.createElement("span");return s.innerHTML=e.linkify(this._url,{emHTML:!0,emVideo:t.embeddedVideo}),s}const i=e.createMedia("video",this._url,["attachment-video"]);i.controls=!0,i.preload="metadata",z.RIGHT===this.side&&i.setAttribute("controlsList","nodownload");const o=`<a href="${this._url}">`,a=t.i18n[t.locale].attachmentVideoFallback.replace("{0}",o).replace("{/0}","</a>");return i.innerHTML=a,this.settings.linkHandler?m(i,t.linkHandler):this.settings.openLinksInNewWindow&&b(i),this.createAttachment(s,i)}}class lt extends F{static fromPayload(e,t,s,o,a,n=!1){if(a&&a.authToken&&a.uri&&s.url.indexOf(a.uri)>=0&&!this.tokenRegex.test(s.url)){const e=null==a?void 0:a.authToken;(null==e?void 0:e.length)&&(s.url=`${s.url}?token=${e}`)}switch(s.type){case i.c.Image:return new rt(e,t,s,o,n);case i.c.Video:return new ct(e,t,s,o,n);case i.c.Audio:return new at(e,t,s,o,n);case i.c.File:return new nt(e,t,s,o,n);default:throw Error("Payload contains wrong attachment type")}}constructor(e,t,s,i,o,a){super(e,t,s,i,o,a),this._attachment=lt.fromPayload(e,t,s.attachment,i,a,this.hasActions())}getContent(){return super.getContent(this._attachment.render())}}lt.tokenRegex=/token=[a-z\.\d]+/i;class dt{constructor(e,t,s,i,o){var a;if(this.settings=e,this.util=t,this.options=o,this._actions=[],this._postActions=[],this._title=s.title,this._description=s.description,this._imageUrl=s.imageUrl,this._url=s.url,s.actions){for(const i of s.actions){const s=(this._title?`${this._title} - `:"")+(this._description?`${this._description} - `:"")+(null!==(a=this._url)&&void 0!==a?a:""),n=B.fromActionPayload(i,t,e.openLinksInNewWindow,s,e.linkHandler,o);n&&(n.onActionClick=this.handleOnActionClick.bind(this),this._actions.push(n))}this._postActions=I(this._actions)}}handleOnActionClick(e){this.onActionClick&&this.onActionClick(e)}render(){const e=this.util,t=this.settings,s=t.locale,i=this._url,o=e.createDiv(["card"]),a=i?e.createAnchor(i,"",["card-component"],t.openLinksInNewWindow,t.linkHandler):e.createDiv(["card-content"]);if(this._url&&(a.innerText=""),this._imageUrl){const i=t.i18n;let o=i[s].cardImagePlaceholder;if(this.options&&this.options.locale){const e=i[this.options.locale];o=e?e.cardImagePlaceholder:o}a.appendChild(e.createImage(this._imageUrl,["card-image"],o))}const n={emHTML:!0,emVideo:t.embeddedVideo},r=e.createDiv(["card-title"]);if(r.innerHTML=e.linkify(this._title,n),a.appendChild(r),this._description){const t=e.createDiv(["card-description"]);t.innerHTML=e.linkify(this._description,n),a.appendChild(t)}if(o.appendChild(a),t.linkHandler?m(a,t.linkHandler):t.openLinksInNewWindow&&b(a),this._actions.length>0){const s=e.createDiv("horizontal"!==t.cardActionsLayout?["card-actions","col"]:["card-actions"]);let i=!0;for(const e of this._actions){const t=e.render();i&&(this.firstActionButton=t,i=!1),s.appendChild(t)}o.appendChild(s)}return o}hasActions(){return this._actions.length>0}disableActions(){this._actions.forEach((e=>e.disable()))}disablePostbacks(){this._postActions.forEach((e=>e.disable()))}enableActions(){this._actions.forEach((e=>e.enable()))}enablePostbacks(){this._postActions.forEach((e=>e.enable()))}getFirstActionButton(){return this.firstActionButton}}class ht extends F{constructor(e,t,s,i,o,a){super(e,t,s,i,o,a),this.cards=[],this.layout=s.layout,this.numCards=s.cards.length;let n=0;s.cards.forEach((e=>{n++,this.cards.push(new dt(this.settings,t,e,n,a))})),this.globalActions=this.actions.concat(this.globalActions),this.actions=[]}hasActions(){return this.cards[0].hasActions()||this.actions.length>0||this.globalActions.length>0}disableActions(){super.disableActions(),this.cards.forEach((e=>{e.disableActions()}))}disablePostbacks(){super.disablePostbacks(),this.cards.forEach((e=>{e.disablePostbacks()}))}enableActions(){super.enableActions(),this.cards.forEach((e=>{e.enableActions()}))}enablePostbacks(){super.enablePostbacks(),this.cards.forEach((e=>{e.enablePostbacks()}))}render(){const e=this.util,t=this.settings.name,s=[`card-message-${this.layout}`],i=super.render();if(i.querySelector(`.${t}-icon-wrapper`)){s.push("has-message-icon");const o=i.querySelector(`.${t}-content-wrapper`);e.addCSSClass(o,"with-icon")}return e.addCSSClass(i,...s),i}getContent(){const e=this.util,t=e.createDiv(["card-message-content"]),s=e.createDiv(["card-message-cards"]);let i=!0;if(this.cards.forEach((e=>{e.onActionClick=this.handleOnActionClick.bind(this);const t=e.render();i&&e.hasActions()&&(this.firstActionButton=e.getFirstActionButton(),i=!1),s.appendChild(t)})),t.appendChild(s),"horizontal"===this.layout&&this.numCards>1){let e;t.appendChild(this.getNextButton()),this.activeCard=0,s.addEventListener("scroll",(()=>{window.clearTimeout(e),e=window.setTimeout((()=>{let e=0;for(let t=0;t<this.numCards;t++){const i=s.children[t];if(s.scrollLeft<=i.offsetLeft+5){e=t;break}}e!==this.activeCard&&(this.activeCard=e,this.updateCardsScrollState())}),100)})),window.addEventListener("resize",y((()=>{this.showHideNavButtons()}),500))}this.content=t,this.cardsWrapper=s;return new IntersectionObserver((e=>{e.forEach((e=>{e.isIntersecting&&this.showHideNavButtons()}))}),{root:document.querySelector(".oda-chat-conversation")}).observe(s),t}getNextButton(){if(!this.nextButton){const e=this.util,t=this.translations.cardNavNext;this.nextButton=e.createDiv(["next-wrapper"]);const s=e.createButton(["round","next"]);s.title=t,s.setAttribute("aria-label",t);const i=e.createElementFromString(Z);i.setAttribute("role","img"),i.setAttribute("aria-label",t),s.appendChild(i),s.onclick=this.showNextCard.bind(this),this.nextButton.appendChild(s)}return this.nextButton}getPreviousButton(){if(!this.prevButton){const e=this.util,t=this.translations.cardNavPrevious;this.prevButton=e.createDiv(["prev-wrapper"]);const s=e.createButton(["round","previous"]);s.title=t,s.setAttribute("aria-label",t);const i=e.createElementFromString(X);i.setAttribute("role","img"),i.setAttribute("aria-label",t),s.appendChild(i),s.onclick=this.showPrevCard.bind(this),this.prevButton.appendChild(s)}return this.prevButton}showNextCard(){this.activeCard<this.numCards&&(this.activeCard++,this.updateCardsScrollState())}showPrevCard(){this.activeCard>0&&(this.activeCard--,this.updateCardsScrollState())}updateCardsScrollState(){var e,t,s,i;const o=this.cardsWrapper.children[this.activeCard];o&&(this.cardsWrapper.scrollLeft=o.offsetLeft-56,0===this.activeCard?null===(e=this.prevButton)||void 0===e||e.remove():(null===(t=this.prevButton)||void 0===t?void 0:t.parentElement)||this.content.prepend(this.getPreviousButton()),this.activeCard===this.numCards-1?null===(s=this.nextButton)||void 0===s||s.remove():(null===(i=this.nextButton)||void 0===i?void 0:i.parentElement)||this.content.appendChild(this.getNextButton()))}showHideNavButtons(){this.cardsWrapper.scrollWidth===this.cardsWrapper.offsetWidth?(this.nextButton&&(this.nextButton.hidden=!0),this.prevButton&&(this.prevButton.hidden=!0)):(this.nextButton&&(this.nextButton.hidden=!1),this.prevButton&&(this.prevButton.hidden=!1))}}class pt extends F{constructor(e,t,s,i,o,a){super(e,t,s,i,o,a);const n=s.location;this._title=n.title,this._url=n.url,this._longitude=n.longitude,this._latitude=n.latitude}render(){const e=this.util,t=e.createDiv(["message"]);t.lang=this.locale;const s=e.createDiv(["message-wrapper"]);t.appendChild(s);const i=e.createDiv(["attachment"]),o=e.createDiv(["attachment-placeholder","flex"]),a=e.createDiv(["attachment-icon"]),n=e.createImageIcon({icon:this.settings.icons.shareMenuLocation||fe,title:""}),r=e.createDiv(["attachment-footer","flex"]),c=e.createElement("label",["attachment-title"]);if(c.innerText=this._title?this._title:`${this._latitude.toFixed(4)}, ${this._longitude.toFixed(4)}`,r.appendChild(c),a.appendChild(n),o.appendChild(a),!this.actions.length){const t=e.createDiv(["attachment-controls"]),s=e.createIconButton({css:["attachment-control-icon","attachment-button","flex"],icon:this.settings.icons.externalLink||oe,iconCss:[],title:this.translations.openMap}),i=e.createAnchor(this._url||`https://www.google.com/maps/@${this._latitude},${this._longitude},12z`,"",[],this.settings.openLinksInNewWindow,this.settings.linkHandler);s.onclick=()=>{i.click()},t.appendChild(s),r.appendChild(t)}return i.appendChild(o),i.appendChild(r),s.appendChild(this.getContent(i)),t}}class gt extends F{constructor(e,t,s,i,o,a){super(e,t,s,i,o,a),this._payload=JSON.stringify(s.payload)}getContent(){const e=this.util.createElement("span");return e.innerText=this._payload,super.getContent(e)}}class ut extends F{constructor(e,t,s,i,o,a){super(e,t,s,i,o,a),this._text=s.text}getContent(){const e=this.settings,t=this.util,s=t.createDiv();return s.innerHTML=t.linkify(this._text,{emHTML:this.side===z.LEFT,emVideo:e.embeddedVideo}),e.linkHandler?m(s,e.linkHandler):e.openLinksInNewWindow&&b(s),super.getContent(s)}}class mt extends ut{constructor(e,t,s,i,o,a){super(e,t,s,i,o,a),this.currentRating=0,this.payloadActions=s.actions,this.ratingId=Date.now()}focusFirstAction(){this.ratingActions[0].focus()}disableActions(){this.setDisabled(!0),super.disableActions()}disablePostbacks(){this.setDisabled(!0),super.disablePostbacks()}enableActions(){this.setDisabled(!1),super.enableActions()}enablePostbacks(){this.setDisabled(!1),super.enablePostbacks()}highlightRating(e){const t=this.util,s="active";for(let i=0;i<this.actions.length;i++){const o=i+1;"string"==typeof e&&(e=this.getValidRating(e)),e&&o<=e||0===e&&o<=this.currentRating?t.addCSSClass(this.ratingActions[i],s):t.removeCSSClass(this.ratingActions[i],s)}}getActions(){const e=this.util,t=this.settings,s=t.i18n[t.locale].ratingStar,i=e.createDiv(["rating-wrapper"]);this.ratingActions=this.payloadActions.map((o=>{const a=e.createElement("input",["star-input","rating-hidden"]);a.id=`rating-${o.label}-${this.ratingId}`,a.type="radio",a.name=`rating-${this.ratingId}`,a.value=o.label;const n=e.createElement("label",["star-label"]);n.htmlFor=`rating-${o.label}-${this.ratingId}`,n.setAttribute("data-rating",o.label);const r=e.createElement("span",["rating-hidden"]),c=s.replace("{0}",`${o.label}`);r.innerText=c;const l=t.icons&&t.icons.rating||pe,d=e.createImageIcon({icon:l,title:c,iconCss:["rating-star-icon"]});return n.appendChild(r),n.appendChild(d),a.onfocus=()=>{a.disabled||(this.currentRating=this.getRatingStarsAndHighlight(a))},a.onkeydown=e=>{"Enter"===e.key&&this.submitRating(o)},n.onclick=()=>{a.disabled||(this.currentRating=this.getRatingStarsAndHighlight(n),this.submitRating(o))},n.onmouseover=()=>{a.disabled||this.getRatingStarsAndHighlight(n)},n.onmouseleave=()=>{a.disabled||this.getRatingStarsAndHighlight(null)},i.appendChild(a),i.appendChild(n),a})),this.currentRating&&this.getRatingStarsAndHighlight(null);const o=e.createDiv(["rating-root"]);return o.appendChild(i),o}setDisabled(e){this.ratingActions&&this.ratingActions.forEach((t=>{t.disabled=e}))}submitRating(e){const t={getPayload:()=>Promise.resolve(e.postback),label:e.label,type:e.type};this.handleOnActionClick(t)}getRatingStarsAndHighlight(e){let t=0;if(e){const s=e.value?e.value:null==e?void 0:e.getAttribute("data-rating");t=s?parseInt(s,10):0}return this.highlightRating(t),t}getValidRating(e){let t=0;if(e.match(/^\d+$/)){const s=parseInt(e,10);s>0&&s<=this.actions.length&&(t=s)}return t}}class bt extends F{constructor(e,t,s,o,a,n){super(e,t,s,o,a,n),this._actions=[],this.cssPrefix=e.name,this._options=n,this._payload=s,this.actions=this.actions.filter((e=>e.getActionType()!==i.b.SubmitForm||(this._actions.push(e),this._submitFormAction=e,!1)))}disableActions(){super.disableActions(),this._actions.forEach((e=>{e.disable()}))}disablePostbacks(){super.disablePostbacks(),I(this._actions).forEach((e=>{e.disable()}))}enableActions(){super.enableActions(),this._actions.forEach((e=>{e.enable()}))}enablePostbacks(){super.enablePostbacks(),I(this._actions).forEach((e=>{e.enable()}))}render(){return super.render()}getHeader(){const e=this.util,t=super.getHeader();return e.addCSSClass(t,"message-header-yellow"),t}getContent(e){const t=this.util,s="message-bubble",o=this._payload.type,a=t.createDiv([s]);o===i.i.Table||o===i.i.TableForm?t.addCSSClass(a,`${s}-tabular-message`):t.addCSSClass(a,`${s}-form-message`,o===i.i.EditForm?"edit-form-message":""),e&&a.appendChild(e);const n=this.getPageStatus();return n&&a.appendChild(n),a}getPageStatus(){const e=this.util;let t;const s=this._payload.paginationInfo;return s&&s.totalCount>s.rangeSize&&(t=e.createDiv(["results-page-status"]),t.innerText=s.status),t}}class ft{constructor(e,t,s,o,a,n){this.settings=e,this.util=t,this.field=s,this.columns=n,this.isTableField=!1,this.isColumnField=!1,s.displayType===i.h.Action&&(this.action=B.fromActionPayload(s.action,t,e.openLinksInNewWindow,o,e.linkHandler,a))}render(){var e;const t=this.util,s=this.field,o="form-message",a=this.settings,{alignment:n,label:c,labelFontSize:l,labelFontWeight:h,marginTop:g}=s,u=t.createDiv([`${o}-value`]),f=null===(e=s.value)||void 0===e?void 0:e.toString();switch(s.displayType){case i.h.Link:const e=t.createDiv(),{imageUrl:o,linkLabel:l}=s,h=t.createElement("a",l?[]:["ellipsis"]);if(h.href=f,o){const e=t.createImage(o,["video-wrapper"],f);e.title=l||"",h.appendChild(e),c&&t.addCSSClass(u,"with-top-margin")}else h.innerHTML=l||(0,r.stripHTTP)(f)||"";h.setAttribute("target","_blank"),e.appendChild(h),a.linkHandler?m(e,a.linkHandler):a.openLinksInNewWindow&&b(e),u.appendChild(h);break;case i.h.Text:const{fontSize:g,fontWeight:v,truncateAt:w}=s;f&&w?(u.innerHTML=`${f.slice(0,w)}...`,u.title=f):u.innerHTML=f||"",vt(u,g,v,t);break;case i.h.Media:const x=s.mediaType,y=c&&f;if("image"===x){const e=t.createImage(f,["video-wrapper"],f);y&&t.addCSSClass(u,"with-top-margin"),u.appendChild(e)}else if("video"===x&&(d(f)||p(f)))u.innerHTML=t.linkify(f,{emHTML:!0,emVideo:a.embeddedVideo}),a.embeddedVideo&&y&&t.addCSSClass(u,"with-top-margin");else{const e=t.createMedia(x,f,["video-wrapper"]);e.controls=!0,e.preload="metadata",y&&t.addCSSClass(u,"with-top-margin"),u.appendChild(e)}break;case i.h.Action:t.addCSSClass(u,"flex"),u.style.justifyContent=n,c&&t.addCSSClass(u,"with-top-margin"),this.action.onActionClick=this.onActionClick,u.appendChild(this.action.render())}if(this.isTableField)return u;const v=`${o}-field`,w=[v,`${v}-col-${this.columns}`],x=t.createDiv(w),y=t.createDiv([`${o}-key`]);return y.innerHTML=c||"",n&&(y.style.textAlign=n,u.style.textAlign=n),vt(y,l,h,t),x.appendChild(y),x.appendChild(u),this.isColumnField?wt(x,g,t):x}disableActions(){this.action.disable()}disablePostbacks(){I([this.action]).forEach((e=>{e.disable()}))}enableActions(){this.action.enable()}enablePostbacks(){I([this.action]).forEach((e=>{e.enable()}))}}function vt(e,t,s,i){switch(t){case"large":i.addCSSClass(e,"font-size-lg");break;case"small":i.addCSSClass(e,"font-size-sm");break;default:i.addCSSClass(e,"font-size-md")}switch(s){case"bold":i.addCSSClass(e,"font-weight-bold");break;case"light":i.addCSSClass(e,"font-weight-light");break;default:i.addCSSClass(e,"font-weight-md")}}function wt(e,t,s){return"large"===t?s.addCSSClass(e,"margin-top-lg"):"none"!==t&&s.addCSSClass(e,"margin-top-md"),e}class xt extends bt{getContent(){const e=this.util,t=this.settings,s=this._payload,i="form-message",o=e.createDiv([i]);s.formColumns>2&&(s.formColumns=2);const a=s.forms;return a.forEach(((n,r)=>{if(n.title){const t=e.createDiv([`${i}-header`]);t.innerText=n.title,o.appendChild(t)}const[c,l]=yt(e,n,s.formColumns,t,this.handleOnActionClick.bind(this),this._options);if(n.selectAction){St(B.fromActionPayload(n.selectAction,e,t.openLinksInNewWindow,this.shareText,t.linkHandler,this._options),l,this.handleOnActionClick.bind(this),c,n.selectAction.label)}this._actions=this._actions.concat(l);const d=r+1;d===a.length||a[d].title||e.addCSSClass(c,"with-border"),o.appendChild(c)})),super.getContent(o)}}function yt(e,t,s,o,a,n){const r="form-message",c=`${r}-actions-col`,l=e.createDiv([`${r}-item`]),d=S(t,!0),h=function(e,t,s,i,o,a){var n;const r=[];if((null===(n=e.actions)||void 0===n?void 0:n.length)>0)for(const n of e.actions){const e=B.fromActionPayload(n,t,s.openLinksInNewWindow,o,s.linkHandler,a);e&&(e.onActionClick=i.bind(this),r.push(e))}return r}(t,e,o,a,d,n);let p;return h.length&&(p=function(e,t,s,i){const o=t.createDiv("horizontal"!==s.formActionsLayout?["form-actions","col",i]:["form-actions"]);for(const t of e){const e=t.render();o.appendChild(e)}return o}(h,e,o,c)),(0,i.A)(t)?t.formRows.forEach((t=>{const s=Ct(t,h,e,o,d,a.bind(this),n),r=t.columns.length;t.columns.forEach((t=>{const c=kt(t,e);t.fields.forEach((s=>{if((0,i.D)(s)){const i=new ft(o,e,s,d,n);i.isColumnField=!0,i.onActionClick=a.bind(this),i.action&&h.push(i.action),Tt(t.width,s.displayType,c,r),c.appendChild(i.render())}})),s.appendChild(c)})),l.appendChild(s)})):t.fields.forEach((t=>{const i=new ft(o,e,t,d,n,s);i.onActionClick=a.bind(this),i.action&&h.push(i.action),l.appendChild(i.render())})),p&&l.appendChild(p),[l,h]}function Ct(e,t,s,i,o,a,n){const r=s.createDiv(["form-row",e.separator?"separator":""]);if(e.selectAction){St(B.fromActionPayload(e.selectAction,s,i.openLinksInNewWindow,o,i.linkHandler,n),t,a,r,e.selectAction.label)}return r}function St(e,t,s,i,o){e&&(t.push(e),e.onActionClick=s,i.onclick=t=>e.handleOnClick(t),i.title=o||"",i.style.cursor="pointer")}function kt(e,t){const{width:s,verticalAlignment:i}=e,o=t.createDiv(["form-row-column",s||""]);return"center"===i?t.addCSSClass(o,"align-center"):"bottom"===i?t.addCSSClass(o,"align-end"):t.addCSSClass(o,"align-start"),o}function Tt(e,t,s,o){"stretch"===e||t!==i.h.Media||s.style.maxWidth||(s.style.maxWidth=`calc((100% - ${16*(o-1)}px)/${o})`)}class At extends bt{constructor(){super(...arguments),this.fieldCount=0,this.fieldErrorCount=0,this.inputElements=[],this.logger=new R("EditFormMessageComponent"),this.submittedFields={},this.visibleOptions=[]}disableActions(){super.disableActions(),It(this.formErrorElem,this.inputElements,this.util)}disablePostbacks(){super.disablePostbacks(),It(this.formErrorElem,this.inputElements,this.util)}enableActions(){super.enableActions(),It(this.formErrorElem,this.inputElements,this.util,!1)}enablePostbacks(){super.enablePostbacks(),It(this.formErrorElem,this.inputElements,this.util,!1)}getContent(){const e=this._payload,t=this.settings,s=this.util,o="form-message",a=`${o}-item`,n=`${o}-actions-col`,r=s.createDiv([o]),c=s.createDiv([a]);if(e.title){const t=s.createDiv([`${o}-header`]);t.innerText=e.title,r.appendChild(t)}return(0,i.w)(e)?(e.formColumns>2&&(e.formColumns=2),e.fields.filter((e=>e)).forEach((t=>{c.appendChild(this.renderField(t,o,!1,e.formColumns))}))):e.formRows.forEach((e=>{const i=Ct(e,this._actions,s,t,this.shareText,this.handleOnActionClick.bind(this),this.options),a=e.columns.length;e.columns.forEach((e=>{const t=kt(e,s);e.fields.filter((e=>e)).forEach((s=>{t.appendChild(this.renderField(s,o,!0)),Tt(e.width,s.displayType,t,a)})),i.appendChild(t)})),c.appendChild(i)})),this.actionsDiv=s.createDiv("horizontal"!==t.formActionsLayout?["form-actions","col",n]:["form-actions"]),c.appendChild(this.actionsDiv),this._submitFormAction?this.actionsDiv.appendChild(this._submitFormAction.render()):this.logger.error("Payload does not contain submit-form action"),this.renderErrorMessage(this.actionsDiv,e.errorMessage||(this.fieldErrorCount&&this.fieldCount>1?this.translations.editFormErrorMessage:""),!0),r.appendChild(c),super.getContent(r)}validateForm(){var e;let t=!0;return null===(e=this.formErrorElem)||void 0===e||e.remove(),this.inputElements.forEach((e=>{t=this.isFieldValid(e)&&t})),!t&&this.fieldCount>1&&this.renderErrorMessage(this.actionsDiv,this.translations.editFormErrorMessage,!0),t}getSubmittedFields(){return this.inputElements.filter((e=>{const t=e.tagName.toLowerCase();return"textarea"===t&&(this.submittedFields[e.id]=e.value),"input"===t})).forEach((e=>{const t=e;switch(t.type){case"checkbox":this.submittedFields[t.id]=t.checked?t.getAttribute("valueOn"):t.getAttribute("valueOff");break;case"number":this.submittedFields[t.id]=t.valueAsNumber;break;default:this.submittedFields[t.id]=t.value}})),this.submittedFields}renderField(e,t,s,o){const a=this.shareText,n=this.util;if(this.fieldCount++,(0,i.D)(e)){const t=new ft(this.settings,n,e,a,this.options,o);return t.isColumnField=s,t.onActionClick=this.handleOnActionClick.bind(this),t.action&&this._actions.push(t.action),t.render()}return s?wt(this.renderEditableField(e,o,t,n),e.marginTop,n):this.renderEditableField(e,o,t,n)}renderEditableField(e,t,s,o){var a,n,c;const l=`${s}-field`,d=[l,`${l}-col-${t}`,`edit-${l}`],h=o.createDiv(d),p=o.createDiv([`${s}-key`,"with-margin"]),{labelFontSize:g,labelFontWeight:u,id:m,displayType:b,placeholder:f,required:v,clientErrorMessage:w,serverErrorMessage:x,autoSubmit:y}=e;let C,S,k;switch(p.innerHTML=e.label||"",vt(p,g,u,o),h.appendChild(p),b){case i.h.SingleSelect:const t=e;if(S=t.defaultValue,k=t.layoutStyle,S&&(this.submittedFields[m]=S),k&&"list"!==k)if("radioGroup"===k){const e=o.createElement("form",[`${s}-value`,"form-container","col"]);o.setAttributes(e,{id:m,ariaLabel:b,errorMsg:w}),e.onclick=e=>e.stopPropagation(),t.options.forEach((t=>{const s=o.createInputElement({type:"radio",name:m,value:t.label,required:v,checked:t.value===S},["radio-input"]);s.onchange=()=>{s.checked&&(this.submittedFields[m]=t.value),this.partialSubmit(m,y,e)};const i=o.createElement("label");i.innerText=t.label,i.prepend(s),e.appendChild(i)})),this.inputElements.push(e),h.appendChild(e),this.renderErrorMessage(e,x)}else this.logger.error(`Payload contains wrong layout style:${k} for single select field`);else{const e=o.createElement("select",[`${s}-value`]),i=o.createDiv(["select-icon-wrapper"]),a=o.createImageIcon({icon:J,iconCss:["select-icon"]}),n=o.createElement("option"),r={};o.setAttributes(e,{id:m,required:v,errorMsg:w}),e.onclick=e=>e.stopPropagation(),n.hidden=!0,n.label=f||"",e.appendChild(n),t.options.forEach((t=>{const s=o.createElement("option");o.setAttributes(s,{label:t.label,value:t.label,selected:t.value===S}),r[t.label]=t.value,e.appendChild(s)})),e.onchange=()=>{this.submittedFields[m]=r[e.value],this.partialSubmit(m,y,e)},this.inputElements.push(e),h.appendChild(e),i.appendChild(a),h.appendChild(i),this.renderErrorMessage(e,x)}break;case i.h.MultiSelect:const l=e;if(S=l.defaultValue,k=l.layoutStyle,this.submittedFields[m]=S||[],k&&"list"!==k)if("checkboxes"===k){const e=o.createElement("form",[`${s}-value`,"form-container","col"]);o.setAttributes(e,{id:m,ariaLabel:b,errorMsg:w,ariaRequired:v?"true":""}),e.onclick=e=>e.stopPropagation(),l.options.forEach((t=>{const s=o.createInputElement({type:"checkbox",name:m,value:t.label,checked:null==S?void 0:S.includes(t.value),required:v},["radio-input"]),i=o.createElement("label");i.innerText=t.label,i.prepend(s),s.onchange=()=>{if(s.checked)this.submittedFields[m].push(t.value);else{const e=this.submittedFields[m];e.splice(e.indexOf(t.value),1)}this.partialSubmit(m,y,e)},e.appendChild(i)})),this.inputElements.push(e),h.appendChild(e),this.renderErrorMessage(e,x)}else this.logger.error(`Payload contains wrong layout style:${k} for multi select field`);else{const e=o.createDiv([`${s}-value`,"text-field-container"]),t=o.createElement("ul",["selected-options"]),i=o.createDiv(),a=o.createDiv(["listbox","popup","none"]),n=o.createDiv(["filter-message-box"]),c=o.createDiv(["filter-message-text","none"]),d=o.createInputElement({type:"text"},[`${s}-value`,"listbox-search","none"]),p=o.createElement("ul",["multi-select-list"]),g=p.getElementsByTagName("li"),u=o.createDiv(["search-icon-wrapper","none"]),b=o.createImageIcon({icon:ge,iconCss:["search-icon"]});c.textContent=this.translations.noResultText,n.appendChild(c),d.oninput=()=>this.filterSearchResults(d,g)?o.addCSSClass(c,"none"):o.removeCSSClass(c,"none"),d.onkeydown=t=>{var s;const i=t.key;i===r.KeyCode.Down?(this.filterSearchResults(d,g),null===(s=this.visibleOptions[0])||void 0===s||s.focus()):i!==r.KeyCode.Esc&&i!==r.KeyCode.Tab||e.click()},f&&t.setAttribute("data-placeholder",f),e.setAttribute("aria-expanded","false");const C=t=>{"true"!==e.getAttribute("aria-expanded")||i.contains(t.target)||k()},k=()=>{e.setAttribute("aria-expanded","false"),o.addCSSClass(a,"none"),document.removeEventListener("click",C),d.value="",this.filterSearchResults(d,g),o.addCSSClass(d,"none"),o.addCSSClass(u,"none"),o.addCSSClass(c,"none")};e.onclick=t=>{if(t.stopPropagation(),"true"===e.getAttribute("aria-expanded"))k(),e.focus();else{e.setAttribute("aria-expanded","true"),o.removeCSSClass(a,"none");const t=p.firstElementChild;t?t.focus():o.removeCSSClass(c,"none"),setTimeout((()=>document.addEventListener("click",C)))}},e.onkeydown=t=>{const s=t.code;t.ctrlKey||t.altKey||t.metaKey||t.shiftKey||s===r.KeyCode.Esc||s===r.KeyCode.Tab||(e.click(),o.removeCSSClass(d,"none"),o.removeCSSClass(u,"none"),d.focus())},e.setAttribute("aria-required",v?"true":"false"),e.tabIndex=0,w&&e.setAttribute("data-error",w),l.options.forEach((s=>{const i=i=>{const a=o.createDiv(["multi-select-option"]);a.innerText=s.label;const n=o.createImageIcon({icon:ee,title:"optClose",iconCss:["opt-close"]});n.onclick=()=>{t.removeChild(a),p.appendChild(i);const o=this.submittedFields[m];o.splice(o.indexOf(s.value),1),this.partialSubmit(m,y,e)},a.appendChild(n),a.onclick=t=>{t.stopPropagation(),"true"===e.getAttribute("aria-expanded")&&e.click()},t.appendChild(a)},a=o.createListItem(s.label,s.label,s.label,"","",(t=>{let o=t.target;"LI"!==o.tagName&&(o=o.parentElement),e.click(),p.removeChild(o),this.submittedFields[m].push(s.value),i(o),this.partialSubmit(m,y,e)}),!1,!1);a.onkeydown=t=>this.onMenuClick(t,a,p,e),(null==S?void 0:S.includes(s.value))?i(a):p.appendChild(a)})),i.onclick=e=>e.stopPropagation(),e.appendChild(t),this.inputElements.push(e),h.appendChild(e),u.appendChild(b),a.appendChild(n),a.appendChild(d),a.appendChild(u),a.appendChild(p),i.appendChild(a),h.appendChild(i),this.renderErrorMessage(e,x)}break;case i.h.Toggle:const d=e,p=o.createElement("label",[`${s}-value`,"toggle"]);p.tabIndex=0,p.onclick=e=>e.stopPropagation(),C=o.createInputElement({id:m,placeholder:f,required:v,type:"checkbox",checked:d.defaultValue===d.valueOn,errorMsg:w,valueOn:d.valueOn,valueOff:d.valueOff});const g=d.labelOn||d.valueOn,u=d.labelOff||d.valueOff;C.setAttribute("aria-label",C.checked?g:u),C.oninput=()=>{C.setAttribute("aria-label",C.checked?g:u),this.partialSubmit(m,y,C)},p.appendChild(C),p.appendChild(o.createDiv(["round-slider"])),h.appendChild(p),this.renderErrorMessage(C.parentElement,x);break;case i.h.DatePicker:const T=e;C=o.createInputElement({type:"date",id:m,title:f,required:v,defaultValue:T.defaultValue,min:T.minDate,max:T.maxDate,errorMsg:w},[`${s}-value`]);break;case i.h.TimePicker:const A=e;C=o.createInputElement({type:"time",id:m,title:f,required:v,defaultValue:A.defaultValue,min:A.minTime,max:A.maxTime,errorMsg:w},[`${s}-value`]);break;case i.h.TextInput:const I=e;if(I.multiLine){const e=o.createElement("textarea",[`${s}-value`]);o.setAttributes(e,{id:m,required:v,minLength:I.minLength,maxLength:I.maxLength,defaultValue:I.defaultValue,placeholder:I.placeholder,errorMsg:w}),e.rows=3,e.onchange=()=>this.partialSubmit(m,y,e),e.onclick=e=>e.stopPropagation(),h.appendChild(e),this.inputElements.push(e),this.renderErrorMessage(e,x)}else C=o.createInputElement({type:I.inputStyle||"text",id:m,placeholder:f,required:v,defaultValue:I.defaultValue,errorMsg:w,minLength:I.minLength,maxLength:I.maxLength,pattern:I.validationRegularExpression},[`${s}-value`]);break;case i.h.NumberInput:const E=e;C=o.createInputElement({type:"number",id:m,placeholder:f,required:v,defaultValue:null===(a=E.defaultValue)||void 0===a?void 0:a.toString(),min:null===(n=E.minValue)||void 0===n?void 0:n.toString(),max:null===(c=E.maxValue)||void 0===c?void 0:c.toString(),errorMsg:w},[`${s}-value`]);break;default:this.logger.error(`Payload contains wrong display type:${b} for editable field`)}return C&&("checkbox"!==C.type&&(h.appendChild(C),this.renderErrorMessage(C,x),C.onchange=()=>this.partialSubmit(m,y,C),C.onclick=e=>e.stopPropagation()),this.inputElements.push(C)),h}isFieldValid(e,t=!1){const s=e.dataset.error;let o,a=e.nextElementSibling,n=!0;switch(e.tagName.toLowerCase()){case"select":const t=e;a=a.nextElementSibling,t.checkValidity()||(n=!1,o=s||t.validationMessage);break;case"form":const r=e,c=r.ariaLabel;if(c===i.h.MultiSelect&&"true"===r.ariaRequired){r.querySelectorAll("input[type='checkbox']:checked").length||(n=!1,o=s||r.querySelector("input").validationMessage)}else c!==i.h.SingleSelect||r.checkValidity()||(n=!1,o=s||r.querySelector("input").validationMessage);break;case"input":const l=e;"checkbox"===l.type?a=a.parentElement.nextElementSibling:l.checkValidity()||(o=s||l.validationMessage,n=!1);break;case"textarea":const d=e;d.checkValidity()||(o=s||d.validationMessage,n=!1);break;case"div":const h=e;a=a.nextElementSibling,"true"===h.getAttribute("aria-required")&&(o=s,n=!!h.firstElementChild.firstElementChild)}return t||("SPAN"===(null==a?void 0:a.tagName)&&(this.util.removeCSSClass(e.parentElement,"error"),a.remove(),this.fieldErrorCount--),n||this.renderErrorMessage(e,o||this.translations.editFieldErrorMessage)),n}filterSearchResults(e,t){this.visibleOptions=[];for(let s=0;s<t.length;s++){const i=t[s],o=i.querySelector("span"),a=i.textContent||i.innerText;a.toLowerCase().indexOf(e.value.toLowerCase())<0?(i.style.display="none",o.innerHTML=a.replace(/(<b>)|(<\/b>)/g,"")):(e.value?o.innerHTML=a.replace(new RegExp(`${e.value}`,"gi"),"<b>$&</b>"):o.innerHTML=a.replace(/(<b>)|(<\/b>)/g,""),i.style.display="",this.visibleOptions.push(i))}return this.visibleOptions.length>0}onMenuClick(e,t,s,i){var o,a,n,c;const l=this.visibleOptions,d=l.indexOf(t),h=l.length;let p=!1;if(!(e.ctrlKey||e.altKey||e.metaKey)){if(e.shiftKey&&e.code===r.KeyCode.Tab)i.click();else switch(e.code){case r.KeyCode.Return:case r.KeyCode.Space:t.click(),p=!0;break;case r.KeyCode.Esc:case r.KeyCode.Tab:i.click(),e.code===r.KeyCode.Esc&&(i.focus(),p=!0);break;case r.KeyCode.Up:const g=t.previousElementSibling||s.lastElementChild;"none"===g.style.display?null===(o=l[(d+h-1)%h])||void 0===o||o.focus():g.focus(),p=!0;break;case r.KeyCode.Down:const u=t.nextElementSibling||s.firstElementChild;"none"===u.style.display?null===(a=l[(d+1)%h])||void 0===a||a.focus():u.focus(),p=!0;break;case r.KeyCode.Home:case r.KeyCode.PageUp:const m=s.firstElementChild;"none"===m.style.display?null===(n=l[0])||void 0===n||n.focus():m.focus(),p=!0;break;case r.KeyCode.End:case r.KeyCode.PageDown:const b=s.lastElementChild;"none"===b.style.display?null===(c=l[h-1])||void 0===c||c.focus():b.focus(),p=!0;break;default:const f=s.previousElementSibling,v=f.previousElementSibling,w=this.util;w.removeCSSClass(v,"none"),w.removeCSSClass(f,"none"),v.focus()}p&&(e.stopPropagation(),e.preventDefault())}}partialSubmit(e,t,s){if(this.isFieldValid(s)&&t){const t=JSON.parse(JSON.stringify(this.getSubmittedFields()));this.inputElements.forEach((e=>{this.isFieldValid(e,!0)||delete t[e.id]})),Object.keys(t).forEach((e=>{const s=t[e];Array.isArray(s)?0===s.length&&delete t[e]:0===s||s||delete t[e]}));const s=this.settings.sdkMetadata?Object.assign({version:j},this.settings.sdkMetadata):{version:j};this._options.webCore.sendMessage((0,i.q)({submittedFields:t,partialSubmitField:e,type:i.i.FormSubmission}),{sdkMetadata:s}).then((()=>{const e=this.settings.disablePastActions;"all"===e?this.disableActions():"postback"===e&&this.disablePostbacks()}))}}renderErrorMessage(e,t,s=!1){if(t){const i=this.util,o=i.createElement("span",["field-error",s?"form-error":""]),a=e.parentElement,n=i.createImageIcon({icon:ie,title:"error",iconCss:["form-error-icon"]}),r=i.createElement("span",["error-text"]);r.innerText=t,o.appendChild(n),o.appendChild(r),s?(a.insertBefore(o,e),this.formErrorElem=o):(i.addCSSClass(a,"error"),a.appendChild(o),this.fieldErrorCount++)}}}function It(e,t,s,i=!0){e&&(i?s.addCSSClass(e,"disabled"):s.removeCSSClass(e,"disabled")),t.forEach((e=>{switch(e.tagName.toLowerCase()){case"select":case"textarea":e.disabled=i;break;case"form":const t=e.getElementsByTagName("input");i?s.addCSSClass(e,"disabled"):s.removeCSSClass(e,"disabled");for(let e=0;e<t.length;e++){t[e].disabled=i}break;case"input":const o=e;o.disabled=i,"checkbox"===o.type&&(i?s.addCSSClass(e.parentElement,"disabled"):s.removeCSSClass(e.parentElement,"disabled"));break;case"div":i?(s.addCSSClass(e,"disabled"),s.addCSSClass(e.parentElement,"disabled")):(s.removeCSSClass(e,"disabled"),s.removeCSSClass(e.parentElement,"disabled"))}}))}const Et=100;class _t extends bt{getContent(){const e=this.util,t=this._payload,s=Lt(t.headings),i="table-message",o=e.createDiv([`${i}-wrapper`]),a=e.createElement("table",[i]);o.appendChild(a);const n=e.createElement("tr",[`${i}-headings`]);return s.forEach((t=>{const s=Mt(e,[`${i}-heading`],t.width,t.alignment);s.innerText=t.label,n.appendChild(s)})),a.appendChild(n),t.rows.forEach((t=>{const o=e.createElement("tr",[`${i}-row`]);if(t.selectAction){St(B.fromActionPayload(t.selectAction,e,this.settings.openLinksInNewWindow,this.shareText,this.settings.linkHandler,this.options),this._actions,this.handleOnActionClick.bind(this),o,t.selectAction.label)}t.fields.forEach(((t,a)=>{const n=Mt(e,[`${i}-item`],s[a].width,t.alignment),r=new ft(this.settings,e,t,this.shareText,this.options);r.isTableField=!0,r.onActionClick=this.handleOnActionClick.bind(this),r.action&&this._actions.push(r.action),n.appendChild(r.render()),o.appendChild(n)})),a.appendChild(o)})),super.getContent(o)}}function Mt(e,t,s,i){const o=e.createElement("td",t);return o.style.textAlign=i,o.style.width=`${s}%`,o}function Lt(e){let t;if(e.every((e=>!e.width||e.width>=0&&e.width<=Et))){let s=0,i=0;if(e.forEach((e=>{e.width?i+=e.width:s++})),s)if(i<Et){const o=(Et-i)/s;t=e.map((e=>(e.width||(e.width=o),e)))}else t=Pt(e);else if(i===Et)t=e;else{const s=Et/i;t=e.map((e=>(e.width=e.width*s,e)))}}else t=Pt(e);return t}function Pt(e){const t=Et/e.length;return e.map((e=>(e.width=t,e)))}class Dt extends bt{getContent(){const e=this.util,t=this._payload,s=Lt(t.headings.concat({alignment:"center",label:""})),i="table-message",o=e.createDiv([`${i}-wrapper`]),a=e.createElement("table",[i,"tableform-message"]);o.appendChild(a);const n=e.createElement("tr",[`${i}-headings`]);s.forEach((t=>{const s=Mt(e,[`${i}-heading`],t.width,t.alignment);s.innerText=t.label,n.appendChild(s)})),a.appendChild(n);return n.lastElementChild.style.width="32px",t.rows.forEach(((o,n)=>{const r=e.createElement("tr",[`${i}-row`]);o.fields.forEach(((t,o)=>{const a=Mt(e,[`${i}-item`],s[o].width,t.alignment),n=new ft(this.settings,e,t,this.shareText,this.options);n.isTableField=!0,n.onActionClick=this.handleOnActionClick.bind(this),n.action&&this._actions.push(n.action),a.appendChild(n.render()),r.appendChild(a)})),t.formColumns>2&&(t.formColumns=2);const c=t.forms[n],l=Mt(e,[`${i}-item`,"button-cell"]),d=e.createIconButton({css:[`${i}-item`,`${i}-item-form-toggle`],icon:J,iconCss:[],title:c.title||""});l.appendChild(d),r.appendChild(l);const h="none",p="rotate-180",[g,u]=yt(e,c,t.formColumns,this.settings,this.handleOnActionClick.bind(this),this._options);this._actions=this._actions.concat(u),e.addCSSClass(g,h);let m=!1;r.onclick=()=>{m?(e.addCSSClass(g,h),e.removeCSSClass(d,p)):(e.removeCSSClass(g,h),e.addCSSClass(d,p)),m=!m},a.appendChild(r),a.appendChild(g)})),super.getContent(o)}}function Ot(e){return!!e.source}function Rt(e){if(e.msgId)return e.msgId;const t=JSON.stringify(e.messagePayload);return`${Bt(t)}`}const Bt=e=>{let t=0,s=0;const i=Math.pow(9,9);for(;t<e.length;)s=Math.imul(s^e.charCodeAt(t++),i);return s^s>>>9};class zt{static fromMessage(e,t,s,o){let a,n;Ot(s)?(a=z.LEFT,n=s.source||i.m.Bot):(a=z.RIGHT,s.messagePayload.type===i.i.Postback&&(s=(0,i.q)({text:s.messagePayload.text,type:i.i.Text})));const r=s.messagePayload;switch(r.type){case i.i.Text:return r.channelExtensions&&"stars"===r.channelExtensions.displayType?new mt(e,t,r,a,n,o):new ut(e,t,r,a,n,o);case i.i.TextStream:return new $(e,t,r,a,n,o);case i.i.Attachment:return new lt(e,t,r,a,n,o);case i.i.Card:return new ht(e,t,r,a,n,o);case i.i.Location:return new pt(e,t,r,a,n,o);case i.i.Table:return new _t(e,t,r,a,n,o);case i.i.Form:return new xt(e,t,r,a,n,o);case i.i.TableForm:return new Dt(e,t,r,a,n,o);case i.i.EditForm:return new At(e,t,r,a,n,o);case i.i.Raw:return new gt(e,t,r,a,n,o);default:throw Error(`Wrong message payload type:${r.type}`)}}}class Ft{constructor(e){this.util=e}render(){const e=this.util.createDiv(["spinner"]);return e.innerHTML='<svg viewBox="0 0 64 64"><circle transform="translate(32,32)" r="26"></circle></svg>',e}}class Vt{constructor(e,t,s,i){this.text=e,this.side=t,this.settings=s,this.util=i}render(){const e=this.util,t=this.settings.icons,s=e.createDiv(["attachment"]),i=this.side===z.LEFT?t.avatarBot:t.avatarUser,o=e.createDiv(["attachment-footer","flex"]),a=e.createDiv(["attachment-title"]);a.innerText=this.text,o.appendChild(a);const n=e.createDiv(["attachment-placeholder","flex"]);return n.appendChild(new Ft(e).render()),s.appendChild(n),s.appendChild(o),this._element=e.getMessageBlock(this.side,s,i),this._element}remove(){this._element.remove()}}class Nt{constructor(e,t,s,i,o,a=!0){this.title=e,this.text=t,this.side=s,this.settings=i,this.util=o,this.isError=a}render(e){const t=this.util,s=this.settings.icons,i="message",o=t.createDiv([`${i}-content`]),a=this.side===z.LEFT?s.avatarBot:s.avatarUser;if(e){t.addCSSClass(o,`${i}-with-icon`);const s=t.createImageIcon({icon:e,title:""}),a=t.createDiv([`${i}-icon`]);a.appendChild(s),o.appendChild(a)}const n=t.createDiv([`${i}-text`]),r=t.createDiv([`${i}-title`]),c=t.createDiv([`${i}-description`]);return r.innerText=this.title,c.innerText=this.text,n.appendChild(r),n.appendChild(c),o.appendChild(n),t.getMessageBlock(this.side,o,a,this.isError)}}class $t{constructor(e,t,s){this.side=e,this.settings=t,this.util=s,this.element=this.render(),this.visible=!1}append(e){this.isVisible()||(e.appendChild(this.element),this.visible=!0,this.timeoutID&&clearTimeout(this.timeoutID),this.timeoutID=window.setTimeout((()=>{this.remove()}),1e3*this.settings.typingIndicatorTimeout))}remove(){this.isVisible()&&(this.element.remove(),this.visible=!1)}isVisible(){return this.visible}render(){const e=this.util,t=this.settings,s=e.createDiv(["typing-cue-wrapper"]),i=t.icons.avatarBot;if(t.icons.typingIndicator){const i=t.icons.typingIndicator,o=t.i18n[t.locale].typingIndicator,a=e.createImageIcon({icon:i,title:o});a.style.height=t.chatBubbleIconHeight||a.style.height,a.style.width=t.chatBubbleIconWidth||a.style.width,s.appendChild(a)}else{const t=e.createDiv(["typing-cue"]);s.appendChild(t)}return e.getMessageBlock(this.side,s,i)}updateTypingCueIcon(e){const t=this.element.querySelector("svg")||this.element.querySelector("img");t&&("img"===t.localName?t.alt=e:t.setAttribute("aria-label",e))}setAgentTypingCue(e){e.style.marginTop="0px",this.element.firstChild.replaceWith(e)}}const Ut=["no-referrer","no-referrer-when-downgrade","origin","origin-when-cross-origin","same-origin","strict-origin","strict-origin-when-cross-origin","unsafe-url"],Ht=["allow-downloads-without-user-activation","allow-downloads","allow-forms","allow-modals","allow-orientation-lock","allow-pointer-lock","allow-popups","allow-popups-to-escape-sandbox","allow-presentation","allow-same-origin","allow-scripts","allow-storage-access-by-user-activation","allow-top-navigation","allow-top-navigation-by-user-activation"],jt="none",Wt="webview-container",Gt=`${Wt}-open`,qt=`${Wt}-close`;class Kt{constructor(e,t,s){this.util=t,this.settings=s,this.heightRatio=.8,this.props={closeButtonIcon:ee,closeButtonType:"icon",errorInfoBar:!0,referrerPolicy:"no-referrer-when-downgrade",sandbox:[],size:"tall"},this.isOpen=!1,this.isErrorViewOpen=!1,this.setProps(e||{}),this.cssPrefix=s.name}setProps(e){Array.isArray(e.sandbox)&&e.sandbox.length&&(e.sandbox=e.sandbox.map((e=>e.toLowerCase())).filter((e=>Ht.indexOf(e)>=0)));const t=Object.assign(Object.assign({},this.props),e);var s;t.closeButtonIcon||(t.closeButtonIcon=this.props.closeButtonIcon),t.closeButtonType||(t.closeButtonType="icon"),t.size||(t.size="tall"),s=t.referrerPolicy,Ut.indexOf(null==s?void 0:s.toLowerCase())>=0||(t.referrerPolicy="no-referrer-when-downgrade"),"full"===t.size&&(this.heightRatio=1),this.props=t,this.isOpen=!1,this.isErrorViewOpen=!1}open(e){if(this.component){const t=this.util,s=100;this.component.style.height=s*this.heightRatio+"%",t.removeCSSClass(this.component,qt,jt),t.addCSSClass(this.component,Gt),this.component.insertBefore(this.loadingIndicator,this.webView),this.webView.onload=()=>{this.loadingIndicator.remove(),t.removeCSSClass(this.webView,jt)},this.props.title||(this.title.textContent=e),this.props.errorInfoBar&&setTimeout((()=>{this.isOpen&&!this.isErrorViewOpen&&(this.errorView=this.createErrorView(),e&&(this.errorAltLink.href=e),t.removeCSSClass(this.errorView,jt),this.component.appendChild(this.errorView),this.isErrorViewOpen=!0)}),1e3),this.isOpen=!0}}close(){const e=this.util;this.isOpen=!1,e.removeCSSClass(this.component,Gt),e.addCSSClass(this.component,qt),this.removeErrorView(),this.webView.setAttribute("src",""),setTimeout((()=>{e.addCSSClass(this.component,jt),e.removeCSSClass(this.webView,jt)}),400)}render(){const e=this.util,t=this.props;return this.component=e.createDiv(["webview-container"]),this.header=e.createDiv(["header","webview-header","flex"]),this.title=e.createDiv(["title","webview-title","ellipsis"]),this.closeButton=e.createIconButton({css:["header-button","webview-button-close"],icon:t.closeButtonIcon,iconCss:[],title:t.closeButtonLabel}),this.closeButton.id=`${this.cssPrefix}-webview-button-close`,this.loadingIndicator=this.createLoadingIndicator(),this.webView=e.createElement("iframe",["webview"]),this.webView.name=`${this.settings.name}-webview`,this.webView.title=t.accessibilityTitle,t.title&&(this.title.textContent=t.title),"label"===t.closeButtonType?(this.closeButton.classList.add(`${this.cssPrefix}-label-only`),this.closeButton.appendChild(document.createTextNode(t.closeButtonLabel))):"iconWithLabel"===t.closeButtonType&&(this.closeButton.classList.add(`${this.cssPrefix}-with-label`),this.closeButton.appendChild(document.createTextNode(t.closeButtonLabel))),this.webView.setAttribute("referrerpolicy",t.referrerPolicy),this.props.sandbox.length&&this.props.sandbox.forEach((e=>{this.webView.sandbox.add(e)})),this.closeButton.title=t.closeButtonLabel,e.addCSSClass(this.component,jt),this.closeButton.onclick=()=>{this.close()},this.header.appendChild(this.title),this.header.appendChild(this.closeButton),this.component.appendChild(this.header),this.component.appendChild(this.webView),this.component}createLoadingIndicator(){return new Ft(this.util).render()}createErrorView(){const e=this.util,t=e.createDiv(["webview-error","flex"]);this.errorInfoText=e.createDiv(["webview-error-text"]),t.appendChild(this.errorInfoText),this.setErrorTextWithLink(this.props.errorInfoText);const s=e.createIconButton({css:["webview-error-button-close"],icon:this.props.closeButtonIcon,iconCss:[],title:this.props.errorInfoDismissLabel});return s.onclick=this.removeErrorView.bind(this),t.appendChild(s),t}setErrorTextWithLink(e){var t;const s=this.util,i=u(e);let o;const a=/\{0\}(.*)\{\/0\}/g,n=null===(t=a.exec(i))||void 0===t?void 0:t[1];if(n){const e=s.createAnchor("",n,["webview-alt-link"]);o=i.replace((0,r.resetRegex)(a),e.outerHTML)}else o=s.createAnchor("",i,["webview-alt-link"]).outerHTML;this.errorInfoText.innerHTML=o,this.errorAltLink=this.errorInfoText.querySelector("a")}removeErrorView(){const e=this.util;this.isErrorViewOpen&&(e.addCSSClass(this.errorView,jt),setTimeout((()=>{this.component.removeChild(this.errorView),this.isErrorViewOpen=!1}),600))}}const Yt=window.setTimeout,Jt=window.setInterval,Zt=36e5,Xt=864e5,Qt="relTimeNow",es="relTimeMoment",ts="relTimeMin",ss="relTimeHr";class is{constructor(e,t){this.util=t,this.i18n=e.i18n[e.locale];const s=e.icons,i=e.name,o="-has-message-icon";this.cssPrefix=i,this.cssSkill=`${i}-left ${s.avatarBot?`${i}${o}`:""}`,this.cssUser=`${i}-right ${s.avatarUser?`${i}${o}`:""}`}render(){const e=this.util;let t=this.element;return t?(t.setAttribute("aria-live","off"),t.setAttribute("aria-hidden","true")):t=e.createDiv(),t.className=`${this.cssPrefix}-relative-timestamp ${this.css}`,this.element=t,t}setLocale(e){if(this.i18n=e,this.key)switch(this.key){case Qt:case es:this.setTime(this.i18n[this.key]);break;case ts:case ss:this.setTime(this.i18n[this.key].replace("{0}",`${this.counter}`))}}setRelativeTime(e){const t=(new Date).getTime()-e.getTime(),s=Math.floor(t/1e3),i=Math.floor(s/60),o=Math.floor(i/60),a=Math.floor(o/24),n=Math.floor(a/30),r=Math.floor(n/12);r>0?this.setYears(r):n>0?this.setMonths(n):a>0?this.setDays(a):o>0?this.setHours(o):i>0?this.setMinutes(i):this.setMoment(s)}refresh(e){this.css=e===i.l.Skill?this.cssSkill:this.cssUser,this.element.className=`${this.cssPrefix}-relative-timestamp ${this.css}`,this.setNow()}remove(){var e;(null===(e=this.element)||void 0===e?void 0:e.parentElement)&&this.element.remove()}setNow(){this.runTimeout(Qt,1e4,this.setMoment.bind(this))}setMoment(e=10){e*=1e3,this.runTimeout(es,6e4-e,this.setMinutes.bind(this))}setMinutes(e=1){this.runTimer(this.i18n,ts,6e4,60,this.setHours.bind(this),e)}setHours(e=1){this.runTimer(this.i18n,ss,Zt,24,this.setDays.bind(this),e)}setDays(e=1){this.runTimer(this.i18n,"relTimeDay",Xt,30,this.setMonths.bind(this),e)}setMonths(e=1){this.runTimer(this.i18n,"relTimeMon",2592e6,12,this.setYears.bind(this),e)}setYears(e=1){this.runTimer(this.i18n,"relTimeYr",31536e6,60,(()=>{}),e)}runTimeout(e,t,s){this.resetTimer(),this.setTime(this.i18n[e]),this.key=e,this.updateTimer=Yt((()=>{s()}),t)}runTimer(e,t,s,i,o,a=1){this.resetTimer(),this.setTime(e[t].replace("{0}",`${a}`)),this.key=t,this.counter=a,this.updateTimer=Jt((()=>{a++,this.counter=a,a>i?(clearInterval(this.updateTimer),o()):this.setTime(e[t].replace("{0}",`${a}`))}),s)}setTime(e){this.element.innerText=e}resetTimer(){clearTimeout(this.updateTimer),clearInterval(this.updateTimer)}}class os{constructor(e,t){let s,o;if(this.config=t,this.isTTSEnabled=!0,this.isVoiceEnabled=!0,this.renderAsListItem=!1,this.recognitionLocaleMap={},this.synthesisLocaleVoiceMap={},this.supportedLangList=[],this.core=t.webCore,this.settings=t.settings,this.localizedText=this.settings.i18n[this.settings.locale],this.cssPrefix=t.settings.name,e&&(this.langOptions=Object.assign(Object.assign({},e),{supportedLangs:e.supportedLangs?[...e.supportedLangs]:[]}),s=this.langOptions.supportedLangs,o=this.langOptions.primary,"string"==typeof o&&(this.langOptions.primary=o.toLowerCase())),s&&s.length)if(s.forEach((e=>{e.lang=e.lang.toLowerCase()})),s.length>1?(s.unshift({lang:"und",label:this.localizedText.language_detect}),this.langOptions.primary||(this.langOptions.primary=null)):this.langOptions.primary=s[0].lang,this.supportedLangList=s.map((e=>e.lang)),this.settings.enableBotAudioResponse){const e=t.synthesisVoices;if(e&&e.length){const t={};s.forEach((s=>{const i=e.find((e=>e.lang.indexOf(s.lang)>=0));i&&(t[s.lang]=i)})),this.synthesisLocaleVoiceMap=t}}else this.updateSynthesis=()=>{};if(this.settings.enableSpeech){const e={};(0,r.getValues)(i.k).forEach((t=>{e[t.substring(0,2)]=t,e[t]=t})),ns(i.k.EN_GB,e),ns(i.k.EN_AU,e),ns(i.k.EN_IN,e),this.recognitionLocaleMap=e}else this.updateRecognition=()=>{}}render(e){const t=this.config.util,s=this.cssPrefix,i="language-selection",o=`${s}-${i}-button`,a=`${s}-${i}-menu`,n=this.langOptions;let r;if(this.renderAsListItem=e,!(n&&n.supportedLangs&&n.supportedLangs.length>=2))return null;if(!this.component){const s=this.settings.icons.language||ce,c=t.createIconButton({css:["header-button","button-lang"],icon:s,iconCss:[],title:this.localizedText.languageSelectDropdown}),l=t.createListItem("action-menu-option-lang",this.localizedText.languageSelectDropdown,"lang",s,"action-item",null,!0),d=n.supportedLangs.map((e=>{const s=e.label,o=e.lang;return t.createListItem(`${i}-option-${o}`,s,o,"",`${i}-option`,(e=>{let t=e.target;"LI"!==t.tagName&&(t=t.parentElement);const s=t.dataset.value;this.selectLanguage(s)}))})),h=t.getMenu({menuId:a,menuClassList:[`${i}-menu`],menuItems:d,buttonId:o,menuButton:e?l:c});if(e){r=t.getMenuButton({button:l,menuId:a,menu:h});const e=t.createDiv(["arrow-icon"]),s=t.createImageIcon({icon:'<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M6 9L11.9746 15L18 9H6Z" fill="#161513"/></svg>',title:""});e.appendChild(s),r.appendChild(e),this.config.chatWidget.chatWidgetDiv.appendChild(h)}else{r=t.createDiv();const e=t.getMenuButton({button:c,menuId:a,menu:h});r.appendChild(e),r.appendChild(h),c.id=o}this.disableComponent(!1)}return this.component=r,r}setLocale(e){this.component&&this.langOptions.supportedLangs.forEach((t=>{const s=t.lang,i=document.getElementById(`language-selection-option-${s}`),o=i.querySelector("span"),a=t.label||e[`language_${"und"===s?"detect":s}`]||t.lang;i.title=a,o.innerText=a}))}setTag(e,t=!0){let s="";null!==e&&(s=e.toLowerCase()),this.supportedLangList.length&&(s=this.supportedLangList.indexOf(s)>=0?s:null),this.selectLanguage(s,t)}disableComponent(e){if(this.component){const t=this.config.util,s=this.component;if(this.renderAsListItem){const i="disable";e?t.addCSSClass(s,i):t.removeCSSClass(s,i)}else s.querySelector("button").disabled=e}}selectLanguage(e,t=!0){let s=e;this.localizedText=this.settings.i18n[s],this.component&&this.updateActiveLocale(s),"und"===s&&(s=null),t&&(this.updateProfile(s),this.config.storageService.setItem(as(this.settings),s)),this.updateSynthesis(s),this.updateRecognition(s),this.config.chatWidget.onLanguageUpdate(s,t),this.currentTag!==s&&(this.currentTag=s,this.config.eventDispatcher.trigger(o.CHAT_LANG,s))}updateProfile(e){if(this.core.isConnected()){const t={profile:{languageTag:e}};e||(t.profile.locale=e);const s=this.settings.sdkMetadata?Object.assign({version:j},this.settings.sdkMetadata):{version:j};this.core.updateUser(t,{sdkMetadata:s})}}updateSynthesis(e){const t=this.config.chatWidget;if(e){if(this.isTTSEnabled||(t.enableSpeechSynthesisService(!0),this.isTTSEnabled=!0),this.settings.enableBotAudioResponse){const t=this.synthesisLocaleVoiceMap[e]||{lang:e};this.core.setTTSVoice([t])}}else this.isTTSEnabled=!1,this.settings.enableBotAudioResponse&&this.core.cancelTTS(),t.enableSpeechSynthesisService(!1)}updateRecognition(e){const t=this.config,s=this.recognitionLocaleMap[e],i=t.chatWidget;s?(this.isVoiceEnabled||(i.setVoiceRecognitionService(!0),this.isVoiceEnabled=!0),this.core.setRecognitionLocale(s)):(this.isVoiceEnabled=!1,this.core.stopRecognition(),this.core.setRecognitionLocale(null),i.setVoiceRecognitionService(!1))}updateActiveLocale(e){const t=this.config.util,s=e||"und",i=document.getElementById(`${this.cssPrefix}-language-selection-menu`),o="active";if(i){const e=i.querySelector(`li.${this.cssPrefix}-${o}`);e&&t.removeCSSClass(e,o);const a=i.querySelector(`[data-value="${s}"]`);a&&t.addCSSClass(a,o)}}initLanguage(){const{primary:e}=this.langOptions||{},t=this.config.storageService.getItem(as(this.settings));let s=e;t&&(s="null"===t?null:t),void 0!==s&&this.setTag(s)}}function as(e){return`${e.name}-${e.channelId}-${e.userId}`}function ns(e,t){navigator.language.toLowerCase()===e&&(t[e.substring(0,2)]=e)}class rs{constructor(e){this.getItem=e=>(!this.cache[e]&&this.isStorage&&(this.cache[e]=this.storage.getItem(e)),this.cache[e]),this.setItem=(e,t)=>{this.isStorage?(this.storage.setItem(e,t),delete this.cache[e]):this.cache[e]=t},this.removeItem=e=>{this.isStorage&&this.storage.removeItem(e),delete this.cache[e]},this.cache={},n(e)?(this.isStorage=!0,this.storage=window[e]):this.isStorage=!1}}const cs="keydown";class ls{constructor(e){var t;this.keyMap=new Map,this.isInit=!0,this.onKeyDown=e=>{if(ds(e)&&this.activate(e.code)){const e=document.querySelector(this.inputName);if(e){const t=e.value.length;setTimeout((()=>{e.value.length>t&&(e.value=e.value.slice(0,t))}))}}};const s=null!==(t=e.name)&&void 0!==t?t:"oda-chat";this.inputName=`.${s}-user-input`}add(e,t,s=!0){this.isInit&&(this.init(),this.isInit=!1);const i=e.toUpperCase(),o=isNaN(i)?`Key${i}`:`Digit${i}`;this.keyMap.set(o,{check:s,elem:t}),t.setAttribute("aria-keyshortcuts",`Alt+${i}`)}setWidget(e){this.widget=e}remove(){document.removeEventListener(cs,this.onKeyDown)}init(){document.addEventListener(cs,this.onKeyDown)}activate(e){let t=!1;const s=this.keyMap.get(e),i=s&&s.elem;return i&&hs(s.check?this.widget:i)&&!i.disabled&&(i.focus(),i.click(),t=!0),t}}const ds=e=>e.altKey&&!e.ctrlKey&&!e.metaKey&&!e.shiftKey&&!e.repeat,hs=e=>null!==e.offsetParent,ps=window.BroadcastChannel,gs="collapsed",us="expanded",ms="none",bs=window.setTimeout,fs=[i.i.Suggest,i.i.SessionClosed,i.i.CloseSession,i.i.Status],vs=[i.i.Text,i.i.Attachment,i.i.Location,i.i.FormSubmission];class ws extends Be{constructor(e,t,s,o,a,n,r,c,l,d,h,p){var g,u;super(),this.settings=e,this.util=t,this.connect=s,this.openChat=o,this.closeChat=a,this.handleSessionEnd=n,this.receivedMessage=r,this.sentMessage=c,this.getUnreadMessagesCount=l,this.onConnectionStatusChange=d,this.core=h,this.eventDispatcher=p,this.skillMessages=[],this.FINAL_RESULT_DISPLAY_TIMEOUT=200,this.logger=new R("ChatComponent"),this.attachmentDivs=[],this.unreadMsgCount=0,this.latestSkillMessages=[],this.isNewMessage=!0,this.isTTSMute=!0,this.isInitMessageSent=!1,this.isExpanded=!1,this.isFirstMessage=!0,this.isResponseReceived=!1,this.messageIDs=[],this.accessKeyElementsMap=new Map,this.cssPrefix=e.name,this.currentLocale=e.locale,this.localeText=e.i18n[e.locale],this.isOpen=!1,this.isExpanded="init"===(null===(g=e.initMessageOptions)||void 0===g?void 0:g.sendAt)||e.openChatOnLoad||e.embedded,this.isInitMessageSent=e.enableHeadless,this.isFirstConnect=!0,this.enableDefaultBotResponse=this.settings.enableDefaultClientResponse,this._configureStorage(),this.lastMessageHasGlobalAction=!1;const m=this.storageService.getItem(this.userAvatarStorageId);m&&(e.icons.avatarUser=m),this.settings.enableTabsSync||(this._initBroadcaster=()=>{}),this.core.on(i.g.Open,(()=>this._sendInitMessages())),this.core.on(i.g.State,(e=>this._onChatServerStatusChange(e))),this.core.on(i.g.MessageReceived,(e=>this._onMessageReceived(e))),this.header=new st(this.settings,this.util,this.closeChat.bind(this),this.clearConversationHistory.bind(this),this.onToggleNarration.bind(this),this.core,this.showEndConversationPrompt.bind(this),this.setHotkeyMap.bind(this)),this.settings.enableBotAudioResponse&&(this.isTTSMute=this.settings.initBotAudioMuted),"function"!=typeof d&&(this.onConnectionStatusChange=()=>{}),this.settings.showTypingIndicator&&(this.typingIndicator=new $t(z.LEFT,e,t)),!this.settings.enableTimestamp||"relative"!==this.settings.timestampMode&&"default"!==this.settings.timestampMode?(this.setTimestampHeaderIfNewDate=()=>{},this.updateRelativeTimestamp=()=>{}):this.relativeTimestamp=new is(e,t),"action"!==(null===(u=this.settings.focusOnNewMessage)||void 0===u?void 0:u.toLowerCase())&&(this.focusMessageFirstAction=()=>{});const b=this.storageService.getItem(this.agentNameStorageId);b&&(this.agentSession=JSON.parse(b),this.setAgentTypingCue())}render(){this.element=this._createElement(),this.settings.multiLangChat&&this._initMultiLangChat(),this.configHotkeys(this.settings)}embedInElement(e){const t=document.getElementById(e);if(!t)throw new Error("Can not embed chat widget.");this.util.addCSSClass(t,"wrapper",this.settings.theme,"embedded"),this.appendToElement(t)}showChat(){if(!this.isOpen){const e=this.util;e.removeCSSClass(this.element,gs),e.addCSSClass(this.element,us),e.removeCSSClass(this.chatWidgetDiv,ms),this.settings.embedded||bs((()=>{e.addCSSClass(this.botButton,ms)}),250),this.isOpen=!0,this.isExpanded=!0,this.updateNotificationBadge(0),this._scrollToBottom(),this.footer.focusTextArea(),this._sendInitMessages()}}onClose(){if(this.isOpen){const e=this.util;this._ttsCancel(),e.removeCSSClass(this.element,us),e.addCSSClass(this.element,gs),this.settings.embedded||(e.removeCSSClass(this.botButton,ms),bs((()=>{e.addCSSClass(this.chatWidgetDiv,ms),this.botButton.focus()}),250),this.updateNotificationBadge(this.getUnreadMessagesCount())),this.isOpen=!1}}sendExitEvent(){const e={messagePayload:{type:i.i.CloseSession},userId:this.settings.userId};if(this.settings.delegate&&this.settings.delegate.beforeEndConversation&&(0,r.isFunction)(this.settings.delegate.beforeEndConversation))try{this.settings.delegate.beforeEndConversation(e).then((e=>{e&&this.sendMessage(e,{hidden:!0,delegate:!1})}))}catch(e){this.logger.error(e)}else this.sendMessage(e,{hidden:!0,delegate:!1});this.isInitMessageSent=!1}updateNotificationBadge(e){var t;this.unreadMsgCount=e,e>0?(this.botNotificationBadge.innerText=`${e}`,this.botButton.appendChild(this.botNotificationBadge)):(null===(t=this.botNotificationBadge)||void 0===t?void 0:t.parentElement)&&this.botNotificationBadge.remove()}onToggleNarration(e){this._toggleNarration(e),this.eventDispatcher.trigger(o.CLICK_AUDIO_RESPONSE_TOGGLE,e)}remove(){super.remove(),this.settings.embedded&&window.removeEventListener("resize",this.resizeEventListener);const e=this.hotkeysManager;e&&e.remove()}clearConversationHistory(){this.clearMessages(this.settings.userId),this._clearChatPane(),this._broadcastAction({type:"actionClearHistory"}),this.lastMessageSenderType=null,this._stopDefaultMessages(),this.updateNotificationBadge(0)}clearMessages(e,t){const s=`${this.settings.name}-${e}-messages`;(t?window[t]:this.storageService).getItem(s)&&this.storageService.removeItem(s)}clearAllMessage(){const e=null===window||void 0===window?void 0:window.localStorage,t=(null==e?void 0:e.length)||0;if(t){const s=/oda-chat-.*-messages/g;for(let i=0;i<t;i++){const t=e.key(i);(null==t?void 0:t.match(s))&&e.removeItem(t)}}}setUserInputMessage(e){this.footer.setUserInputText(e,this.core.isConnected())}setUserInputPlaceholder(e){this.footer.setUserInputPlaceholder(e)}getWebViewComponent(){return this.webViewComponent}refreshWebView(e){this.webViewComponent.setProps(e),this.webViewElem.remove(),this.webViewElem=this.webViewComponent.render(),this.chatWidgetDiv.appendChild(this.webViewElem)}orientWidgetAnimation(){const e=this.element,t=Math.floor(window.innerWidth/2),s=e.offsetLeft;s<0?e.style.left="10px":s>window.innerWidth&&(e.style.right="10px"),s<t&&this.util.addCSSClass(e,"pos-left")}updateFullScreenWidth(e){const t=this.styleSheet.innerText;this.styleSheet.innerText=(0,r.updateCSSVar)(t,e,"--width-full-screen")}updateWidgetMaxHeight(){const e=this.styleSheet.innerText;this.styleSheet.innerText=(0,r.updateCSSVar)(e,`${window.innerHeight}px`,"--widget-max-height")}setHeight(e){const t=this.chatWidgetDiv;t&&(t.style.height=e,this.settings.height=e)}setWidth(e){const t=this.chatWidgetDiv;t&&(t.style.width=e,this.settings.width=e,this.updateFullScreenWidth(e))}setSize(e,t){this.setHeight(t),this.setWidth(e)}setMessagePadding(e){const t=document.getElementsByClassName(`${this.cssPrefix}-message-bubble`);for(const s of t){s.style.padding=e,this.settings.messagePadding=e}}setChatBubbleIconHeight(e){const t=document.getElementsByClassName(`${this.cssPrefix}-message-bubble`);for(const s of t){s.style.height=e,this.settings.height=e}}setChatBubbleIconWidth(e){const t=document.getElementsByClassName(`${this.cssPrefix}-message-bubble`);for(const s of t){s.style.width=e,this.settings.width=e}}setChatBubbleIconSize(e,t){const s=document.getElementsByClassName(`${this.cssPrefix}-message-bubble`);for(const i of s){const s=i;s.style.width=e,s.style.height=t,this.settings.width=e,this.settings.height=t}}onMessageActionClicked(e){switch(this.onSpeechToggle(!1),e.type){case i.b.Postback:this._scrollToBottom(),e.getPayload().then((t=>{const s=(0,i.q)({postback:t,text:e.label,type:i.i.Postback});this.sendMessage(s)}));break;case i.b.Location:this._shareUserLocation();break;case i.b.Share:navigator.share?e.getPayload().then((t=>{navigator.share({text:t,title:e.label})})):this._showBanner(this.localeText.shareFailureMessage);break;case i.b.SubmitForm:const t=e.messageComponent;if(!t.validateForm())break;const s=t.getSubmittedFields();if(this.settings.enableLocalConversationHistory){const e=this.getMessages();for(let o=e.length-1;o>=0;o--){const a=e[o];if(a.msgId===t.msgId&&a.messagePayload.type===i.i.EditForm){const e=a.messagePayload;(0,i.w)(e)?e.fields.forEach((e=>{(0,i.D)(e)||(e.defaultValue=s[e.id])})):e.formRows.forEach((e=>{e.columns.forEach((e=>{e.fields.forEach((e=>{(0,i.D)(e)||(e.defaultValue=s[e.id])}))}))}));break}}this.storageService.setItem(this.chatStorageId,JSON.stringify(e))}this._scrollToBottom(),e.getPayload().then((e=>{const t={postback:e,submittedFields:s,type:i.i.FormSubmission};e||delete t.postback,this.sendMessage((0,i.q)(t),{hidden:!0})}));break;case i.b.Call:e.getPayload().then((e=>{this.util.createAnchor(`tel:${e}`,"").click()}));break;default:e.getPayload().then((t=>{this.util.createAnchor(t,"",[],this.settings.openLinksInNewWindow,e.type===i.b.Url?this.settings.linkHandler:this.webviewLinkHandler).click()}))}}applyDelegates(e){var t;let s;s="string"==typeof e?(0,i.r)(e,null===(t=this.speechFinalResult)||void 0===t?void 0:t.speechId):(0,i.C)(e)?(0,i.o)(e):(0,i.B)(e)?(0,i.q)(e):e;const o=s.messagePayload.type,a=this.settings.delegate,n=a.beforePostbackSend,c=a.beforeSend;return o===i.i.Postback&&(0,r.isFunction)(n)?s=this._executeSendDelegate(s,n):vs.includes(o)&&(0,r.isFunction)(c)&&(s=this._executeSendDelegate(s,c)),s}sendMessage(e,t){if(this.textStreamComponent)return ys();this._stopDefaultMessages(),!this.settings.enableSpeechAutoSend&&this.speechFinalResult&&"string"==typeof e&&e.toLowerCase().indexOf(this.speechFinalResult.text.toLowerCase())>=0&&(e=(0,i.r)(e,this.speechFinalResult.speechId)),this.footer.focusTextArea(),this._ttsCancel(),void 0===(t=t||{}).delegate&&(t.delegate=!0),t.delegate&&this.settings.delegate&&(e=this.applyDelegates(e));const s=this.settings.sdkMetadata?Object.assign({version:j},this.settings.sdkMetadata):{version:j};return e&&this.core.sendMessage(e,{sdkMetadata:s}).then((s=>{this.logger.debug("onMessageSent",e),(0,i.y)(s.messagePayload)||(this.getAgentDetails()||this.showTypingIndicator(),this.sentMessage(s),this._onSendMessage(),this.isResponseReceived=!1,this.enableDefaultBotResponse&&this.startDefaultResponseTimer(),this.speechFinalResult=null,(null==t?void 0:t.hidden)?this.lastMessageSenderType=i.l.User:this._onMessageSent(s))}))}uploadFile(e,t){if(this.textStreamComponent)return ys();const s=this.localeText;this._ttsCancel(),this._onSendMessage();const o=new Promise(((o,a)=>{var n,r;if(this.settings.enableHeadless){const t=this.settings.sdkMetadata?Object.assign({version:j},this.settings.sdkMetadata):{version:j};this.core.uploadAttachment(e,{sdkMetadata:t}).then((e=>this.core.sendMessage(this.settings.delegate?this.applyDelegates(e):e,{sdkMetadata:t}))).then((e=>{o(e)})).catch((e=>{a(e)}))}else{this._scrollToBottom();const c=`${null===(n=e.name)||void 0===n?void 0:n.replace(/[\s:'"\\/[\]~,.;^`()@#%*+=$&!{}?<>|]/g,"")}${Math.floor(1e4+9e4*Math.random())}${Date.now()%1e5}`,l=this.util.createDiv();if(l.id=c,this.attachmentDivs.push({divId:c,fileName:e.name}),this.setTimestampHeaderIfNewDate(new Date),this._appendMessageToConversation(l),this.maxSize=this.customFileMaxSize?this.customFileMaxSize:t?t.maxSize:G,e.size>this.maxSize){this._scrollToBottom();const t=this.maxSize/1048576;let o=t.toString();"number"==typeof(r=t)&&isFinite(r)&&Math.floor(r)===r||(o=t.toFixed(3));const n=`${e.name} - ${s.uploadFailed}`,l=s.uploadFileSizeLimitExceeded.replace("{0}",o);this._displayUploadError(n,l,c),this.updateRelativeTimestamp(i.l.User),a(new Error(l))}else if(0===e.size){this._scrollToBottom();const t=`${e.name} - ${s.uploadFailed}`,o=s.uploadFileSizeZeroByte;this._displayUploadError(t,o,c),this.updateRelativeTimestamp(i.l.User),a(new Error(o))}else{const t=new Vt(e.name,z.RIGHT,this.settings,this.util),s=this.settings.sdkMetadata?Object.assign({version:j},this.settings.sdkMetadata):{version:j};this.updateRelativeTimestamp(i.l.User),l.appendChild(t.render()),this._scrollToBottom(),this.core.uploadAttachment(e,{sdkMetadata:s}).then((e=>this.core.sendMessage(this.settings.delegate?this.applyDelegates(e):e,{sdkMetadata:s}))).then((t=>{t.messagePayload.attachment.title=e.name,l.remove(),this.attachmentDivs=this.attachmentDivs.filter((e=>e.divId!==c)),this.isFirstMessage=!1,this.sentMessage(t),this._onMessageSent(t),o(t)})).catch((t=>{this._handleUploadError(e.name,t.message,c),a(t)}))}}}));return o.catch((e=>{this.logger.error(e)})),o}refreshTTS(){this.header.showTTSButton(!!this.settings.ttsService)}getSuggestions(e){if(this.textStreamComponent)return ys();if(!this.settings.enableAutocompleteClientCache||this.settings.enableAutocompleteClientCache&&!this.footer.getSuggestionsValid())return this.core.getSuggestions(e).then((e=>(this.footer.displaySuggestions(e),e))).catch((()=>[]));const t=this._filterSuggestions(this.footer.getSuggestions(),e);return null!==this.footer&&this.footer.displaySuggestions(t),Promise.resolve(t)}getUnreadMsgsCount(){return this.unreadMsgCount}getMessages(){const e=this.storageService.getItem(this.chatStorageId);return e?JSON.parse(e).map((e=>Object.assign({},e))):[]}loadChat(){const e=this.getMessages();e.length&&this.storageService.setItem(this.chatStorageId,JSON.stringify(e))}getAgentDetails(){return this.agentSession}setAgentDetails(e){this.agentSession=Object.assign(Object.assign({},this.agentSession),e),this.setAgentTypingCue(),this.storageService.setItem(this.agentNameStorageId,JSON.stringify(this.agentSession))}setUserAvatar(e){this.settings.icons.avatarUser=e,this.storageService.setItem(this.userAvatarStorageId,e);document.querySelectorAll(`.${this.cssPrefix}-right .${this.cssPrefix}-message-icon`).forEach((t=>{t.parentElement.replaceWith(this.getAvatar(e,this.localeText.avatarUser))}))}_saveMessage(e){if(this.settings.enableLocalConversationHistory){const t=this.getMessages();t.length>=this.settings.messageCacheSizeLimit&&t.splice(0,t.length-(this.settings.messageCacheSizeLimit-1));let s=JSON.stringify(e).substring(1,JSON.stringify(e).length-1);s=`{${s}, "date":"${new Date}"}`,t.push(JSON.parse(s)),this.storageService.setItem(this.chatStorageId,JSON.stringify(t))}}_configureStorage(){const e=this.settings;e.userId?e.storageType!==ze.LOCAL&&e.storageType!==ze.SESSION&&(e.storageType=ze.LOCAL):e.storageType=ze.SESSION,this.chatStorageId=`${e.name}-${e.userId}-messages`,this.agentNameStorageId=`${e.name}-${e.userId}-agent-details`,this.userAvatarStorageId=`${e.name}-${e.userId}-user-avatar`,this.storageService=new rs(e.storageType)}setVoiceRecognitionService(e){this.footer.disableVoiceModeButton(!e,{src:"lang"})}enableSpeechSynthesisService(e){this.header.disableTTSButton(!e)}onShareLocation(){this._shareUserLocation()}setPrimaryChatLanguage(e){this.multiLangChat.setTag(e)}onLanguageUpdate(e,t=!0){const s=this.settings.i18n,i=Object.assign(Object.assign(Object.assign({},s.en),s[this.settings.locale]),s[e]);t&&this._broadcastAction({type:"actionLanguage",tag:e}),this.currentLocale=e,this.botButton.title=i.chatButtonTitle||i.chatTitle,this.header.setLocale(i),this.footer.setLocale(i),this.util.setLocale(i),this.typingIndicator.updateTypingCueIcon(i.avatarBot);document.querySelectorAll(`.${this.cssPrefix}-message-icon`).forEach((e=>{const t=e.parentElement.parentElement.className.indexOf(`${this.cssPrefix}-left`)<0?i.avatarUser:i.avatarBot;"img"===e.localName?e.alt=t:e.setAttribute("aria-label",t)})),this.webViewComponent.setProps({accessibilityTitle:i.webViewAccessibilityTitle,closeButtonLabel:i.webViewClose,errorInfoDismissLabel:i.webViewErrorInfoDismiss,errorInfoText:i.webViewErrorInfoText}),this.multiLangChat&&this.multiLangChat.setLocale(i),this.relativeTimestamp&&this.relativeTimestamp.setLocale(i),this.separator&&(this.separator.innerText=i.previousChats),this.localeText=i}showTypingIndicator(){const e=document.getElementById(`${this.cssPrefix}-connection-error`);e&&e.remove(),this.settings.showTypingIndicator&&(this.typingIndicator.append(this.conversationContainer),this._scrollToBottom())}hideTypingIndicator(){this.settings.showTypingIndicator&&this.typingIndicator.remove()}showConnectionError(){const e={type:i.i.Text,text:this.localeText.connectionFailureMessage,globalActions:[{type:i.b.Postback,label:this.localeText.connectionRetryLabel}]},t=zt.fromMessage(this.settings,this.util,{messagePayload:e});t.onActionClick=()=>{this.connect()},this.showMessage(`${this.cssPrefix}-connection-error`,t)}showMessage(e,t){var s;const i=this.util.wrapMessageBlock(t.render(),this.settings.icons.avatarBot,z.LEFT);i.id=e,this.conversationContainer.appendChild(i),(null===(s=this.typingIndicator)||void 0===s?void 0:s.isVisible())&&this.hideTypingIndicator(),this._scrollToBottom()}showEndConversationPrompt(){const e=this.localeText;this.endConversationPrompt=this.util.getBanner({text:e.endConversationConfirmMessage||"",description:e.endConversationDescription||"",actions:[{label:e.noText,handler:this.closePrompt},{label:e.yesText,handler:this.endConversation,type:"filled"}]},this),this.util.addCSSClass(this.endConversationPrompt,"end-conversation-prompt"),Oe(this.chatPane.element,this.endConversationPrompt)}updateDefaultResponse(e){if(this.isFirstMessage=!1,!this.isResponseReceived){const t={source:i.m.Bot,messagePayload:{type:i.i.Text,text:e},userId:this.settings.userId,msgId:`${Date.now()}`};this._saveMessage(t),this._renderMessagesAndScroll([t])}}startDefaultResponseTimer(){const e=this.localeText;this.defaultResponseTimer=bs((()=>{this.isFirstMessage&&this.updateDefaultResponse(e.defaultGreetingMessage),this.defaultResponseInterval=window.setInterval((()=>{this.updateDefaultResponse(e.defaultWaitMessage)}),this.settings.defaultWaitMessageInterval*q),this.waitMessageClearTimer=bs((()=>{window.clearInterval(this.defaultResponseInterval)}),(this.settings.typingIndicatorTimeout-1)*q),this.defaultResponseTimer=bs((()=>{this.hideTypingIndicator(),this.updateDefaultResponse(e.defaultSorryMessage)}),this.settings.typingIndicatorTimeout*q)}),this.settings.defaultGreetingTimeout*q)}endConversation(){this.sendExitEvent(),this.closePrompt()}closePrompt(){this.endConversationPrompt.querySelector(`.${this.cssPrefix}-prompt-banner-close-button`).click()}_onChatServerStatusChange(e){if(this.isFirstConnect&&(this._loadPreviousConversations(),this.isFirstConnect=!1),Number.isInteger(e)&&e!==i.e.Open){this._stopBroadcaster(),this.footer.isDisabled()||(this.footer.disable(),this.header.disable(),this.logger.debug("WebSocket not open, send message button disabled")),this._onDisconnection(),e===i.e.Connecting?this.showTypingIndicator():this.hideTypingIndicator();for(const e of this.attachmentDivs)this._handleUploadError(e.fileName,i.f.UploadNetworkFail,e.divId);this.multiLangChat&&this.multiLangChat.disableComponent(!0)}else this.lastMessageTime=void 0,this.hideTypingIndicator(),this._initBroadcaster(),this.footer.isDisabled()&&(this.footer.disable(!1),this.header.disable(!1),this.logger.debug("Connection established, send message button enabled")),this._onConnection();this.onConnectionStatusChange(e)}_initMultiLangChat(){const e=this.settings;this.multiLangChat=new os(e.multiLangChat,{webCore:this.core,chatWidget:this,eventDispatcher:this.eventDispatcher,settings:e,synthesisVoices:e.ttsVoice,storageService:new rs(e.storageType),util:this.util}),this.header.addLanguageSelect(this.multiLangChat)}_shareUserLocation(){const e=this.localeText;if(navigator&&navigator.geolocation){const t=new Vt(e.requestLocation,z.RIGHT,this.settings,this.util);this._appendMessageToConversation(t.render()),this._scrollToBottom(),(0,i.s)().then((e=>{const s=(0,i.q)({location:{latitude:e.latitude,longitude:e.longitude,title:void 0},type:i.i.Location});t.remove(),this.sendMessage(s)}),(s=>{let i;switch(s.code){case s.PERMISSION_DENIED:i=e.requestLocationDeniedPermission;break;case s.POSITION_UNAVAILABLE:i=e.requestLocationDeniedUnavailable;break;case s.TIMEOUT:i=e.requestLocationDeniedTimeout;break;default:i=e.requestLocationDeniedPermission}this._showBanner(i),t.remove()}))}else this._showBanner(e.requestLocationDeniedUnavailable)}_filterSuggestions(e,t){const s=[];for(const i of e)i.search(new RegExp(t,"i"))>=0&&s.push(i);return s}_handleUploadError(e,t,s){const o=this.localeText,a=`${e} - ${o.uploadFailed}`;let n="";switch(t){case i.f.UploadMaxSize:n=o.uploadFileSizeLimitExceeded.replace("{0}",this.maxSize.toString());break;case i.f.UploadZeroSize:n=o.uploadFileSizeZeroByte;break;case i.f.UploadBadFile:n=o.uploadUnsupportedFileType}this._displayUploadError(a,n,s)}_executeSendDelegate(e,t){var s;const o=JSON.parse(JSON.stringify(e));let a,n=JSON.parse(JSON.stringify(e));e.messagePayload.type===i.i.Text&&(null===(s=e.sdkMetadata)||void 0===s?void 0:s.speechId)&&(a=(e.messagePayload.text||"").toLowerCase());try{n=t(o)}catch(e){this.logger.error(e)}if(n&&n.messagePayload||(n=null),n&&!(0,i.G)(n)&&(this.logger.error("The generated delegate message is invalid. Sending original message instead."),n=e),a&&n)if(n.messagePayload)if(n.messagePayload.type===i.i.Text){const e=n.messagePayload.text;(null==e?void 0:e.toLowerCase().indexOf(a))<0&&delete n.sdkMetadata}else delete n.sdkMetadata;else delete n.sdkMetadata;return n}_displayUploadError(e,t,s){const i=document.getElementById(s);if(i){i.firstElementChild&&i.removeChild(i.firstElementChild),this.attachmentDivs=this.attachmentDivs.filter((e=>e.divId!==s));const o=new Nt(e,t,z.RIGHT,this.settings,this.util,!0),a=this.settings.icons.error||ie;i.appendChild(o.render(a))}}_makeButtonDraggable(e,t){const s=this.util;let i,o,a=!1,n=!1,r=0,c=0,l=0,d=0,h=0,p=0;const g=e=>{let t,s;const i=e.target.classList;for(let o=0;o<i.length;o++){i[o].indexOf("button-drag-handle")&&("touchstart"===e.type?(t=e.touches[0].clientX,s=e.touches[0].clientY):(t=e.clientX,s=e.clientY),r=t-l,c=s-d,h=t,p=s,a=!0)}},u=g=>{let u,m;if(a){"touchmove"===g.type?(u=g.touches[0].clientX,m=g.touches[0].clientY):(u=g.clientX,m=g.clientY);const a=u-h,b=m-p;i=u-r,o=m-c,l=i,d=o,(a>=5||b>=5||a<=-5||b<=-5)&&(s.addCSSClass(e,"drag"),t.style.transform=`translate3d(${i}px, ${o}px, 0)`,t.onclick=null,n=!0)}},m=()=>{if(n){bs((()=>{t.onclick=this.openChat.bind(this)}),10),t.focus(),n=!1}a=!1},b=s.createDiv(["button-drag-handle"]);t.appendChild(b),t.addEventListener("touchstart",g),document.addEventListener("touchmove",u),t.addEventListener("touchend",m),t.addEventListener("mousedown",g),document.addEventListener("mousemove",u),t.addEventListener("mouseup",m)}addHeaderAction(e){this.header.addAction(e)}updateHeaderAction(e){this.header.updateHeaderAction(e)}_createElement(){var e,t,s,i,o;const a=this.settings,n=this.util,r=this.localeText,c=n.createDiv(a.embedded?[]:["wrapper",a.theme,a.enableHeadless?"none":""]);this.chatWidgetDiv=n.createDiv(["widget","flex","col"]),this.chatWidgetDiv.setAttribute("role","region"),this.chatWidgetDiv.setAttribute("aria-labelledby",`${this.cssPrefix}-title`),this.header.render(),this.chatWidgetDiv.appendChild(this.header.element),a.embedTopStickyId&&this.addCustomBanner(a.embedTopStickyId,this.chatWidgetDiv,["embed-sticky-top"]),this.chatPane=new it(n),this.scrollContent=n.createDiv(["conversation-pane",this.settings.icons.avatarBot?"bot-icon":"",this.settings.icons.avatarUser?"user-icon":""]),"bottom"===a.conversationBeginPosition&&(this.scrollContent.style.marginTop="auto"),a.embedTopScrollId&&this.addCustomBanner(a.embedTopScrollId,this.scrollContent,["embed-scroll-top"]),this.conversationContainer=n.createDiv(["conversation-container"]),this.conversationContainer.setAttribute("role","log"),this.conversationContainer.setAttribute("aria-live","polite"),this.conversationContainer.setAttribute("aria-atomic","false"),this.scrollContent.appendChild(this.conversationContainer),this.chatPane.element.appendChild(this.scrollContent),a.embedBottomScrollId&&this.addCustomBanner(a.embedBottomScrollId,this.chatPane.element,["embed-scroll-bottom"]),this.chatWidgetDiv.appendChild(this.chatPane.element),a.embedBottomStickyId&&this.addCustomBanner(a.embedBottomStickyId,this.chatWidgetDiv,["embed-sticky-bottom"]),this.footer=new We(n,this.sendMessage.bind(this),this.uploadFile.bind(this),a,this.getSuggestions.bind(this),this.onSpeechToggle.bind(this),this._shareUserLocation.bind(this),this.sendUserTypingStatusMessage.bind(this),this.eventDispatcher,this,this.setHotkeyMap.bind(this)),this.chatWidgetDiv.appendChild(this.footer.element),(e=a.webViewConfig).accessibilityTitle||(e.accessibilityTitle=r.webViewAccessibilityTitle),(t=a.webViewConfig).closeButtonLabel||(t.closeButtonLabel=r.webViewClose),(s=a.webViewConfig).errorInfoDismissLabel||(s.errorInfoDismissLabel=r.webViewErrorInfoDismiss),(i=a.webViewConfig).errorInfoText||(i.errorInfoText=r.webViewErrorInfoText),(o=a.webViewConfig).closeButtonIcon||(o.closeButtonIcon=a.icons.close),this.webViewComponent=new Kt(a.webViewConfig,n,a),this.webViewElem=this.webViewComponent.render(),this.chatWidgetDiv.appendChild(this.webViewElem);const l=this.webViewComponent,d=`${this.cssPrefix}-webview`;if(this.webviewLinkHandler={target:d,onclick:function(){l.open(this.href)}},a.linkHandler&&a.linkHandler.target===d&&(a.linkHandler=this.webviewLinkHandler),c.appendChild(this.chatWidgetDiv),a.embedded)this.isOpen=!0,n.addCSSClass(c,"open");else{const e=a.icons.launch||(a.colors&&a.colors.branding?le.replace("#025e7e",a.colors.branding):le),t="button",s=n.createIconButton({css:[t],icon:e,iconCss:[`${t}-icon`],title:r.chatButtonTitle||r.chatTitle});s.classList.remove(`${this.cssPrefix}-icon`),this.botButton=s,this.botButton.onclick=this.openChat.bind(this),this.botNotificationBadge=n.createDiv(["notification-badge"]),c.appendChild(s),this.accessKeyElementsMap.set("launch",s),a.enableDraggableButton&&this._makeButtonDraggable(c,s),a.openChatOnLoad||n.addCSSClass(c,gs),n.addCSSClass(this.chatWidgetDiv,ms)}return c}_appendMessageToConversation(e){var t;this.conversationContainer.appendChild(e),(null===(t=this.typingIndicator)||void 0===t?void 0:t.isVisible())&&(this.hideTypingIndicator(),this.showTypingIndicator())}_scrollToBottom(){const e=this.chatPane.element;bs((()=>{e&&(e.scrollTop=e.scrollHeight)}),H.CHAT_SCROLL_DELAY)}_renderMessagesAndScroll(e){return(null==e?void 0:e.length)?new Promise((t=>{this.settings.clientAuthEnabled&&this.settings.enableAttachmentSecurity?this.core.getAuthToken().then((s=>{this._renderMessages(e,s.token),t(),this._scrollToBottom()})).catch((()=>{this._renderMessages(e),t(),this._scrollToBottom()})):(this._renderMessages(e),t(),this._scrollToBottom())})):(this._renderMessages(e),Promise.resolve())}getAgentNameDiv(e,t){var s;const i=this.settings.icons;(null===(s=e.messagePayload.channelExtensions)||void 0===s?void 0:s.agentSession)||(e.messagePayload.channelExtensions?e.messagePayload.channelExtensions.agentSession=this.agentSession:e.messagePayload.channelExtensions={agentSession:this.agentSession}),!this.agentSession.avatarImage&&i.avatarBot&&t.appendChild(this.getAgentInitialsIcon());const o=this.util.createDiv(["agent-name"]);return o.title=this.agentSession.name,o.innerHTML=this.agentSession.name,o.setAttribute("aria-hidden","true"),this.agentSession.nameTextColor&&(o.style.color=this.agentSession.nameTextColor),o}getAgentInitialsIcon(){const e=this.agentSession||{},t=e.name.split(" ").filter((e=>e));let s=t[0][0];return t.length>1&&(s+=t[t.length-1][0]),this.getAvatar(s.toUpperCase(),e.name,!0)}setAgentTypingCue(){if(this.settings.showTypingIndicator){const e=this.agentSession||{},t=this.settings.icons,s=this.localeText;t.avatarBot&&(!e.avatarImage&&e.name?this.typingIndicator.setAgentTypingCue(this.getAgentInitialsIcon()):this.typingIndicator.setAgentTypingCue(this.getAvatar(e.avatarImage||t.avatarBot,s.avatarAgent||s.avatarBot)))}}getAvatar(e,t,s=!1){const i=this.util,o=i.createDiv(["icon-wrapper",s?"agent-avatar":""]),a=this.agentSession||{};let n;return s?(n=i.createDiv(["agent-icon"]),n.innerText=e,a.avatarTextColor&&(n.style.color=a.avatarTextColor),a.avatarBackgroundColor&&(o.style.background=a.avatarBackgroundColor)):n=i.createImageIcon({icon:e,iconCss:["message-icon"],title:t}),o.appendChild(n),o}getTime(){const e=new Date,t=(0,r.formatDate)(e,{pattern:this.settings.timestampFormat,locale:this.settings.locale}),s=this.util.createDiv(["message-date"]);return s.setAttribute("aria-live","off"),s.setAttribute("aria-hidden","true"),s.innerText=`${t}`,s}_renderMessages(e,t){const s=this.util,o={locale:this.currentLocale,webviewLinkHandler:this.webviewLinkHandler,webCore:this.core};(null==t?void 0:t.length)&&(o.authToken=t,o.uri=this.settings.URI),e.forEach((e=>{var t,a,n,r,c;const l=zt.fromMessage(this.settings,this.util,e,o);if(!l)return;if(l instanceof $){const t=e.messagePayload;switch(this.showTypingIndicator(),t.streamState){case"start":this.footer.disable(),this.textStreamComponent=l;break;case"running":return void(this.textStreamComponent&&this.textStreamComponent.update(t));case"end":if(this.hideTypingIndicator(),this.footer.disable(!1),this.textStreamComponent)return this.textStreamComponent.update(t),void(this.textStreamComponent=null)}}else this.textStreamComponent=null;const d=Ot(e)?i.l.Skill:i.l.User,h=this.shouldReplaceMessage(e.messagePayload,d),p=h||this.shouldMergeMessages(e,d);let g;if(l.msgId=e.msgId,this.lastMessageSenderType=d,this.lastMessageType=e.messagePayload.type,this.lastMessageTime=Date.now(),this.lastMessageHasGlobalAction=e.messagePayload.globalActions&&0!==e.messagePayload.globalActions.length,this.lastMessageSenderName=(null===(a=null===(t=e.messagePayload.channelExtensions)||void 0===t?void 0:t.agentSession)||void 0===a?void 0:a.name)||"",Ot(e)&&(this.lastMessageSenderSource=e.source),p||(g=s.createDiv(["message-block","flex"]),this.lastMessageBlock=g),l.onActionClick=this.onMessageActionClicked.bind(this),void 0!==l.ratingId&&(this.pendingFeedback=l),Ot(e)){this.isNewMessage?this._onReceiveMessage(l):this.skillMessages.push(l);const t=Rt(e);if(this.messageIDs.indexOf(t)>=0)return;this.messageIDs.push(t),e.source===i.m.Agent?((null===(n=e.messagePayload.channelExtensions)||void 0===n?void 0:n.agentName)&&this.setAgentDetails({name:e.messagePayload.channelExtensions.agentName,avatarImage:this.settings.icons.avatarAgent,nameTextColor:null,avatarTextColor:null,avatarBackgroundColor:null}),(null===(r=e.messagePayload.channelExtensions)||void 0===r?void 0:r.agentSession)&&this.setAgentDetails(e.messagePayload.channelExtensions.agentSession)):(this.storageService.removeItem(this.agentNameStorageId),this.agentSession=null),this.focusMessageFirstAction(l)}else if(this.pendingFeedback){const t=e;if(t.messagePayload.type===i.i.Text||t.messagePayload.type===i.i.Postback){const e=t.messagePayload;this.pendingFeedback.highlightRating(e.text)}this.pendingFeedback=null}this.setTimestampHeaderIfNewDate(e.date||new Date),g&&(this.createMessageBlock(e,g),this._appendMessageToConversation(g));const u=this.lastMessageBlock.querySelector('[class*="message-list"]'),m=this._renderMessage(e,l,u);if(m){if(e.messagePayload.type===i.i.Card){const e=u.querySelectorAll('[class*="message-bubble"]');if(e.length){e[e.length-1].classList.add(`${this.cssPrefix}-before-card`)}}h&&u.lastElementChild?null===(c=u.lastElementChild)||void 0===c||c.replaceWith(m):u.appendChild(m)}this.updateRelativeTimestamp(d)}))}shouldReplaceMessage(e,t){var s,o;if(t===i.l.Skill&&e.type===i.i.EditForm&&(null===(s=this.lastMessageBlock)||void 0===s?void 0:s.className.includes(`${this.cssPrefix}-left`))&&this.lastMessageType===i.i.EditForm){const t=null===(o=e.channelExtensions)||void 0===o?void 0:o.replaceMessage;return!0===t||t&&"true"===(null==t?void 0:t.toLowerCase())}return!1}shouldMergeMessages(e,t){var s,o;if(!(Date.now()-this.lastMessageTime<1e4))return!1;if(Ot(e)&&e.source===i.m.Agent&&(null===(s=e.messagePayload.channelExtensions)||void 0===s?void 0:s.agentSession)){const t=null===(o=e.messagePayload.channelExtensions)||void 0===o?void 0:o.agentSession;return this.lastMessageSenderName===t.name}return!(this.lastMessageSenderType!==t||Ot(e)&&e.source!==this.lastMessageSenderSource||this.lastMessageHasGlobalAction)}createMessageBlock(e,t){const s=this.settings.icons,o=this.localeText,a=this.util,n=this.agentSession||{};let r,c,l;if(Ot(e)){if(e.source===i.m.Agent?(r=n.name&&this.getAgentNameDiv(e,t),c=s.avatarBot&&(n.avatarImage||!n.name)&&(n.avatarImage||s.avatarAgent||s.avatarBot),l=o.agentMessage.replace("{0}",`${n.name||o.agent}`)):(this.settings.showTypingIndicator&&(this.typingIndicator.remove(),this.typingIndicator=new $t(z.LEFT,this.settings,this.util)),c=s.avatarBot,l=o.skillMessage),a.addCSSClass(t,"left"),c){const s=this.getAvatar(c,e.source===i.m.Agent&&o.avatarAgent||o.avatarBot);s.style.marginTop=e.source===i.m.Agent&&n.name&&"16px",t.appendChild(s)}}else a.addCSSClass(t,"right"),l=o.userMessage,s.avatarUser&&t.appendChild(this.getAvatar(s.avatarUser,o.avatarUser));const d=a.createDiv(["messages-wrapper","flex","col"]);r&&d.appendChild(r);const h=this.util.createElement("span",["screen-reader-only"]);h.innerText=l,d.appendChild(h);const p=a.createDiv(["message-list","flex","col"]);if(d.appendChild(p),this.settings.enableTimestamp&&"absolute"===this.settings.timestampMode){const e=this.getTime();d.appendChild(e)}t.appendChild(d)}_renderMessage(e,t,s){const i=this.settings.delegate;if(i&&i.render){const t=this.util.createDiv(["message"]);t.id=e.msgId,t.lang=this.settings.locale,s.appendChild(t);if(i.render(e))return null;t.remove()}return t.render()}setTimestampHeaderIfNewDate(e){(0,r.isSameDay)(this.currTimestampHeader,e)||(this.currTimestampHeader=new Date(e),this._appendMessageToConversation(this.createTimestampHeader(this.currTimestampHeader)))}createTimestampHeader(e){const t=this.util.createDiv(["timestamp-header"]);return t.textContent=(0,r.formatDate)(e,{pattern:this.settings.timestampFormat,locale:this.currentLocale||this.settings.locale}),t}updateRelativeTimestamp(e){this.relativeTimestampElement||(this.relativeTimestampElement=this.relativeTimestamp.render()),this.relativeTimestampElement.remove(),this.relativeTimestamp.refresh(e),this._appendMessageToConversation(this.relativeTimestampElement)}focusMessageFirstAction(e){e.hasActions()&&bs((()=>{e.focusFirstAction()}),290)}addCustomBanner(e,t,s){const i=document.querySelector(`#${e}`);if(i){const e=this.util.createDiv(s);e.appendChild(i),t.appendChild(e)}else this.logger.error(`Could not find element with ID '${e}'. No element embedded to the chat conversation pane.`)}onSpeechToggle(e){const t=function(e){const t=document.querySelector(".oda-chat-wrapper");return getComputedStyle(t).getPropertyValue(e)}("--color-visualizer"),s=this.localeText;this._ttsCancel(),this.eventDispatcher.trigger(o.CLICK_VOICE_TOGGLE,e),this.settings.enableSpeech&&(e?(this._hideBanner(),this.settings.speechLocale&&!(0,i.E)(this.settings.speechLocale)?this._showBanner(s.errorSpeechUnsupportedLocale):this.core.startRecognition({onRecognitionText:this.onSpeechRecognition.bind(this),onVisualData:e=>{this.footer.updateVisualizer(e,t)}}).then((()=>{this.footer.setVoiceRecording(!0),this._scrollToBottom()})).catch((e=>{this.footer.setVoiceRecording(!1);let t="";switch(e.message){case i.f.RecognitionMultipleConnection:t=s.errorSpeechMultipleConnection;break;case i.f.RecognitionNotReady:t=s.errorSpeechInvalidUrl;break;case i.f.RecognitionProcessingFailure:t=s.errorSpeechTooMuchTimeout;break;default:t=s.errorSpeechUnavailable}this._showBanner(t)}))):(this.core.stopRecognition(),this.footer.setVoiceRecording(!1)))}onSpeechRecognition(e){if(e)switch(e.type){case"error":this.logger.error("Failed to recognize voice",e.text),e.text===i.f.RecognitionTooMuchSpeechTimeout&&this._showBanner(this.localeText.errorSpeechTooMuchTimeout),this.footer.setVoiceRecording(!1);break;case"final":let t=e.text;t.length>0?(this.speechFinalResult&&(t=`${this.speechFinalResult.text} ${t}`),this.footer.setUserInputText(t),this.settings.enableSpeechAutoSend?bs((()=>{const s=(0,i.r)(t,e.requestId);this.sendMessage(s).then((()=>{this.footer.setUserInputText("")}))}),this.FINAL_RESULT_DISPLAY_TIMEOUT):this.speechFinalResult={speechId:e.requestId,text:t},this.footer.setVoiceRecording(!1)):this.footer.setUserInputText(this.speechFinalResult.text);break;case"partial":let s=e.text;s.length>0&&(this.speechFinalResult&&(s=`${this.speechFinalResult.text} ${s}`),this.footer.setUserInputText(s))}}_disablePastActions(e){switch(this.settings.disablePastActions){case"all":e.forEach((e=>{e.disableActions()}));break;case"postback":e.forEach((e=>{e.disablePostbacks()}))}}_onLoadPreviousMessages(){this._disablePastActions(this.skillMessages)}_onReceiveMessage(e){("none"===this.settings.disablePastActions?this.skillMessages:this.latestSkillMessages).push(e)}_onSendMessage(){this._disablePastActions(this.latestSkillMessages),this.latestSkillMessages=[]}_onConnection(){("none"===this.settings.disablePastActions?this.skillMessages:this.latestSkillMessages).forEach((e=>{e.enablePostbacks()}))}_onDisconnection(){("none"===this.settings.disablePastActions?this.skillMessages:this.latestSkillMessages).forEach((e=>{e.disablePostbacks()}))}_clearChatPane(){var e;let t=!1;for((null===(e=this.typingIndicator)||void 0===e?void 0:e.isVisible())&&(t=!0,this.hideTypingIndicator());this.conversationContainer.firstChild;)this.conversationContainer.removeChild(this.conversationContainer.lastChild);t&&this.showTypingIndicator(),this._renderMessagesAndScroll([]),this.isFirstMessage=!0,this.currTimestampHeader=null,this._ttsCancel(),this.eventDispatcher.trigger(o.CLICK_ERASE)}_initBroadcaster(){const{userId:e,channelId:t}=this.settings;ps&&(this._stopBroadcaster(),this.broadcaster=new ps(`${e}-${t}`),this.broadcaster.onmessage=this._onBroadcastMessage.bind(this))}_stopBroadcaster(){this.broadcaster&&(this.broadcaster.close(),this.broadcaster=null)}_broadcast(e){if(this.broadcaster){const t={type:"message",message:e};if(Ot(e)){const s=Rt(e);if(this.messageIDs.indexOf(s)>=0)return;t.digest=s}this.broadcaster.postMessage(t)}}_broadcastAction(e){this.broadcaster&&this.broadcaster.postMessage(e)}_onBroadcastMessage(e){const t=e.data;switch(t.type){case"message":const e=t.message.messagePayload;if(e.type===i.i.Status){const t=e;return void("RESPONDING"===t.status?this.showTypingIndicator():"LISTENING"===t.status&&this.hideTypingIndicator())}if(e.type===i.i.SessionClosed)return void this.handleSessionEnd();if(t.digest){if(this.messageIDs.indexOf(t.digest)>=0)return;this.receivedMessage(t.message)}else this.sentMessage(t.message),this._onSendMessage(),this.showTypingIndicator();this.hideTypingIndicator(),this._renderMessagesAndScroll([t.message]);break;case"actionClearHistory":this._clearChatPane();break;case"actionLanguage":this.multiLangChat.setTag(t.tag,!1)}}_showBanner(e){Oe(this.chatPane.element,this.util.getBanner({icon:Ce,text:e,closeText:this.localeText.webViewErrorInfoDismiss,closeIcon:this.settings.icons.close,autoClose:!0}))}_hideBanner(){document.querySelectorAll(`.${this.cssPrefix}-prompt-banner-close-button`).forEach((e=>{e.click()}))}_stopDefaultMessages(){window.clearTimeout(this.defaultResponseTimer),window.clearInterval(this.defaultResponseInterval),window.clearTimeout(this.waitMessageClearTimer),this.hideTypingIndicator()}_onMessageReceived(e){const t=this.settings.delegate;if(this.logger.debug("onMessageReceived",e),this._stopDefaultMessages(),this._scrollToBottom(),this.isResponseReceived=!0,this.isFirstMessage=!1,this.settings.enableDefaultClientResponse&&(e.source===i.m.Agent?this.enableDefaultBotResponse=!1:this.enableDefaultBotResponse||(this.enableDefaultBotResponse=!0)),e){if(t&&t.beforeDisplay&&(0,r.isFunction)(t.beforeDisplay)&&xs(e)){let s=JSON.parse(JSON.stringify(e));try{s=t.beforeDisplay(s)}catch(e){this.logger.error(e)}if(!s)return;(0,i.G)(s)?e=s:this.logger.error("The generated delegate message is invalid. Displaying original message instead.")}switch(this.receivedMessage(e),this._broadcast(e),e.messagePayload.type){case i.i.Status:{const t=e.messagePayload;"RESPONDING"===t.status?this.showTypingIndicator():"LISTENING"===t.status&&this.hideTypingIndicator();break}case i.i.SessionClosed:this.handleSessionEnd();break;case i.i.TextStream:{this._renderMessagesAndScroll([e]);const t=e.messagePayload;if("end"!==t.streamState)this.isTTSMute||this.core.speakTTS(e,this.localeText),this.textStreamTTSChunk=t.text;else{if(!this.isTTSMute){const s=this.textStreamTTSChunk;if(s.length){const i=t.text.lastIndexOf(s);if(i>=0){const o=t.text.substring(i+s.length);t.text=o,this.core.speakTTS(e,this.localeText)}}}this._saveMessage(e)}this.isOpen||this.updateNotificationBadge(++this.unreadMsgCount);break}default:this._renderMessagesAndScroll([e]),this.isTTSMute||this.core.speakTTS(e,this.localeText),this._saveMessage(e),this.isOpen||this.updateNotificationBadge(++this.unreadMsgCount)}}}_onMessageSent(e){this._saveMessage(e),this._scrollToBottom(),e&&(this._broadcast(e),e.messagePayload&&fs.indexOf(e.messagePayload.type)<0&&(this.isOpen||this.updateNotificationBadge(++this.unreadMsgCount),this._renderMessagesAndScroll([e])))}_toggleNarration(e){e||this._ttsCancel(),this.isTTSMute=!e}_loadPreviousConversations(){if(this.settings.enableLocalConversationHistory){this.loadChat();const e=this.getMessages();e.length&&(this.isNewMessage=!1,this._renderMessagesAndScroll(e.slice()).then((()=>{this.isNewMessage=!0,this._onLoadPreviousMessages(),this.relativeTimestamp&&(this.relativeTimestamp.setRelativeTime(new Date(e[e.length-1].date)),this.relativeTimestampElement=this.relativeTimestamp.render(),this._appendMessageToConversation(this.relativeTimestampElement)),this.settings.showPrevConvStatus&&(this.separator=this.util.createElement("div",["hr","flex"]),this.separator.innerText=this.localeText.previousChats,this._appendMessageToConversation(this.separator))})))}}_sendInitMessages(){var e;if(this.core.isConnected()&&this.isExpanded&&(this.multiLangChat&&(this.multiLangChat.disableComponent(!1),this.multiLangChat.initLanguage()),!this.isInitMessageSent)){const t=this.settings.initUserProfile;if(t){const e=this.settings.sdkMetadata?Object.assign({version:j},this.settings.sdkMetadata):{version:j};this.core.updateUser(t,{sdkMetadata:e}).then((()=>{this.isInitMessageSent=!0}))}if(this.settings.initUserHiddenMessage){const e=this.settings.initUserHiddenMessage;this.sendMessage(e,{hidden:!0,delegate:!1}).then((()=>{this.isInitMessageSent=!0}))}if(null===(e=this.settings.deviceToken)||void 0===e?void 0:e.length){const e=(0,r.checkDeviceType)();this.core.sendDeviceToken(this.settings.deviceToken,this.settings.deviceType||e).then((()=>{this.isInitMessageSent=!0}))}}}_ttsCancel(){this.core.cancelTTS()}sendUserTypingStatusMessage(e,t){this.getAgentDetails()&&this.core.sendUserTypingStatus(e,t)}configHotkeys(e){if(e.hotkeys){const t=new ls(e);t.setWidget(this.chatWidgetDiv);const s=e.hotkeys;Object.keys(s).forEach((e=>{const i=this.accessKeyElementsMap.get(e);i&&t.add(s[e],i,"launch"!==e)})),this.hotkeysManager=t}}setHotkeyMap(e,t){this.accessKeyElementsMap.set(e,t)}}const xs=e=>{let t=!0;const s=e.messagePayload;if(s){s.type===i.i.TextStream&&(t=!1)}return t},ys=()=>Promise.reject(Error("TextStreamProgress"))},49:function(e,t,s){s.r(t),s.d(t,{redwoodStyles:function(){return i}});const i='@keyframes scale-in-center{0%{opacity:1;transform:scale(0)}100%{opacity:1;transform:scale(1)}}@keyframes scale-out-center{0%{display:flex;opacity:1;transform:scale(1)}100%{display:none;opacity:1;transform:scale(0)}}@keyframes scale-in-br{0%{opacity:1;transform:scale(0);transform-origin:100% 100%}100%{opacity:1;transform:scale(1);transform-origin:100% 100%}}@keyframes scale-in-bl{0%{opacity:1;transform:scale(0);transform-origin:0 100%}100%{opacity:1;transform:scale(1);transform-origin:0 100%}}@keyframes scale-in-tl{0%{opacity:1;transform:scale(0);transform-origin:0 0}100%{opacity:1;transform:scale(1);transform-origin:0 0}}@keyframes scale-in-tr{0%{opacity:1;transform:scale(0);transform-origin:100% 0}100%{opacity:1;transform:scale(1);transform-origin:100% 0}}@keyframes scale-out-br{0%{opacity:1;transform:scale(1);transform-origin:100% 100%}99%{opacity:1;transform:scale(0.01);transform-origin:100% 100%}100%{display:none;opacity:1;transform:scale(0);transform-origin:100% 100%}}@keyframes scale-out-bl{0%{opacity:1;transform:scale(1);transform-origin:0 100%}99%{opacity:1;transform:scale(0.01);transform-origin:0 100%}100%{display:none;opacity:1;transform:scale(0);transform-origin:0 100%}}@keyframes popup-suggestion{0%{box-shadow:0 0 0 0 rgba(0,0,0,0),0 0 0 0 rgba(0,0,0,0);transform:scaleY(0.4);transform-origin:0 100%}100%{box-shadow:0 -12px 15px -12px rgba(0,0,0,.35);transform:scaleY(1);transform-origin:0 100%}}@keyframes spin{from{transform:rotate(0)}to{transform:rotate(360deg)}}@keyframes banner-in{0%{transform:translateY(-20px);opacity:0}100%{transform:translateY(0);opacity:1}}@keyframes banner-out{0%{transform:translateY(0);opacity:1}100%{transform:translateY(-20px);opacity:0}}@keyframes typing-cue{0%{opacity:1}30%{opacity:.1}50%{opacity:1}100%{opacity:.1}}@keyframes oda-chat-webview-slide-out-bottom{0%{transform:translateY(0);opacity:1}95%{opacity:1}100%{transform:translateY(100%);opacity:0}}@keyframes oda-chat-webview-slide-in-bottom{0%{transform:translateY(100%);opacity:0}1%{opacity:1}100%{transform:translateY(0%);opacity:1}}.flex{display:flex;justify-content:space-between;align-items:center}.col{flex-direction:column}.none{display:none}.wrapper{--color-branding: #c0533f;--color-launch-icon-background: #c0533f;--color-text: #161513;--color-text-light: #161513;--color-header-background: #F1EFED;--color-header-button-fill: #161513;--color-header-text: #161513;--color-header-button-background-hover: rgba(22, 21, 19, 0.04);--color-header-button-fill-hover: #161513;--color-conversation-background: #F5F4F2;--color-timestamp: rgba(22, 21, 19, 0.65);--color-typing-indicator: #161513;--color-agent-initials: #FFFFFF;--color-agent-avatar-background: #A890B6;--color-agent-name: rgba(22, 21, 19, 0.65);--color-bot-message-background: #FFFFFF;--color-bot-text: #161513;--color-user-message-background: #E4E1DD;--color-user-text: #161513;--color-error-message-background: #FFF8F7;--color-error-border: #DC5C5E;--color-error-title: #D63B25;--color-error-text: #161513;--color-card-background: #FFFFFF;--color-card-nav-button: #FFF;--color-card-nav-button-focus: #FBF9F8;--color-card-nav-button-hover: #FBF9F8;--color-actions-background: #fff;--color-actions-background-focus: rgba(22, 21, 19, 0.04);--color-actions-background-hover: rgba(22, 21, 19, 0.04);--color-actions-border: rgba(22, 21, 19, 0.5);--color-actions-text: #161513;--color-actions-text-focus: #161513;--color-actions-text-hover: #161513;--color-global-actions-background: transparent;--color-global-actions-background-focus: rgba(22, 21, 19, 0.04);--color-global-actions-background-hover: rgba(22, 21, 19, 0.04);--color-global-actions-border: rgba(22, 21, 19, 0.5);--color-global-actions-text: #161513;--color-global-actions-text-focus: #161513;--color-global-actions-text-hover: #161513;--color-primary-actions-background: rgb(49, 45, 42);--color-primary-actions-background-focus: rgb(49, 45, 42) linear-gradient(rgb(58, 54, 50), rgb(58, 54, 50));--color-primary-actions-background-hover: rgb(49, 45, 42) linear-gradient(rgb(58, 54, 50), rgb(58, 54, 50));--color-primary-actions-border: transparent;--color-primary-actions-text: #fff;--color-primary-actions-text-focus: #fff;--color-primary-actions-text-hover: #fff;--color-danger-actions-background: rgb(214, 59, 37);--color-danger-actions-background-focus: rgb(214, 59, 37) linear-gradient(rgb(195, 53, 34), rgb(195, 53, 34));--color-danger-actions-background-hover: rgb(214, 59, 37) linear-gradient(rgb(195, 53, 34), rgb(195, 53, 34));--color-danger-actions-border: transparent;--color-danger-actions-text: #fff;--color-danger-actions-text-focus: #fff;--color-danger-actions-text-hover: #fff;--color-links: #c0533f;--color-user-links: #c0533f;--color-rating-star: #ececec;--color-rating-star-fill: #f0cc71;--color-horizontal-rule-background: #cbc5bf;--color-attachment-placeholder: #e3e1dc;--color-attachment-footer: #fff;--color-attachment-text: #161513;--color-footer-background: #fff;--color-footer-button-fill: #161513;--color-footer-button-background-hover: rgba(22, 21, 19, 0.04);--color-footer-button-fill-hover: #161513;--color-input-background: #fff;--color-input-border: #fff;--color-input-text: #161513;--color-recognition-view-text: #fff;--color-visualizer: #161513;--color-visualizer-container-background: #fff;--color-notification-badge-background: #312d2a;--color-notification-badge-text: #fff;--color-popup-background: #fff;--color-popup-text: #161513;--color-popup-button-background: #fff;--color-popup-button-text: #161513;--color-popup-horizontal-rule: #cbc5bf;--color-popup-item-background-hover: rgba(22, 21, 19, 0.04);--color-table-header-background: #f1efec;--color-table-header-text: #161513;--color-table-background: #fff;--color-table-text: #161513;--color-table-separator: rgba(22, 21, 19, 0.1);--color-table-row-background-hover: rgba(22, 21, 19, 0.04);--color-table-actions-background: transparent;--color-table-actions-background-focus: rgba(22, 21, 19, 0.04);--color-table-actions-background-hover: rgba(22, 21, 19, 0.04);--color-table-actions-border: rgba(22, 21, 19, 0.5);--color-table-actions-text: #161513;--color-table-actions-text-focus: #161513;--color-table-actions-text-hover: #161513;--color-form-header-background: #f1efec;--color-form-header-text: #161513;--color-form-background: #fff;--color-form-text: #161513;--color-form-input-background: #fff;--color-form-input-border: rgba(22, 21, 19, 0.5);--color-form-input-border-focus: rgb(14, 114, 151);--color-form-input-text: #161513;--color-form-label: rgba(22, 21, 19, 0.65);--color-form-error: rgba(179,49,31);--color-form-error-text: rgba(22, 21, 19, 0.65);--color-form-actions-background: transparent;--color-form-actions-background-focus: rgba(22, 21, 19, 0.04);--color-form-actions-background-hover: rgba(22, 21, 19, 0.04);--color-form-actions-border: rgba(22, 21, 19, 0.5);--color-form-actions-text: #161513;--color-form-actions-text-focus: #161513;--color-form-actions-text-hover: #161513;--color-primary-form-actions-background: rgb(49, 45, 42);--color-primary-form-actions-background-focus: rgb(49, 45, 42) linear-gradient(rgb(58, 54, 50), rgb(58, 54, 50));--color-primary-form-actions-background-hover: rgb(49, 45, 42) linear-gradient(rgb(58, 54, 50), rgb(58, 54, 50));--color-primary-form-actions-border: transparent;--color-primary-form-actions-text: #fff;--color-primary-form-actions-text-focus: #fff;--color-primary-form-actions-text-hover: #fff;--color-danger-form-actions-background: rgb(214, 59, 37);--color-danger-form-actions-background-focus: rgb(214, 59, 37) linear-gradient(rgb(195, 53, 34), rgb(195, 53, 34));--color-danger-form-actions-background-hover: rgb(214, 59, 37) linear-gradient(rgb(195, 53, 34), rgb(195, 53, 34));--color-danger-form-actions-border: transparent;--color-danger-form-actions-text: #fff;--color-danger-form-actions-text-focus: #fff;--color-danger-form-actions-text-hover: #fff;--width-full-screen: 375px;--widget-max-height: calc(100vh - 60px);--position-top: 0;--position-left: 0;--position-right: 20px;--position-bottom: 20px;position:fixed;box-sizing:border-box;text-transform:none;z-index:10000;color:var(--color-text);font-size:16px;font-family:"Oracle Sans",-apple-system,BlinkMacSystemFont,"Segoe UI","Helvetica Neue",sans-serif;transition:all .25s ease-in-out;-webkit-font-smoothing:antialiased}.wrapper.classic{--color-branding: #025e7e;--color-launch-icon-background: #025e7e;--color-text: #161513;--color-text-light: #3a3631;--color-header-background: #025e7e;--color-header-button-fill: #fff;--color-header-button-fill-hover: #fff;--color-header-text: #fff;--color-conversation-background: #fff;--color-timestamp: #5b5652;--color-typing-indicator: #227e9e;--color-bot-message-background: #e5f1ff;--color-user-message-background: #ececec;--color-card-background: #e5f1ff;--color-card-nav-button: #4190ac;--color-card-nav-button-focus: #5fa2ba;--color-card-nav-button-hover: #0e7295;--color-actions-background: transparent;--color-actions-background-focus: rgba(14, 114, 149, 0.04);--color-actions-background-hover: rgba(14, 114, 149, 0.04);--color-actions-border: rgb(14, 114, 149);--color-actions-text: rgb(14, 114, 149);--color-actions-text-focus: rgb(14, 114, 149);--color-actions-text-hover: rgb(14, 114, 149);--color-global-actions-background: #fff;--color-global-actions-background-focus: rgba(14, 114, 149, 0.04);--color-global-actions-background-hover: rgba(14, 114, 149, 0.04);--color-global-actions-border: rgb(14, 114, 149);--color-global-actions-text: rgb(14, 114, 149);--color-global-actions-text-focus: rgb(14, 114, 149);--color-global-actions-text-hover: rgb(14, 114, 149);--color-primary-actions-background: rgb(14, 114, 149);--color-primary-actions-background-focus: rgba(14, 114, 149, 0.95);--color-primary-actions-background-hover: rgba(14, 114, 149, 0.95);--color-links: #0e7295;--color-user-links: #0e7295;--color-agent-name: #5b5652;--color-attachment-footer: #e5f1ff;--color-footer-background: #fff;--color-footer-button-fill: #161513;--color-footer-button-fill-hover: #025e7e;--color-visualizer: #025e7e;--color-primary-form-actions-background: rgb(14, 114, 149);--color-primary-form-actions-background-focus: rgba(14, 114, 149, 0.95);--color-primary-form-actions-background-hover: rgba(14, 114, 149, 0.95);--color-notification-badge-background: #9a0007;--color-notification-badge-text: #fff;--color-popup-button-text: #025e7e}.wrapper.redwood-dark{--color-branding: #c0533f;--color-launch-icon-background: #c0533f;--color-text: #161513;--color-text-light: #fcfbfa;--color-header-background: #201e1c;--color-header-button-fill: #fff;--color-header-button-fill-hover: #fff;--color-header-button-background-hover: rgba(255, 255, 255, 0.04);--color-header-text: #fff;--color-conversation-background: #3a3631;--color-timestamp: #fcfbfa;--color-typing-indicator: #fff;--color-bot-message-background: #655f5c;--color-bot-text: #fff;--color-user-message-background: #fff;--color-user-text: #161513;--color-card-background: #655f5c;--color-card-nav-button: #d5b364;--color-card-nav-button-focus: #f7e0a1;--color-card-nav-button-hover: #b39554;--color-actions-background: #655f5c;--color-actions-background-focus: rgba(22, 21, 19, 0.5);--color-actions-background-hover: rgba(22, 21, 19, 0.3);--color-actions-border: #fff;--color-actions-text: #fff;--color-actions-text-focus: #fff;--color-actions-text-hover: #fff;--color-global-actions-background: #3a3631;--color-global-actions-background-focus: rgba(22, 21, 19, 0.3);--color-global-actions-background-hover: rgba(22, 21, 19, 0.3);--color-global-actions-border: #fff;--color-global-actions-text: #fff;--color-global-actions-text-focus: #fff;--color-global-actions-text-hover: #fff;--color-primary-actions-background: #fff;--color-primary-actions-background-focus: #fff linear-gradient(rgb(251, 249, 248), rgb(251, 249, 248));--color-primary-actions-background-hover: #fff linear-gradient(rgb(251, 249, 248), rgb(251, 249, 248));--color-primary-actions-text: #161513;--color-primary-actions-text-focus: #161513;--color-primary-actions-text-hover: #161513;--color-danger-actions-background-focus: rgb(214, 59, 37) linear-gradient(rgba(255, 255, 255, 0.08), rgba(255, 255, 255, 0.08));--color-danger-actions-background-hover: rgb(214, 59, 37) linear-gradient(rgba(255, 255, 255, 0.08), rgba(255, 255, 255, 0.08));--color-links: #f7e0a1;--color-user-links: #c0533f;--color-agent-name: #fcfbfa;--color-footer-background: #fff;--color-footer-button-fill: #161513;--color-input-background: #fff;--color-input-text: #161513;--color-recognition-view-text: #fff;--color-visualizer-container-background: #fff;--color-notification-badge-background: #312d2a;--color-notification-badge-text: #fff;--color-popup-button-text: #201e1c}.wrapper:not(.embedded){bottom:var(--position-bottom);left:var(--position-left);top:var(--position-top);right:var(--position-right)}.wrapper *{box-sizing:border-box}.wrapper b{font-weight:700}.wrapper .widget{position:absolute;bottom:calc(var(--position-bottom)*-1);border-radius:6px 6px 0 0;box-shadow:0px -4px 32px rgba(0,0,0,.1);right:calc(var(--position-right)*-1);width:100vw;max-width:100vw;max-height:var(--widget-max-height);margin:0;overflow:hidden;text-decoration:none;text-transform:none;z-index:10000;align-items:stretch;background:var(--color-conversation-background)}.wrapper .widget .alert-wrapper{position:absolute;top:48px;width:100%}.wrapper .widget .alert-wrapper .alert-prompt{position:relative;left:0;right:0;width:auto;margin:6px;padding:10px;border-radius:10px;z-index:11}.wrapper .widget .msg-icon{padding:5px 10px 0 0}.wrapper .widget .msg{flex-grow:1}.wrapper button{position:relative;max-width:100%;padding:9px 16px;margin:0 0 8px;min-height:36px;line-height:16px;font-size:13.75px;font-weight:600;font-family:inherit;border-radius:4px;border-width:thin;border-style:solid;cursor:pointer;overflow:hidden;word-break:break-word;flex-shrink:0}.wrapper button:disabled{opacity:.5;cursor:not-allowed}.wrapper button.icon{width:36px;height:36px;padding:8px;margin:0;margin-inline-start:4px;border:none;border-radius:4px;color:var(--color-text);background-color:rgba(0,0,0,0);justify-content:center}.wrapper button.icon.with-label{width:auto;max-width:200px}.wrapper button.icon.with-label svg,.wrapper button.icon.with-label img{margin-right:4px}.wrapper button.icon.label-only{width:auto;max-width:200px}.wrapper button.icon.label-only svg,.wrapper button.icon.label-only img{display:none}.wrapper button svg,.wrapper button img{width:20px;height:20px;flex-shrink:0}.wrapper button .action-image{margin-inline-end:10px}.wrapper .button{position:absolute;right:0;bottom:0;height:48px;width:48px;max-width:unset;padding:0;margin:0;border:none;background-position:center center;background-repeat:no-repeat;cursor:pointer;justify-content:center;align-items:center;z-index:10000;color:var(--color-text);background-color:var(--color-launch-icon-background);border-radius:0;overflow:visible}.wrapper .button svg,.wrapper .button img{height:unset;width:unset;max-width:100%;max-height:100%}.wrapper .button:not(:disabled):hover,.wrapper .button:not(:disabled):focus,.wrapper .button:not(:disabled):active{background-color:var(--color-launch-icon-background)}@media screen and (min-width: 769px){.wrapper .button{height:64px;width:64px}}.wrapper .header{height:56px;padding:0 8px;background-color:var(--color-header-background);color:var(--color-header-text)}.wrapper .header .logo{flex:0 0 auto;max-width:100px;height:36px;max-height:36px;overflow:hidden;padding:0}.wrapper .header .header-info-wrapper{flex-direction:column;flex-wrap:nowrap;width:100%;min-width:0;padding:0;margin:0 8px}.wrapper .header .header-info-wrapper .title{max-width:100%;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;font-size:1.125em;font-weight:700}.wrapper .header .header-info-wrapper .subtitle{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.wrapper .header .header-info-wrapper .connection-status{font-weight:bold;font-size:10px;justify-content:center;padding:0;margin:0;text-transform:uppercase;text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.wrapper .header .header-gap{flex:auto}.wrapper .header-actions{flex:1 0 auto;justify-content:flex-end;flex-direction:inherit}.wrapper .header-button svg>path{fill:var(--color-header-button-fill)}.wrapper .header-button:not(:disabled):hover,.wrapper .header-button:not(:disabled):focus{background-color:var(--color-header-button-background-hover)}.wrapper .header-button:not(:disabled):hover svg>path,.wrapper .header-button:not(:disabled):focus svg>path{fill:var(--color-header-button-fill-hover)}.wrapper .conversation{display:flex;flex:1;-webkit-box-orient:vertical;-webkit-box-direction:normal;flex-direction:column;overflow-x:hidden;overflow-y:auto;scroll-behavior:smooth;width:100%;padding:16px}.wrapper .conversation .conversation-pane .message-date,.wrapper .conversation .conversation-pane .relative-timestamp{font-size:12px;margin:8px 0 8px;color:var(--color-timestamp);text-align:start}.wrapper .conversation .conversation-pane .message-date.right,.wrapper .conversation .conversation-pane .relative-timestamp.right{text-align:end}.wrapper .conversation .conversation-pane.bot-icon .message.card-message-horizontal{margin-inline-start:-56px}.wrapper .conversation .conversation-pane.bot-icon .message.card-message-horizontal .message-header,.wrapper .conversation .conversation-pane.bot-icon .message.card-message-horizontal .message-footer,.wrapper .conversation .conversation-pane.bot-icon .message.card-message-horizontal .message-global-actions{margin-inline-start:56px}.wrapper .conversation .conversation-pane.bot-icon .message.card-message-horizontal .card-message-content .card-message-cards{padding-inline-start:56px}.wrapper .conversation .conversation-pane.bot-icon .relative-timestamp.left{margin-inline-start:40px}.wrapper .conversation .conversation-pane.user-icon .relative-timestamp.right{margin-inline-end:40px}.wrapper .conversation .conversation-pane.bot-icon .message-block .messages-wrapper,.wrapper .conversation .conversation-pane.user-icon .message-block .messages-wrapper{max-width:calc(.9*(100% - 40px))}.wrapper .conversation .conversation-pane.bot-icon .message-block .messages-wrapper .message.card-message-horizontal .message-header,.wrapper .conversation .conversation-pane.bot-icon .message-block .messages-wrapper .message.card-message-horizontal .message-footer,.wrapper .conversation .conversation-pane.bot-icon .message-block .messages-wrapper .message.card-message-horizontal .message-global-actions,.wrapper .conversation .conversation-pane.user-icon .message-block .messages-wrapper .message.card-message-horizontal .message-header,.wrapper .conversation .conversation-pane.user-icon .message-block .messages-wrapper .message.card-message-horizontal .message-footer,.wrapper .conversation .conversation-pane.user-icon .message-block .messages-wrapper .message.card-message-horizontal .message-global-actions{max-width:calc(.9*(100% - 72px))}.wrapper .conversation .conversation-pane.user-icon.bot-icon .message-block .messages-wrapper{max-width:calc(.9*(100% - 80px))}.wrapper .conversation .conversation-pane.user-icon.bot-icon .message-block .messages-wrapper .message.card-message-horizontal .message-header,.wrapper .conversation .conversation-pane.user-icon.bot-icon .message-block .messages-wrapper .message.card-message-horizontal .message-footer,.wrapper .conversation .conversation-pane.user-icon.bot-icon .message-block .messages-wrapper .message.card-message-horizontal .message-global-actions{max-width:calc(.9*(100% - 112px))}.wrapper .timestamp-header{text-align:center;font-size:12px;font-weight:700;color:var(--color-timestamp);margin:16px 0}.wrapper .hr{margin:24px 0;font-size:12px;color:var(--color-horizontal-rule-background)}.wrapper .hr:before{content:"";background-color:var(--color-horizontal-rule-background);height:1px;flex-grow:1;margin-inline-end:10px}.wrapper .hr:after{content:"";background-color:var(--color-horizontal-rule-background);height:1px;flex-grow:1;margin-inline-start:10px}.wrapper .card-actions,.wrapper .form-actions,.wrapper .message-actions,.wrapper .message-global-actions{margin-top:6px;display:flex;align-items:flex-start;justify-content:flex-start;flex-wrap:wrap}.wrapper .card-actions.form-message-actions-col,.wrapper .form-actions.form-message-actions-col,.wrapper .message-actions.form-message-actions-col,.wrapper .message-global-actions.form-message-actions-col{flex-basis:100%;max-width:100%}.wrapper .card-actions:not(.col) .action-postback,.wrapper .form-actions:not(.col) .action-postback,.wrapper .message-actions:not(.col) .action-postback,.wrapper .message-global-actions:not(.col) .action-postback{margin-inline-end:8px}.wrapper .card-actions:not(.col) .action-postback:last-child,.wrapper .form-actions:not(.col) .action-postback:last-child,.wrapper .message-actions:not(.col) .action-postback:last-child,.wrapper .message-global-actions:not(.col) .action-postback:last-child{margin-inline-end:0}.wrapper .action-postback{background:var(--color-actions-background);color:var(--color-actions-text);border-color:var(--color-actions-border);text-align:left}.wrapper .action-postback:not(:disabled):hover{color:var(--color-actions-text-hover);background-color:var(--color-actions-background-hover)}.wrapper .action-postback:not(:disabled):hover svg>path{fill:var(--color-actions-text-hover)}.wrapper .action-postback:not(:disabled):focus,.wrapper .action-postback:not(:disabled):active{background-color:var(--color-actions-background-focus);color:var(--color-actions-text-focus)}.wrapper .action-postback:not(:disabled):focus svg>path,.wrapper .action-postback:not(:disabled):active svg>path{fill:var(--color-actions-text-focus)}.wrapper .action-postback.primary{background:var(--color-primary-actions-background);color:var(--color-primary-actions-text);border:var(--color-primary-actions-border)}.wrapper .action-postback.primary:not(:disabled):hover{background:var(--color-primary-actions-background-hover);color:var(--color-primary-actions-text-hover)}.wrapper .action-postback.primary:not(:disabled):hover svg>path{fill:var(--color-primary-actions-text-hover)}.wrapper .action-postback.primary:not(:disabled):focus,.wrapper .action-postback.primary:not(:disabled):active{background:var(--color-primary-actions-background-focus);color:var(--color-primary-actions-text-focus)}.wrapper .action-postback.primary:not(:disabled):focus svg>path,.wrapper .action-postback.primary:not(:disabled):active svg>path{fill:var(--color-primary-actions-text-focus)}.wrapper .action-postback.danger{background:var(--color-danger-actions-background);color:var(--color-danger-actions-text);border:var(--color-danger-actions-border)}.wrapper .action-postback.danger:not(:disabled):hover{background:var(--color-danger-actions-background-hover);color:var(--color-danger-actions-text-hover)}.wrapper .action-postback.danger:not(:disabled):hover svg>path{fill:var(--color-danger-actions-text-hover)}.wrapper .action-postback.danger:not(:disabled):focus,.wrapper .action-postback.danger:not(:disabled):active{background:var(--color-danger-actions-background-focus);color:var(--color-danger-actions-text-focus)}.wrapper .action-postback.danger:not(:disabled):focus svg>path,.wrapper .action-postback.danger:not(:disabled):active svg>path{fill:var(--color-danger-actions-text-focus)}.wrapper .message-global-actions{margin-top:8px}.wrapper .message-global-actions.stars{display:block}.wrapper .message-global-actions button{background:var(--color-global-actions-background);color:var(--color-global-actions-text);border-color:var(--color-global-actions-border)}.wrapper .message-global-actions button:not(:disabled):hover{background-color:var(--color-global-actions-background-hover);color:var(--color-global-actions-text-hover)}.wrapper .message-global-actions button:not(:disabled):hover svg>path{fill:var(--color-global-actions-text-hover)}.wrapper .message-global-actions button:not(:disabled):focus,.wrapper .message-global-actions button:not(:disabled):active{background-color:var(--color-global-actions-background-focus);color:var(--color-global-actions-text-focus)}.wrapper .message-global-actions button:not(:disabled):focus svg>path,.wrapper .message-global-actions button:not(:disabled):active svg>path{fill:var(--color-global-actions-text-focus)}.wrapper .message-bubble{position:relative;display:flex;flex-direction:column;align-items:flex-start;margin:0;padding:6px 16px;color:var(--color-bot-text);background:var(--color-bot-message-background);overflow:hidden;min-height:32px;line-height:20px;overflow-wrap:break-word;max-width:100%;border-radius:2px 10px 10px 2px;margin-top:2px}.wrapper .message-bubble>*{width:100%}.wrapper .message-bubble.before-card{border-radius:2px 10px 10px 10px}.wrapper .message-bubble .video-wrapper{max-width:100%}.wrapper .message-bubble.error{background-color:var(--color-error-message-background);color:var(--color-error-text);border:1px dashed var(--color-error-border)}.wrapper .message-bubble.error .message-icon path{fill:var(--color-error-title)}.wrapper .message-bubble.error .message-title{color:var(--color-error-title)}.wrapper .message-bubble .message-with-icon{display:flex;align-items:flex-start;justify-content:space-between}.wrapper .message-bubble .message-with-icon .message-icon{width:24px;height:24px;align-items:center;margin-inline-end:16px}.wrapper .message-bubble .message-with-icon .message-text{word-break:break-word}.wrapper .message-bubble.message-header{margin-bottom:2px}.wrapper .message-bubble.message-footer{margin-top:2px}.wrapper .messages-wrapper{max-width:90%;align-items:flex-start}.wrapper .messages-wrapper .agent-name{position:relative;bottom:3px;max-width:111.1111111111%;height:16px;font-size:12px;line-height:16px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;color:var(--color-agent-name)}.wrapper .messages-wrapper .screen-reader-only{height:1px;left:-20000px;overflow:hidden;position:absolute;top:auto;width:1px}.wrapper .messages-wrapper .message-list{width:100%;align-items:flex-start}.wrapper .messages-wrapper .message-list .message{width:100%;white-space:pre-wrap}.wrapper .messages-wrapper .message-list .message a{color:var(--color-links)}.wrapper .messages-wrapper .message-list .message button.anchor-btn{padding:0}.wrapper .messages-wrapper .message-list .message button.anchor-btn a{display:block;text-decoration:inherit;color:inherit;padding:10px 20px}.wrapper .messages-wrapper .message-list .message button:last-child{margin-bottom:0}.wrapper .messages-wrapper .message-list .message .message-wrapper{display:flex;align-items:flex-start;flex-direction:column;width:100%;max-width:100%}.wrapper .messages-wrapper .message-list .message:first-child .message-bubble:not(.message-footer){margin-top:0}.wrapper .messages-wrapper .message-list .message:first-child .card-message-content:first-child .card-message-cards{margin-top:0}.wrapper .messages-wrapper .message-list .message:last-child .message-bubble:last-child{border-radius:2px 10px 10px 10px}.wrapper .messages-wrapper .message-list .message:last-child .message-bubble:last-child.edit-form-message .form-message-header{border-radius:1px 9px 0 0}.wrapper .messages-wrapper .message-list .message:last-child .message-bubble:last-child.edit-form-message .form-message-item{border-radius:1px 9px 9px 9px}.wrapper .messages-wrapper .message-list .message:last-child .card-message-content:last-child .card-message-cards{margin-bottom:-8px}.wrapper .messages-wrapper .message-list .message.card-message-horizontal{margin-inline-start:-16px;width:100vw}.wrapper .messages-wrapper .message-list .message.card-message-horizontal .message-header,.wrapper .messages-wrapper .message-list .message.card-message-horizontal .message-footer,.wrapper .messages-wrapper .message-list .message.card-message-horizontal .message-global-actions{margin-inline-start:16px;max-width:calc(.9*(100% - 32px))}.wrapper .messages-wrapper .message-list .message.card-message-horizontal .message-header{border-radius:2px 10px 10px 10px}.wrapper .messages-wrapper .message-list .message.card-message-horizontal .card-message-cards{flex-direction:row;overflow-x:auto;padding:0 56px 0 16px}.wrapper .messages-wrapper .message-list .message.card-message-horizontal .card{margin-inline-end:8px}.wrapper .messages-wrapper .message-list .message.card-message-horizontal .next-wrapper,.wrapper .messages-wrapper .message-list .message.card-message-horizontal .prev-wrapper{position:absolute;height:100%;top:0;width:52px;z-index:1}.wrapper .messages-wrapper .message-list .message.card-message-horizontal .next-wrapper{right:0;background:linear-gradient(90deg, rgba(255, 255, 255, 0), var(--color-conversation-background) 60%)}.wrapper .messages-wrapper .message-list .message.card-message-horizontal .prev-wrapper{left:0;background:linear-gradient(90deg, var(--color-conversation-background) 40%, rgba(255, 255, 255, 0))}.wrapper .messages-wrapper .message-list .message.card-message-horizontal .next,.wrapper .messages-wrapper .message-list .message.card-message-horizontal .previous{position:absolute;z-index:10;width:36px;height:36px;left:8px;padding:0;overflow:hidden;background-color:var(--color-card-nav-button);border:none;box-shadow:0px 2px 4px rgba(0,0,0,.1);top:calc(50% - 18px);justify-content:center}.wrapper .messages-wrapper .message-list .message.card-message-horizontal .next:hover,.wrapper .messages-wrapper .message-list .message.card-message-horizontal .previous:hover{background-color:var(--color-card-nav-button-hover)}.wrapper .messages-wrapper .message-list .message.card-message-horizontal .next:focus,.wrapper .messages-wrapper .message-list .message.card-message-horizontal .next:active,.wrapper .messages-wrapper .message-list .message.card-message-horizontal .previous:focus,.wrapper .messages-wrapper .message-list .message.card-message-horizontal .previous:active{background-color:var(--color-card-nav-button-focus)}.wrapper .message-block{justify-content:flex-start;align-items:flex-start;margin-bottom:8px}.wrapper .message-block.right{flex-direction:row-reverse}.wrapper .message-block.right .icon-wrapper{margin:unset;margin-inline-start:8px}.wrapper .message-block.right .messages-wrapper{align-items:flex-end}.wrapper .message-block.right .messages-wrapper .message a{color:var(--color-user-links)}.wrapper .message-block.right .messages-wrapper .message .message-wrapper{align-items:flex-end}.wrapper .message-block.right .messages-wrapper .message .message-bubble{border-radius:10px 2px 2px 10px}.wrapper .message-block.right .messages-wrapper .message .message-bubble:not(.error){color:var(--color-user-text);background:var(--color-user-message-background)}.wrapper .message-block.right .messages-wrapper .message:last-child .message-bubble:last-child{border-radius:10px 2px 10px 10px}.wrapper .message-block.right .message-date{text-align:right}.wrapper .icon-wrapper{margin-inline-end:8px;width:32px;min-width:32px;height:32px;border-radius:4px;overflow:hidden;z-index:1}.wrapper .icon-wrapper.agent-avatar{background:var(--color-agent-avatar-background);margin-top:16px}.wrapper .icon-wrapper .message-icon{height:32px;max-height:32px;max-width:32px;width:32px;color:var(--color-timestamp);overflow:hidden;text-overflow:ellipsis}.wrapper .icon-wrapper .agent-icon{position:relative;width:20px;height:20px;left:6px;top:6px;font-weight:700;font-size:16px;line-height:20px;text-align:center;color:var(--color-agent-initials)}.wrapper .attachment{width:100%}.wrapper .attachment .attachment-placeholder{background-color:var(--color-attachment-placeholder);max-width:calc(100% + 32px);min-width:228px;min-height:88px;max-height:230px;margin:-6px -16px 0;justify-content:center;overflow:hidden}.wrapper .attachment .attachment-placeholder>*{max-width:100%}.wrapper .attachment .attachment-placeholder .attachment-icon{height:48px;width:48px}.wrapper .attachment .attachment-placeholder .attachment-icon svg{height:48px;width:48px}.wrapper .attachment .attachment-placeholder .attachment-icon img{width:100%}.wrapper .attachment .attachment-placeholder .attachment-audio{height:50px;width:100%}.wrapper .attachment .attachment-placeholder .attachment-audio::-webkit-media-controls-enclosure{background-color:rgba(0,0,0,0)}.wrapper .attachment .attachment-footer{background-color:var(--color-attachment-footer);color:var(--color-attachment-text);margin:0 -16px -6px;height:50px;padding:16px}.wrapper .attachment .attachment-footer.with-actions{border-bottom:thin solid rgba(22,21,19,.1);margin-bottom:6px}.wrapper .attachment .attachment-footer .attachment-title{flex-grow:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.wrapper .card{width:252px;border-radius:6px;padding:16px;margin-block-end:8px;justify-content:flex-start;flex-shrink:0;color:var(--color-bot-text);background:var(--color-card-background);overflow:hidden}.wrapper .card .card-image{display:block;width:calc(100% + 32px);margin:-16px -16px 10px;min-height:88px;background-color:var(--color-attachment-placeholder)}.wrapper .card .card-title{line-height:20px;margin:0 0 4px;font-weight:700;word-break:break-word}.wrapper .card .card-description{margin-bottom:16px;color:var(--color-text-light)}.wrapper .card-message-content{width:100%;position:relative}.wrapper .card-message-content .card-message-cards{width:100%;align-items:stretch;display:flex;scroll-behavior:smooth;overflow-x:visible;flex-direction:column;margin:8px 0 0;scrollbar-width:none}.wrapper .card-message-content .card-message-cards::-webkit-scrollbar{display:none}.wrapper .message-bubble-tabular-message,.wrapper .message-bubble-form-message{width:111%;max-width:unset;border-radius:0 8px 8px 8px;padding:0;overflow:hidden;background-color:var(--color-table-background);color:var(--color-table-text);border:1px solid var(--color-table-header-background)}.wrapper .message-bubble-tabular-message .results-page-status,.wrapper .message-bubble-form-message .results-page-status{align-items:center;background-color:var(--color-table-background);color:var(--color-table-text);display:flex;flex-direction:row;font-size:13.75px;justify-content:flex-end;line-height:16px;padding:12px 16px;border-top:1px solid var(--color-table-separator)}.wrapper .message-bubble-tabular-message~.message-footer,.wrapper .message-bubble-form-message~.message-footer{margin-top:8px}.wrapper .message-bubble-tabular-message .message-actions .action-postback,.wrapper .message-bubble-tabular-message .table-message-item .action-postback{background:var(--color-table-actions-background);color:var(--color-table-actions-text);border-color:var(--color-table-actions-border)}.wrapper .message-bubble-tabular-message .message-actions .action-postback:not(:disabled):hover,.wrapper .message-bubble-tabular-message .table-message-item .action-postback:not(:disabled):hover{color:var(--color-table-actions-text-hover);background:var(--color-table-actions-background-hover)}.wrapper .message-bubble-tabular-message .message-actions .action-postback:not(:disabled):hover svg>path,.wrapper .message-bubble-tabular-message .table-message-item .action-postback:not(:disabled):hover svg>path{fill:var(--color-table-actions-text-hover)}.wrapper .message-bubble-tabular-message .message-actions .action-postback:not(:disabled):focus,.wrapper .message-bubble-tabular-message .message-actions .action-postback:not(:disabled):active,.wrapper .message-bubble-tabular-message .table-message-item .action-postback:not(:disabled):focus,.wrapper .message-bubble-tabular-message .table-message-item .action-postback:not(:disabled):active{background:var(--color-table-actions-background-focus);color:var(--color-table-actions-text-focus)}.wrapper .message-bubble-tabular-message .message-actions .action-postback:not(:disabled):focus svg>path,.wrapper .message-bubble-tabular-message .message-actions .action-postback:not(:disabled):active svg>path,.wrapper .message-bubble-tabular-message .table-message-item .action-postback:not(:disabled):focus svg>path,.wrapper .message-bubble-tabular-message .table-message-item .action-postback:not(:disabled):active svg>path{fill:var(--color-table-actions-text-focus)}.wrapper .message-bubble-tabular-message .message-actions,.wrapper .message-bubble-form-message .message-actions{border-top:1px solid var(--color-table-separator);padding:12px 16px;margin-top:auto}.wrapper .message-bubble-tabular-message .message-actions .action-postback.primary,.wrapper .message-bubble-tabular-message .table-message-item .action-postback.primary,.wrapper .message-bubble-tabular-message .form-actions .action-postback.primary,.wrapper .message-bubble-tabular-message .form-message-value .action-postback.primary,.wrapper .message-bubble-form-message .message-actions .action-postback.primary,.wrapper .message-bubble-form-message .table-message-item .action-postback.primary,.wrapper .message-bubble-form-message .form-actions .action-postback.primary,.wrapper .message-bubble-form-message .form-message-value .action-postback.primary{background:var(--color-primary-form-actions-background);color:var(--color-primary-form-actions-text);border:var(--color-primary-form-actions-border)}.wrapper .message-bubble-tabular-message .message-actions .action-postback.primary:not(:disabled):hover,.wrapper .message-bubble-tabular-message .table-message-item .action-postback.primary:not(:disabled):hover,.wrapper .message-bubble-tabular-message .form-actions .action-postback.primary:not(:disabled):hover,.wrapper .message-bubble-tabular-message .form-message-value .action-postback.primary:not(:disabled):hover,.wrapper .message-bubble-form-message .message-actions .action-postback.primary:not(:disabled):hover,.wrapper .message-bubble-form-message .table-message-item .action-postback.primary:not(:disabled):hover,.wrapper .message-bubble-form-message .form-actions .action-postback.primary:not(:disabled):hover,.wrapper .message-bubble-form-message .form-message-value .action-postback.primary:not(:disabled):hover{background:var(--color-primary-form-actions-background-hover);color:var(--color-primary-form-actions-text-hover)}.wrapper .message-bubble-tabular-message .message-actions .action-postback.primary:not(:disabled):hover svg>path,.wrapper .message-bubble-tabular-message .table-message-item .action-postback.primary:not(:disabled):hover svg>path,.wrapper .message-bubble-tabular-message .form-actions .action-postback.primary:not(:disabled):hover svg>path,.wrapper .message-bubble-tabular-message .form-message-value .action-postback.primary:not(:disabled):hover svg>path,.wrapper .message-bubble-form-message .message-actions .action-postback.primary:not(:disabled):hover svg>path,.wrapper .message-bubble-form-message .table-message-item .action-postback.primary:not(:disabled):hover svg>path,.wrapper .message-bubble-form-message .form-actions .action-postback.primary:not(:disabled):hover svg>path,.wrapper .message-bubble-form-message .form-message-value .action-postback.primary:not(:disabled):hover svg>path{fill:var(--color-primary-form-actions-text-hover)}.wrapper .message-bubble-tabular-message .message-actions .action-postback.primary:not(:disabled):focus,.wrapper .message-bubble-tabular-message .message-actions .action-postback.primary:not(:disabled):active,.wrapper .message-bubble-tabular-message .table-message-item .action-postback.primary:not(:disabled):focus,.wrapper .message-bubble-tabular-message .table-message-item .action-postback.primary:not(:disabled):active,.wrapper .message-bubble-tabular-message .form-actions .action-postback.primary:not(:disabled):focus,.wrapper .message-bubble-tabular-message .form-actions .action-postback.primary:not(:disabled):active,.wrapper .message-bubble-tabular-message .form-message-value .action-postback.primary:not(:disabled):focus,.wrapper .message-bubble-tabular-message .form-message-value .action-postback.primary:not(:disabled):active,.wrapper .message-bubble-form-message .message-actions .action-postback.primary:not(:disabled):focus,.wrapper .message-bubble-form-message .message-actions .action-postback.primary:not(:disabled):active,.wrapper .message-bubble-form-message .table-message-item .action-postback.primary:not(:disabled):focus,.wrapper .message-bubble-form-message .table-message-item .action-postback.primary:not(:disabled):active,.wrapper .message-bubble-form-message .form-actions .action-postback.primary:not(:disabled):focus,.wrapper .message-bubble-form-message .form-actions .action-postback.primary:not(:disabled):active,.wrapper .message-bubble-form-message .form-message-value .action-postback.primary:not(:disabled):focus,.wrapper .message-bubble-form-message .form-message-value .action-postback.primary:not(:disabled):active{background:var(--color-primary-form-actions-background-focus);color:var(--color-primary-form-actions-text-focus)}.wrapper .message-bubble-tabular-message .message-actions .action-postback.primary:not(:disabled):focus svg>path,.wrapper .message-bubble-tabular-message .message-actions .action-postback.primary:not(:disabled):active svg>path,.wrapper .message-bubble-tabular-message .table-message-item .action-postback.primary:not(:disabled):focus svg>path,.wrapper .message-bubble-tabular-message .table-message-item .action-postback.primary:not(:disabled):active svg>path,.wrapper .message-bubble-tabular-message .form-actions .action-postback.primary:not(:disabled):focus svg>path,.wrapper .message-bubble-tabular-message .form-actions .action-postback.primary:not(:disabled):active svg>path,.wrapper .message-bubble-tabular-message .form-message-value .action-postback.primary:not(:disabled):focus svg>path,.wrapper .message-bubble-tabular-message .form-message-value .action-postback.primary:not(:disabled):active svg>path,.wrapper .message-bubble-form-message .message-actions .action-postback.primary:not(:disabled):focus svg>path,.wrapper .message-bubble-form-message .message-actions .action-postback.primary:not(:disabled):active svg>path,.wrapper .message-bubble-form-message .table-message-item .action-postback.primary:not(:disabled):focus svg>path,.wrapper .message-bubble-form-message .table-message-item .action-postback.primary:not(:disabled):active svg>path,.wrapper .message-bubble-form-message .form-actions .action-postback.primary:not(:disabled):focus svg>path,.wrapper .message-bubble-form-message .form-actions .action-postback.primary:not(:disabled):active svg>path,.wrapper .message-bubble-form-message .form-message-value .action-postback.primary:not(:disabled):focus svg>path,.wrapper .message-bubble-form-message .form-message-value .action-postback.primary:not(:disabled):active svg>path{fill:var(--color-primary-form-actions-text-focus)}.wrapper .message-bubble-tabular-message .message-actions .action-postback.danger,.wrapper .message-bubble-tabular-message .table-message-item .action-postback.danger,.wrapper .message-bubble-tabular-message .form-actions .action-postback.danger,.wrapper .message-bubble-tabular-message .form-message-value .action-postback.danger,.wrapper .message-bubble-form-message .message-actions .action-postback.danger,.wrapper .message-bubble-form-message .table-message-item .action-postback.danger,.wrapper .message-bubble-form-message .form-actions .action-postback.danger,.wrapper .message-bubble-form-message .form-message-value .action-postback.danger{background:var(--color-danger-form-actions-background);color:var(--color-danger-form-actions-text);border:var(--color-danger-form-actions-border)}.wrapper .message-bubble-tabular-message .message-actions .action-postback.danger:not(:disabled):hover,.wrapper .message-bubble-tabular-message .table-message-item .action-postback.danger:not(:disabled):hover,.wrapper .message-bubble-tabular-message .form-actions .action-postback.danger:not(:disabled):hover,.wrapper .message-bubble-tabular-message .form-message-value .action-postback.danger:not(:disabled):hover,.wrapper .message-bubble-form-message .message-actions .action-postback.danger:not(:disabled):hover,.wrapper .message-bubble-form-message .table-message-item .action-postback.danger:not(:disabled):hover,.wrapper .message-bubble-form-message .form-actions .action-postback.danger:not(:disabled):hover,.wrapper .message-bubble-form-message .form-message-value .action-postback.danger:not(:disabled):hover{background:var(--color-danger-form-actions-background-hover);color:var(--color-danger-form-actions-text-hover)}.wrapper .message-bubble-tabular-message .message-actions .action-postback.danger:not(:disabled):hover svg>path,.wrapper .message-bubble-tabular-message .table-message-item .action-postback.danger:not(:disabled):hover svg>path,.wrapper .message-bubble-tabular-message .form-actions .action-postback.danger:not(:disabled):hover svg>path,.wrapper .message-bubble-tabular-message .form-message-value .action-postback.danger:not(:disabled):hover svg>path,.wrapper .message-bubble-form-message .message-actions .action-postback.danger:not(:disabled):hover svg>path,.wrapper .message-bubble-form-message .table-message-item .action-postback.danger:not(:disabled):hover svg>path,.wrapper .message-bubble-form-message .form-actions .action-postback.danger:not(:disabled):hover svg>path,.wrapper .message-bubble-form-message .form-message-value .action-postback.danger:not(:disabled):hover svg>path{fill:var(--color-danger-form-actions-text-hover)}.wrapper .message-bubble-tabular-message .message-actions .action-postback.danger:not(:disabled):focus,.wrapper .message-bubble-tabular-message .message-actions .action-postback.danger:not(:disabled):active,.wrapper .message-bubble-tabular-message .table-message-item .action-postback.danger:not(:disabled):focus,.wrapper .message-bubble-tabular-message .table-message-item .action-postback.danger:not(:disabled):active,.wrapper .message-bubble-tabular-message .form-actions .action-postback.danger:not(:disabled):focus,.wrapper .message-bubble-tabular-message .form-actions .action-postback.danger:not(:disabled):active,.wrapper .message-bubble-tabular-message .form-message-value .action-postback.danger:not(:disabled):focus,.wrapper .message-bubble-tabular-message .form-message-value .action-postback.danger:not(:disabled):active,.wrapper .message-bubble-form-message .message-actions .action-postback.danger:not(:disabled):focus,.wrapper .message-bubble-form-message .message-actions .action-postback.danger:not(:disabled):active,.wrapper .message-bubble-form-message .table-message-item .action-postback.danger:not(:disabled):focus,.wrapper .message-bubble-form-message .table-message-item .action-postback.danger:not(:disabled):active,.wrapper .message-bubble-form-message .form-actions .action-postback.danger:not(:disabled):focus,.wrapper .message-bubble-form-message .form-actions .action-postback.danger:not(:disabled):active,.wrapper .message-bubble-form-message .form-message-value .action-postback.danger:not(:disabled):focus,.wrapper .message-bubble-form-message .form-message-value .action-postback.danger:not(:disabled):active{background:var(--color-danger-form-actions-background-focus);color:var(--color-danger-form-actions-text-focus)}.wrapper .message-bubble-tabular-message .message-actions .action-postback.danger:not(:disabled):focus svg>path,.wrapper .message-bubble-tabular-message .message-actions .action-postback.danger:not(:disabled):active svg>path,.wrapper .message-bubble-tabular-message .table-message-item .action-postback.danger:not(:disabled):focus svg>path,.wrapper .message-bubble-tabular-message .table-message-item .action-postback.danger:not(:disabled):active svg>path,.wrapper .message-bubble-tabular-message .form-actions .action-postback.danger:not(:disabled):focus svg>path,.wrapper .message-bubble-tabular-message .form-actions .action-postback.danger:not(:disabled):active svg>path,.wrapper .message-bubble-tabular-message .form-message-value .action-postback.danger:not(:disabled):focus svg>path,.wrapper .message-bubble-tabular-message .form-message-value .action-postback.danger:not(:disabled):active svg>path,.wrapper .message-bubble-form-message .message-actions .action-postback.danger:not(:disabled):focus svg>path,.wrapper .message-bubble-form-message .message-actions .action-postback.danger:not(:disabled):active svg>path,.wrapper .message-bubble-form-message .table-message-item .action-postback.danger:not(:disabled):focus svg>path,.wrapper .message-bubble-form-message .table-message-item .action-postback.danger:not(:disabled):active svg>path,.wrapper .message-bubble-form-message .form-actions .action-postback.danger:not(:disabled):focus svg>path,.wrapper .message-bubble-form-message .form-actions .action-postback.danger:not(:disabled):active svg>path,.wrapper .message-bubble-form-message .form-message-value .action-postback.danger:not(:disabled):focus svg>path,.wrapper .message-bubble-form-message .form-message-value .action-postback.danger:not(:disabled):active svg>path{fill:var(--color-danger-form-actions-text-focus)}.wrapper .message-bubble-form-message{background-color:var(--color-form-background);color:var(--color-form-text)}.wrapper .message-bubble-form-message.edit-form-message{overflow:visible}.wrapper .message-bubble-form-message.edit-form-message .form-message-header{border-radius:0 7px 0 0}.wrapper .message-bubble-form-message.edit-form-message .form-message-item{border-radius:0 7px 7px 7px}.wrapper .message-bubble-form-message .form-row{display:flex;flex-basis:100%;flex-wrap:nowrap;width:100%}.wrapper .message-bubble-form-message .form-row.separator{border-top:1px solid var(--color-table-separator);margin-top:8px}.wrapper .message-bubble-form-message .form-row .form-row-column{display:flex;flex-flow:column wrap;flex:0 1 auto;min-width:0;position:relative}.wrapper .message-bubble-form-message .form-row .form-row-column.stretch{flex-grow:1}.wrapper .message-bubble-form-message .form-row .form-row-column.align-center{justify-content:center}.wrapper .message-bubble-form-message .form-row .form-row-column.align-start{justify-content:flex-start}.wrapper .message-bubble-form-message .form-row .form-row-column.align-end{justify-content:flex-end}.wrapper .message-bubble-form-message .form-row .form-row-column:not(:last-child){margin-inline-end:16px}.wrapper .message-bubble-form-message .form-row .form-row-column .form-message-field.margin-top-lg{margin-top:28px}.wrapper .message-bubble-form-message .form-row .form-row-column .form-message-field.margin-top-md{margin-top:16px}.wrapper .message-bubble-form-message .form-row .form-row-column .edit-form-message-field .listbox{min-width:100%;inset-inline-start:0;max-width:unset}.wrapper .message-bubble-form-message .results-page-status{background-color:var(--color-form-background);color:var(--color-form-text)}.wrapper .message-bubble-form-message .message-actions .action-postback{background:var(--color-form-actions-background);color:var(--color-form-actions-text);border-color:var(--color-form-actions-border)}.wrapper .message-bubble-form-message .message-actions .action-postback:not(:disabled):hover{color:var(--color-form-actions-text-hover);background:var(--color-form-actions-background-hover)}.wrapper .message-bubble-form-message .message-actions .action-postback:not(:disabled):hover svg>path{fill:var(--color-form-actions-text-hover)}.wrapper .message-bubble-form-message .message-actions .action-postback:not(:disabled):focus,.wrapper .message-bubble-form-message .message-actions .action-postback:not(:disabled):active{background:var(--color-form-actions-background-focus);color:var(--color-form-actions-text-focus)}.wrapper .message-bubble-form-message .message-actions .action-postback:not(:disabled):focus svg>path,.wrapper .message-bubble-form-message .message-actions .action-postback:not(:disabled):active svg>path{fill:var(--color-form-actions-text-focus)}.wrapper .form-message-field,.wrapper .table-message-heading,.wrapper .table-message-item{overflow:hidden;overflow-wrap:break-word;word-break:break-word}.wrapper .table-message-wrapper{overflow:auto}.wrapper .table-message-wrapper .table-message{min-width:100%;max-width:200%;border-collapse:collapse}.wrapper .table-message-wrapper .table-message .table-message-headings{align-items:center;color:var(--color-table-header-text);background-color:var(--color-table-header-background);display:flex}.wrapper .table-message-wrapper .table-message .table-message-headings .table-message-heading{font-size:12px;font-weight:600;line-height:16px;padding:16px;min-width:120px}.wrapper .table-message-wrapper .table-message .table-message-row{border-top:1px solid var(--color-table-separator);display:flex;align-items:center}.wrapper .table-message-wrapper .table-message .table-message-row .table-message-item{color:var(--color-table-text);font-size:16px;line-height:20px;min-width:120px;padding:10px 16px}.wrapper .form-message-header{align-items:center;background-color:var(--color-form-header-background);color:var(--color-form-header-text);display:flex;font-weight:700;line-height:20px;padding:16px;text-align:start}.wrapper .form-message-item{color:var(--color-form-text);background-color:var(--color-form-background);display:flex;flex-flow:row wrap;justify-content:space-between;padding:16px}.wrapper .form-message-item.with-border{border-bottom:1px solid var(--color-table-separator)}.wrapper .form-message-item .form-message-key{color:var(--color-form-label);line-height:16px}.wrapper .form-message-item .form-message-key.with-margin{cursor:auto;margin-bottom:8px}.wrapper .form-message-item .form-message-key.font-size-lg{font-size:14px}.wrapper .form-message-item .form-message-key.font-size-md{font-size:12px}.wrapper .form-message-item .form-message-key.font-size-sm{font-size:10px}.wrapper .form-message-item .form-message-key.font-weight-bold{font-weight:700}.wrapper .form-message-item .form-message-key.font-weight-md{font-weight:600}.wrapper .form-message-item .form-message-key.font-weight-light{font-weight:400}.wrapper .form-message-item>.form-message-field{margin-bottom:16px}.wrapper .form-message-item .form-message-field .form-message-value.font-size-lg{font-size:18px}.wrapper .form-message-item .form-message-field .form-message-value.font-size-md{font-size:16px}.wrapper .form-message-item .form-message-field .form-message-value.font-size-sm{font-size:13.8px}.wrapper .form-message-item .form-message-field .form-message-value.font-weight-bold{font-weight:600}.wrapper .form-message-item .form-message-field .form-message-value.font-weight-md{font-weight:400}.wrapper .form-message-item .form-message-field .form-message-value.font-weight-light{font-weight:300}.wrapper .form-message-item .form-message-field .form-message-value.with-top-margin{margin-top:2px}.wrapper .form-message-item .form-message-field.form-message-field-col-1{flex-basis:100%;max-width:100%}.wrapper .form-message-item .form-message-field.form-message-field-col-2{flex-basis:calc(50% - 12px);max-width:calc(50% - 12px)}.wrapper .form-message-item .form-message-field.form-message-field-col-2.edit-form-message-field:nth-child(even) .listbox{inset-inline:auto 16px}.wrapper .form-message-item .form-message-field.form-message-field-col-2.edit-form-message-field .listbox{min-width:calc(50% - 28px)}.wrapper .form-message-item .form-message-field.edit-form-message-field{display:flex;flex-direction:column;overflow:visible;width:100%}.wrapper .form-message-item .form-message-field.edit-form-message-field.disabled{cursor:not-allowed}.wrapper .form-message-item .form-message-field.edit-form-message-field input.form-message-value,.wrapper .form-message-item .form-message-field.edit-form-message-field select.form-message-value,.wrapper .form-message-item .form-message-field.edit-form-message-field textarea.form-message-value{border-radius:4px;background-color:var(--color-form-input-background);color:var(--color-form-input-text);border:1px solid var(--color-form-input-border);font-size:16px}.wrapper .form-message-item .form-message-field.edit-form-message-field input.form-message-value:focus,.wrapper .form-message-item .form-message-field.edit-form-message-field select.form-message-value:focus,.wrapper .form-message-item .form-message-field.edit-form-message-field textarea.form-message-value:focus{border-color:var(--color-form-input-border-focus);box-shadow:0 0 0 1px var(--color-form-input-border-focus) inset;outline:1px solid rgba(0,0,0,0)}.wrapper .form-message-item .form-message-field.edit-form-message-field input:disabled,.wrapper .form-message-item .form-message-field.edit-form-message-field select:disabled,.wrapper .form-message-item .form-message-field.edit-form-message-field textarea:disabled{opacity:.5;cursor:not-allowed}.wrapper .form-message-item .form-message-field.edit-form-message-field input:disabled~.field-error,.wrapper .form-message-item .form-message-field.edit-form-message-field select:disabled~.field-error,.wrapper .form-message-item .form-message-field.edit-form-message-field textarea:disabled~.field-error{display:none}.wrapper .form-message-item .form-message-field.edit-form-message-field.error>input:not(:disabled,.disabled),.wrapper .form-message-item .form-message-field.edit-form-message-field.error>select:not(:disabled,.disabled),.wrapper .form-message-item .form-message-field.edit-form-message-field.error>textarea:not(:disabled,.disabled),.wrapper .form-message-item .form-message-field.edit-form-message-field.error>.text-field-container:not(:disabled,.disabled){border-color:var(--color-form-error)}.wrapper .form-message-item .form-message-field.edit-form-message-field input.form-message-value{height:42px;padding:0 12px}.wrapper .form-message-item .form-message-field.edit-form-message-field input.form-message-value[type=date]::-webkit-calendar-picker-indicator,.wrapper .form-message-item .form-message-field.edit-form-message-field input.form-message-value[type=time]::-webkit-calendar-picker-indicator,.wrapper .form-message-item .form-message-field.edit-form-message-field input.form-message-value[type=number]::-webkit-inner-spin-button{cursor:pointer;width:20px;height:20px;margin-inline-end:-8px}.wrapper .form-message-item .form-message-field.edit-form-message-field select.form-message-value{cursor:pointer;height:42px;padding-inline:12px 36px;appearance:none}.wrapper .form-message-item .form-message-field.edit-form-message-field .select-icon-wrapper{pointer-events:none;position:relative}.wrapper .form-message-item .form-message-field.edit-form-message-field .select-icon-wrapper .select-icon{position:absolute;bottom:11px;inset-inline-end:9px}.wrapper .form-message-item .form-message-field.edit-form-message-field textarea.form-message-value{overflow:auto;padding:11px 12px;resize:none}.wrapper .form-message-item .form-message-field.edit-form-message-field .form-container{display:flex;max-width:max-content}.wrapper .form-message-item .form-message-field.edit-form-message-field .form-container.disabled{cursor:not-allowed;opacity:.5}.wrapper .form-message-item .form-message-field.edit-form-message-field .form-container.disabled+.field-error{display:none}.wrapper .form-message-item .form-message-field.edit-form-message-field .form-container label{display:flex;min-height:36px;align-items:center;padding:7.5px 0;border-bottom:1px solid rgba(0,0,0,0)}.wrapper .form-message-item .form-message-field.edit-form-message-field .form-container .radio-input{margin-inline-end:8px}.wrapper .form-message-item .form-message-field.edit-form-message-field .text-field-container{background-color:var(--color-form-input-background);border-radius:4px;border:1px solid var(--color-form-input-border);display:flex;min-height:44px;flex-direction:row;cursor:text}.wrapper .form-message-item .form-message-field.edit-form-message-field .text-field-container.disabled{opacity:.5;pointer-events:none}.wrapper .form-message-item .form-message-field.edit-form-message-field .text-field-container.disabled~.field-error{display:none}.wrapper .form-message-item .form-message-field.edit-form-message-field .text-field-container:focus{border-color:var(--color-form-input-border-focus);box-shadow:0 0 0 1px var(--color-form-input-border-focus) inset;outline:1px solid rgba(0,0,0,0)}.wrapper .form-message-item .form-message-field.edit-form-message-field .text-field-container .selected-options{padding:0 12px 5px}.wrapper .form-message-item .form-message-field.edit-form-message-field .text-field-container .selected-options:empty{padding-top:5px}.wrapper .form-message-item .form-message-field.edit-form-message-field .text-field-container .selected-options:empty:before{content:attr(data-placeholder)}.wrapper .form-message-item .form-message-field.edit-form-message-field .text-field-container .selected-options .multi-select-option{float:left;line-height:16px;display:flex;align-items:center;cursor:default;border-radius:4px;border:1px solid var(--color-form-input-border);color:var(--color-form-input-text);background-clip:padding-box;font-size:12px;margin-inline-end:6px;margin-top:5px;padding-inline:6px 4px}.wrapper .form-message-item .form-message-field.edit-form-message-field .text-field-container .selected-options .multi-select-option .opt-close{cursor:pointer;height:16px;width:16px}.wrapper .form-message-item .form-message-field.edit-form-message-field .listbox{border:1px solid var(--color-table-separator);border-radius:4px;display:flex;flex-direction:column;margin-top:3px;inset-inline-start:16px;max-width:calc(100% - 32px);min-width:calc(100% - 32px);z-index:3}.wrapper .form-message-item .form-message-field.edit-form-message-field .listbox.none{display:none}.wrapper .form-message-item .form-message-field.edit-form-message-field .listbox .filter-message-box{display:flex;flex-direction:column;padding:0 12px}.wrapper .form-message-item .form-message-field.edit-form-message-field .listbox .filter-message-box .filter-message-text{color:var(--color-form-label);font-size:13.75px;height:42px;padding:12px 0;border-bottom:1px solid var(--color-table-separator)}.wrapper .form-message-item .form-message-field.edit-form-message-field .listbox .listbox-search{flex-shrink:0;margin:12px;padding-inline-end:36px}.wrapper .form-message-item .form-message-field.edit-form-message-field .listbox .search-icon-wrapper{position:relative;height:0}.wrapper .form-message-item .form-message-field.edit-form-message-field .listbox .search-icon-wrapper .search-icon{position:absolute;inset-inline-end:21px;bottom:23px}.wrapper .form-message-item .form-message-field.edit-form-message-field .listbox .multi-select-list{animation:none;display:block;max-height:400px;margin:1px 0 2px 0;overflow-y:auto;padding:8px 0;z-index:3}.wrapper .form-message-item .form-message-field.edit-form-message-field .listbox .multi-select-list li{height:auto;margin:0;padding:12px}.wrapper .form-message-item .form-message-field.edit-form-message-field .toggle{position:relative;width:36px;height:20px}.wrapper .form-message-item .form-message-field.edit-form-message-field .toggle.disabled+.field-error{display:none}.wrapper .form-message-item .form-message-field.edit-form-message-field .toggle input{display:none}.wrapper .form-message-item .form-message-field.edit-form-message-field .toggle input:disabled+.round-slider{cursor:not-allowed;opacity:.5}.wrapper .form-message-item .form-message-field.edit-form-message-field .toggle input:checked+.round-slider{background-color:#227e9e;border-color:#227e9e}.wrapper .form-message-item .form-message-field.edit-form-message-field .toggle input:checked+.round-slider:before{inset-inline:auto 1px;transition:height .3s cubic-bezier(0, 0, 0.2, 1),width .3s cubic-bezier(0, 0, 0.2, 1),right .3s cubic-bezier(0, 0, 0.2, 1)}.wrapper .form-message-item .form-message-field.edit-form-message-field .toggle .round-slider{position:absolute;cursor:pointer;background-color:#8b8580;transition:background-color .2s linear .1s,opacity .2s linear .1s,border-color .2s linear .1s;border:1px solid rgba(0,0,0,0);border-radius:4px;height:20px;width:36px}.wrapper .form-message-item .form-message-field.edit-form-message-field .toggle .round-slider:before{border-radius:4px;width:16px;height:16px;inset-inline:1px auto;position:absolute;content:"";bottom:1px;background-color:var(--color-form-background);transition:height .3s cubic-bezier(0, 0, 0.2, 1),width .3s cubic-bezier(0, 0, 0.2, 1),left .3s cubic-bezier(0, 0, 0.2, 1)}.wrapper .form-message-item span.field-error{display:flex;margin-top:2px;line-height:16px}.wrapper .form-message-item span.field-error .error-text{color:var(--color-form-error-text);font-size:12px;margin-inline-start:4px}.wrapper .form-message-item span.field-error svg.form-error-icon{position:relative;height:16px;width:16px;fill:var(--color-form-error);flex-shrink:0}.wrapper .form-message-item span.field-error.form-error{padding:8px;background:var(--color-error-message-background);border-radius:4px;margin:10px 0;border:thin dashed var(--color-error-border);width:100%}.wrapper .form-message-item span.field-error.form-error.disabled{display:none}.wrapper .form-message-item span.field-error.form-error svg.form-error-icon{top:0}.wrapper .form-message-item span.field-error.form-error .error-text{font-weight:600;color:var(--color-error-title);margin-inline-start:8px;font-size:14px}.wrapper .form-message-item .form-actions .action-postback,.wrapper .form-message-item .form-message-value .action-postback{background:var(--color-form-actions-background);color:var(--color-form-actions-text);border-color:var(--color-form-actions-border)}.wrapper .form-message-item .form-actions .action-postback:not(:disabled):hover,.wrapper .form-message-item .form-message-value .action-postback:not(:disabled):hover{color:var(--color-form-actions-text-hover);background:var(--color-form-actions-background-hover)}.wrapper .form-message-item .form-actions .action-postback:not(:disabled):hover svg>path,.wrapper .form-message-item .form-message-value .action-postback:not(:disabled):hover svg>path{fill:var(--color-form-actions-text-hover)}.wrapper .form-message-item .form-actions .action-postback:not(:disabled):focus,.wrapper .form-message-item .form-actions .action-postback:not(:disabled):active,.wrapper .form-message-item .form-message-value .action-postback:not(:disabled):focus,.wrapper .form-message-item .form-message-value .action-postback:not(:disabled):active{background:var(--color-form-actions-background-focus);color:var(--color-form-actions-text-focus)}.wrapper .form-message-item .form-actions .action-postback:not(:disabled):focus svg>path,.wrapper .form-message-item .form-actions .action-postback:not(:disabled):active svg>path,.wrapper .form-message-item .form-message-value .action-postback:not(:disabled):focus svg>path,.wrapper .form-message-item .form-message-value .action-postback:not(:disabled):active svg>path{fill:var(--color-form-actions-text-focus)}.wrapper .tableform-message .table-message-row{cursor:pointer}.wrapper .tableform-message .table-message-row:hover{background-color:var(--color-table-row-background-hover)}.wrapper .tableform-message .table-message-row button:hover,.wrapper .tableform-message .table-message-row button:active,.wrapper .tableform-message .table-message-row button:focus{background-color:unset}.wrapper .tableform-message .table-message-headings .table-message-heading:last-child,.wrapper .tableform-message .table-message-row .table-message-item:last-child{min-width:unset;padding:0}.wrapper .tableform-message .table-message-headings .table-message-heading:last-child button,.wrapper .tableform-message .table-message-row .table-message-item:last-child button{margin:0 2px;transition:transform .25s ease-in-out}.wrapper .tableform-message .table-message-headings .table-message-heading:last-child button.rotate-180,.wrapper .tableform-message .table-message-row .table-message-item:last-child button.rotate-180{transform:rotate3d(0, 0, 1, 180deg)}.wrapper .tableform-message .form-message-item{margin:0;padding:16px;transition:all .25s ease-in-out;border-bottom:none}.wrapper .tableform-message .form-message-item.none{display:none}.wrapper .tableform-message .form-message-item:last-child{border-top:1px solid var(--color-table-bottom)}.wrapper .footer{max-width:100%;padding:0;background-color:var(--color-footer-background);z-index:3;box-shadow:0px -1px 4px 0px rgba(0,0,0,.1019607843);border-top:1px solid rgba(22,21,19,.1)}.wrapper .footer .footer-mode-keyboard{min-height:44px;margin:5px;background-color:var(--color-input-background);color:var(--color-input-text);border:1px solid var(--color-input-border);border-radius:6px}.wrapper .footer .footer-mode-voice{height:60px;padding:14px 0;background:var(--color-visualizer-container-background);justify-content:center}.wrapper .footer .footer-mode-voice .footer-visualizer-wrapper{max-width:296px;height:32px}.wrapper .footer.mode-keyboard .button-switch-kbd{display:none}.wrapper .footer.mode-keyboard .footer-mode-voice{display:none}.wrapper .footer.mode-voice .button-switch-voice{display:none}.wrapper .user-input{flex-grow:1;min-height:44px;padding:10px;margin:0;font-size:1em;font-family:inherit;line-height:24px;outline:1px solid rgba(0,0,0,0);resize:none;border:none;border-radius:6px;background-color:rgba(0,0,0,0);color:var(--color-input-text)}.wrapper .footer-actions{padding-inline-end:4px}.wrapper .footer-button.button-send{background-color:var(--color-footer-button-fill);border-radius:50%}.wrapper .footer-button.button-send svg>path{fill:var(--color-input-background)}.wrapper .footer-button.button-send:not(:disabled):hover{background-color:var(--color-footer-button-fill-hover)}.wrapper .footer-button.button-send:not(:disabled):hover svg>path{fill:var(--color-input-background)}.wrapper .footer-button svg>path{fill:var(--color-footer-button-fill)}.wrapper .footer-button:not(:disabled):hover,.wrapper .footer-button:not(:disabled):focus{background-color:var(--color-footer-button-background-hover)}.wrapper .footer-button:not(:disabled):hover svg>path,.wrapper .footer-button:not(:disabled):focus svg>path{fill:var(--color-footer-button-fill-hover)}.wrapper .autocomplete-items{position:absolute;bottom:56px;width:100%;max-height:calc(100% - 56px);overflow-y:auto;background-color:var(--color-input-background);box-shadow:0px -1px 4px 0px rgba(0,0,0,.1019607843);padding:8px 0}.wrapper .autocomplete-items>div{min-height:40px;padding:8px 16px;cursor:pointer}.wrapper .autocomplete-items>div:hover,.wrapper .autocomplete-items>div.autocomplete-active{background-color:var(--color-card-nav-button-hover)}.wrapper .autocomplete-items>div strong{font-weight:700}.wrapper .dialog-wrapper{position:absolute;top:0;left:0;right:0;width:100%;height:100%}.wrapper .dialog-wrapper .prompt-banner-background{position:fixed;background:rgba(0,0,0,.2);height:100%;width:100%;z-index:5}.wrapper .dialog-wrapper .prompt-banner{align-items:center;box-shadow:rgba(0,0,0,.16) 0px 4px 8px 0px;border-radius:6px;display:flex;flex-direction:row;position:absolute;max-width:450px;min-height:48px;max-height:60%;top:30%;left:0;right:0;padding:8px 16px;margin:8px auto;width:calc(100% - 16px);z-index:5;animation:banner-in .2s cubic-bezier(0.22, 0.45, 0.42, 0.92) both;background-color:var(--color-popup-background);flex-direction:column;align-items:flex-start;overflow-y:auto}.wrapper .dialog-wrapper .prompt-banner.prompt-banner-out{animation:banner-out .2s cubic-bezier(0.5, 0.07, 0.68, 0.48) both}.wrapper .dialog-wrapper .prompt-banner .prompt-banner-main-content{margin:16px 0;align-items:flex-start}.wrapper .dialog-wrapper .prompt-banner .prompt-banner-main-content .prompt-banner-icon{margin:4px 16px 0 0}.wrapper .dialog-wrapper .prompt-banner .prompt-banner-main-content .prompt-banner-text{margin:0 28px 0 0;font-size:18px;font-weight:bold;color:var(--color-popup-text)}.wrapper .dialog-wrapper .prompt-banner .prompt-banner-main-content .prompt-banner-description{color:var(--color-popup-text);opacity:.6;font-size:13px;margin:8px 28px 0 0}.wrapper .dialog-wrapper .prompt-banner .prompt-banner-main-content .prompt-banner-label{color:var(--color-popup-text);font-size:large}.wrapper .dialog-wrapper .prompt-banner .prompt-banner-main-content .prompt-banner-input{font-size:medium;min-height:36px;width:100%;margin:0 0 10px 0;padding:10px;color:var(--color-form-input-text);background-color:var(--color-form-actions-background);border:1px solid var(--color-form-input-border);border-radius:4px}.wrapper .dialog-wrapper .prompt-banner .prompt-banner-close-button{position:absolute;border:none;right:16px}.wrapper .dialog-wrapper .prompt-banner .action-wrapper{width:100%;margin:16px 0 6px}.wrapper .dialog-wrapper .prompt-banner .action-wrapper .popup-action{background-color:var(--color-popup-button-background);border-color:var(--color-popup-button-text);color:var(--color-popup-button-text);border-style:solid;margin:0;height:34px;justify-content:center;width:49%}.wrapper .dialog-wrapper .prompt-banner .action-wrapper .popup-action:hover{background-color:var(--color-footer-button-background-hover)}.wrapper .dialog-wrapper .prompt-banner .action-wrapper .popup-action:last-child{margin:0}.wrapper .dialog-wrapper .prompt-banner .action-wrapper .popup-action.filled{background-color:var(--color-popup-button-text);color:var(--color-popup-button-background)}.wrapper .dialog-wrapper .prompt-banner .action-wrapper .popup-action.filled:hover{opacity:.9}.wrapper .dialog-wrapper.end-conversation-prompt .prompt-banner-close-button{display:none}.wrapper.embedded .open{width:100%;height:100%}.wrapper.embedded .open .widget{border-radius:0;width:100%;height:100%;position:inherit;box-shadow:none;max-height:unset}@media(min-width: 1024px){.wrapper.embedded .conversation .conversation-pane .message-bubble{padding:16px 24px}.wrapper.embedded .conversation .conversation-pane .message-bubble .attachment .attachment-placeholder{margin:-16px -24px 0;max-width:calc(100% + 48px)}.wrapper.embedded .conversation .conversation-pane .message-bubble .attachment .attachment-footer{margin:0 -24px -16px}.wrapper.embedded .conversation .conversation-pane.bot-icon .message-block .messages-wrapper,.wrapper.embedded .conversation .conversation-pane.user-icon .message-block .messages-wrapper{max-width:780px}.wrapper.embedded .conversation .conversation-pane.bot-icon .message-block .messages-wrapper .message-header,.wrapper.embedded .conversation .conversation-pane.bot-icon .message-block .messages-wrapper .message-footer,.wrapper.embedded .conversation .conversation-pane.user-icon .message-block .messages-wrapper .message-header,.wrapper.embedded .conversation .conversation-pane.user-icon .message-block .messages-wrapper .message-footer{max-width:780px}.wrapper.embedded .conversation .conversation-pane.bot-icon.bot-icon .message-block .messages-wrapper,.wrapper.embedded .conversation .conversation-pane.user-icon.bot-icon .message-block .messages-wrapper{max-width:780px}.wrapper.embedded .conversation .conversation-pane.bot-icon.bot-icon .message-block .messages-wrapper .message.card-message-horizontal .message-header,.wrapper.embedded .conversation .conversation-pane.bot-icon.bot-icon .message-block .messages-wrapper .message.card-message-horizontal .message-footer,.wrapper.embedded .conversation .conversation-pane.user-icon.bot-icon .message-block .messages-wrapper .message.card-message-horizontal .message-header,.wrapper.embedded .conversation .conversation-pane.user-icon.bot-icon .message-block .messages-wrapper .message.card-message-horizontal .message-footer{max-width:780px}.wrapper.embedded button:not(.icon){height:44px}}@media(min-width: 900px)and (max-width: 1023px){.wrapper.embedded .conversation .conversation-pane .message-bubble{padding:8px 16px}.wrapper.embedded .conversation .conversation-pane .message-bubble .attachment .attachment-placeholder{margin:-8px -16px 0}.wrapper.embedded .conversation .conversation-pane .message-bubble .attachment .attachment-footer{margin:0 -16px -8px}.wrapper.embedded .conversation .conversation-pane.bot-icon .message-block .messages-wrapper,.wrapper.embedded .conversation .conversation-pane.user-icon .message-block .messages-wrapper{max-width:680px}.wrapper.embedded .conversation .conversation-pane.bot-icon .message-block .messages-wrapper .message.card-message-horizontal .message-header,.wrapper.embedded .conversation .conversation-pane.bot-icon .message-block .messages-wrapper .message.card-message-horizontal .message-footer,.wrapper.embedded .conversation .conversation-pane.user-icon .message-block .messages-wrapper .message.card-message-horizontal .message-header,.wrapper.embedded .conversation .conversation-pane.user-icon .message-block .messages-wrapper .message.card-message-horizontal .message-footer{max-width:680px}.wrapper.embedded .conversation .conversation-pane.bot-icon.bot-icon .message-block .messages-wrapper,.wrapper.embedded .conversation .conversation-pane.user-icon.bot-icon .message-block .messages-wrapper{max-width:680px}.wrapper.embedded .conversation .conversation-pane.bot-icon.bot-icon .message-block .messages-wrapper .message.card-message-horizontal .message-bubble,.wrapper.embedded .conversation .conversation-pane.user-icon.bot-icon .message-block .messages-wrapper .message.card-message-horizontal .message-bubble{padding:16px 24px}.wrapper.embedded .conversation .conversation-pane.bot-icon.bot-icon .message-block .messages-wrapper .message.card-message-horizontal .message-header,.wrapper.embedded .conversation .conversation-pane.bot-icon.bot-icon .message-block .messages-wrapper .message.card-message-horizontal .message-footer,.wrapper.embedded .conversation .conversation-pane.user-icon.bot-icon .message-block .messages-wrapper .message.card-message-horizontal .message-header,.wrapper.embedded .conversation .conversation-pane.user-icon.bot-icon .message-block .messages-wrapper .message.card-message-horizontal .message-footer{max-width:680px}.wrapper.embedded button:not(.icon){height:44px}}.wrapper .full-screen-modal{position:fixed;top:0;left:0;width:100%;height:100vh;z-index:1000000;background-color:rgba(0,0,0,.8)}.wrapper .modal-header{background:linear-gradient(180deg, rgba(0, 0, 0, 0.5), transparent);color:#fff;display:flex;justify-content:space-between;position:relative;padding:10px 20px;z-index:1000001}.wrapper .modal-header .close-btn{border:none;background:rgba(0,0,0,0);cursor:pointer}.wrapper .full-screen-image{position:absolute;max-width:100vw;max-height:100vh;margin:auto;top:0;bottom:0;left:0;right:0}.wrapper .typing-cue-wrapper{width:32px;margin:auto}.wrapper .typing-cue-wrapper .typing-cue{position:relative;left:0;right:0;margin:auto;width:8px;height:8px;border-radius:50%;background-color:var(--color-typing-indicator);animation:typing-cue 1550ms infinite linear alternate;animation-delay:250ms;opacity:.1}.wrapper .typing-cue-wrapper .typing-cue::before,.wrapper .typing-cue-wrapper .typing-cue::after{content:"";display:inline-block;position:absolute;width:8px;height:8px;border-radius:50%;background-color:var(--color-typing-indicator);animation:typing-cue 1550ms infinite linear alternate;opacity:.1}.wrapper .typing-cue-wrapper .typing-cue::before{left:-12px;animation-delay:0s}.wrapper .typing-cue-wrapper .typing-cue::after{left:12px;animation-delay:500ms}.wrapper .hidden{border:0;clip:rect(0 0 0 0);height:1px;margin:-1px;overflow:hidden;padding:0;position:absolute;width:1px}.wrapper .rating-root{display:flex}.wrapper [dir=rtl] .rating-root{flex-direction:row-reverse}.wrapper .rating-wrapper{display:flex;margin-top:8px}.wrapper [dir=rtl] .rating-wrapper{flex-direction:row-reverse}.wrapper .rating-hidden{border:0;clip:rect(0 0 0 0);height:1px;margin:-1px;overflow:hidden;padding:0;position:absolute;width:1px}.wrapper .star-label{background-color:rgba(0,0,0,0);border:0;cursor:pointer;padding:0}.wrapper .star-label>svg>path{fill:var(--color-rating-star)}.wrapper .star-input.active+label>svg>path{fill:var(--color-rating-star-fill)}.wrapper .star-input:disabled+.star-label{cursor:not-allowed;filter:brightness(0.8)}.wrapper .rating-star-icon{height:32px;width:32px}.wrapper.expanded .widget{animation:scale-in-br .25s cubic-bezier(0.25, 0.46, 0.45, 0.94) .2s both}.wrapper.expanded:not(.drag) .button{animation:scale-out-center .25s cubic-bezier(0.55, 0.085, 0.68, 0.53) forwards}.wrapper.collapsed .widget{animation:scale-out-br .25s cubic-bezier(0.55, 0.085, 0.68, 0.53) forwards}.wrapper.collapsed .notification-badge{background-color:var(--color-notification-badge-background);color:var(--color-notification-badge-text);right:-5px;top:-5px;align-items:center;border-radius:24px;display:flex;font-size:14px;height:24px;justify-content:center;position:absolute;text-align:center;width:32px}.wrapper.collapsed:not(.drag) .button{animation:scale-in-center .25s cubic-bezier(0.25, 0.46, 0.45, 0.94) .2s both}.wrapper.pos-left .widget{right:unset;left:calc(var(--position-left)*-1);max-width:100vw}.wrapper.pos-left.expanded .widget{animation:scale-in-bl .25s cubic-bezier(0.25, 0.46, 0.45, 0.94) .2s both}.wrapper.pos-left.collapsed .widget{animation:scale-out-bl .25s cubic-bezier(0.55, 0.085, 0.68, 0.53) forwards}.wrapper .ellipsis{display:inline-block;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:100%}.wrapper .popup{position:absolute;background-color:var(--color-popup-background);color:var(--color-popup-text);min-width:140px;max-height:calc(100% - 128px);display:none;padding:4px 0;border-radius:6px;box-shadow:rgba(0,0,0,.16) 0px 4px 8px 0px;overflow-y:auto;z-index:5}.wrapper .popup li{display:flex;align-items:center;height:48px;margin:4px 0;cursor:pointer;overflow:hidden;color:var(--color-popup-button-text)}.wrapper .popup li svg>path{fill:var(--color-popup-text)}.wrapper .popup li#action-menu-option-lang{border-top:1px solid var(--color-popup-horizontal-rule)}.wrapper .popup li.disable{pointer-events:none;cursor:not-allowed;opacity:.5}.wrapper .popup li:hover,.wrapper .popup li:focus,.wrapper .popup li.active{background-color:var(--color-popup-item-background-hover)}.wrapper .popup li .icon{margin-inline-start:16px;height:20px;width:20px}.wrapper .popup li .text{padding:0 16px 0 16px}.wrapper .popup.expand{display:block;-webkit-animation:scale-in-br .25s cubic-bezier(0.25, 0.46, 0.45, 0.94) .2s both;animation:scale-in-br .25s cubic-bezier(0.25, 0.46, 0.45, 0.94) .2s both}.wrapper .popup.action-menu,.wrapper .popup.language-selection-menu{top:50px;bottom:unset}.wrapper .popup.action-menu.expand,.wrapper .popup.language-selection-menu.expand{display:block;-webkit-animation:scale-in-tr .25s cubic-bezier(0.25, 0.46, 0.45, 0.94) .2s both;animation:scale-in-tr .25s cubic-bezier(0.25, 0.46, 0.45, 0.94) .2s both}.wrapper .popup.language-selection-menu{max-height:calc(100% - 280px)}.wrapper .popup.share-popup-list{bottom:50px;left:unset}.wrapper .spinner{height:48px;width:48px}.wrapper .spinner svg{animation-duration:750ms;-webkit-animation:spin 1s linear infinite;animation:spin 1s linear infinite}.wrapper .spinner svg circle{fill:rgba(0,0,0,0);stroke:var(--color-user-text);stroke-width:2px;stroke-dasharray:128px;stroke-dashoffset:82px}.wrapper .webview-container{position:absolute;width:100%;height:80%;bottom:0;box-shadow:0px -4px 32px rgba(0,0,0,.1);z-index:10}.wrapper .webview-container .webview-header svg{fill:var(--color-actions-text)}.wrapper .webview-container .webview-header button{color:var(--color-actions-text)}.wrapper .webview-container .spinner{position:absolute;margin:auto;left:0;right:0;top:40%}.wrapper .webview-container iframe{width:100%;height:100%;background:var(--color-conversation-background);border:none}.wrapper .webview-container .webview-error{position:absolute;bottom:0;background:var(--color-popup-background);width:calc(100% - 32px);margin:10px 16px;padding:6px 16px;border-radius:6px;display:flex;align-items:center;box-shadow:0px -4px 32px rgba(0,0,0,.1)}.wrapper .webview-container .webview-error .webview-error-button-close{border:none}.wrapper .webview-container.webview-container-close{animation:oda-chat-webview-slide-out-bottom .4s cubic-bezier(0.55, 0.085, 0.68, 0.53) both}.wrapper .webview-container.webview-container-open{animation:oda-chat-webview-slide-in-bottom .4s cubic-bezier(0.25, 0.46, 0.45, 0.94) both}.button-drag-handle{position:absolute;width:100%;height:100%}.image-preview-wrapper{background:rgba(0,0,0,.8);height:100%;position:fixed;top:0;left:0;width:100%;z-index:10000}.image-preview-wrapper .image-preview-header{align-items:center;background:linear-gradient(180deg, rgba(0, 0, 0, 0.5), transparent);color:#fff;display:flex;justify-content:space-between;position:relative;padding:10px 20px;z-index:1000001}.image-preview-wrapper .image-preview-header .image-preview-close{background:rgba(0,0,0,0);border:none;cursor:pointer;height:36px;width:36px}.image-preview-wrapper .image-preview-header .image-preview-close .image-preview-close-icon{fill:#fff;height:100%;width:100%}.image-preview-wrapper .image-preview{bottom:0;left:0;margin:auto;max-height:100vh;max-width:100vw;position:absolute;right:0;top:0}.arrow-icon{margin-inline-end:2px;width:32px;height:32px;display:flex;align-items:center;flex-shrink:0}@media screen and (min-width: 426px){.wrapper .widget{width:var(--width-full-screen);max-height:calc(100vh - 60px);bottom:0;right:0}.wrapper .messages-wrapper .message-list .message.card-message-horizontal{width:var(--width-full-screen)}.wrapper.pos-left .widget{left:0}.wrapper:not(.embedded) .widget{max-width:calc(100vw - var(--position-right))}.wrapper:not(.embedded).pos-left .widget{max-width:calc(100vw - var(--position-left))}}@media(prefers-reduced-motion){.open{animation:none}.close{animation:none}}[dir=rtl] *:not(.card-message-horizontal .message-wrapper *){direction:rtl}[dir=rtl] .card-message-horizontal .message-wrapper .card{direction:rtl}[dir=rtl] .card-message-horizontal .message-wrapper .card *{direction:rtl}[dir=rtl] .multi-select-option{float:right !important}[dir=rtl] .wrapper{text-align:right}[dir=rtl] .wrapper .widget.open{animation:scale-in-bl .25s cubic-bezier(0.25, 0.46, 0.45, 0.94) .2s both}[dir=rtl] .wrapper .widget.close{animation:scale-out-bl .25s cubic-bezier(0.55, 0.085, 0.68, 0.53) forwards}[dir=rtl] .wrapper .message-bubble{border-radius:10px 2px 2px 10px}[dir=rtl] .wrapper .message-block .message:last-child .message-bubble:last-child{border-radius:10px 2px 10px 10px}[dir=rtl] .wrapper .message-block.right .messages-wrapper .message .message-bubble{border-radius:2px 10px 10px 2px}[dir=rtl] .wrapper .message-block.right .messages-wrapper .message:last-child .message-bubble:last-child{border-radius:2px 10px 10px 10px}[dir=rtl] .wrapper .button{left:0;right:unset}[dir=rtl] .wrapper .popup.expand{-webkit-animation:scale-in-bl .25s cubic-bezier(0.25, 0.46, 0.45, 0.94) .2s both;animation:scale-in-bl .25s cubic-bezier(0.25, 0.46, 0.45, 0.94) .2s both}[dir=rtl] .wrapper .popup.action-menu.expand,[dir=rtl] .wrapper .popup.language-selection-menu.expand{-webkit-animation:scale-in-tl .25s cubic-bezier(0.25, 0.46, 0.45, 0.94) .2s both;animation:scale-in-tl .25s cubic-bezier(0.25, 0.46, 0.45, 0.94) .2s both}'},350:function(e,t,s){s.r(t),s.d(t,{AuthError:function(){return n},AuthTokenService:function(){return l},Deferred:function(){return b},JWT:function(){return r},KeyCode:function(){return i},ShareCategory:function(){return o},buildURL:function(){return K},checkDeviceType:function(){return X},deepFreeze:function(){return B},drawVisualizer:function(){return q},formatDate:function(){return U},generateEventDispatcher:function(){return a},getLongPollURL:function(){return J},getValues:function(){return z},getWebSocketURL:function(){return Y},isAndroid:function(){return D},isApple:function(){return O},isFunction:function(){return P},isMobile:function(){return R},isObject:function(){return L},isSameDay:function(){return Z},pipe:function(){return ee},removeDisplayNoneAndDecode:function(){return H},resetRegex:function(){return j},setObjectReadOnly:function(){return F},startTimer:function(){return _},stripHTTP:function(){return Q},supportedLang:function(){return M},updateCSSVar:function(){return V}});const i={Return:"Enter",Esc:"Escape",Space:"Space",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Tab:"Tab",PageDown:"PageDown",PageUp:"PageUp",Home:"Home",End:"End",Backspace:"Backspace"},o={Audio:"audio",File:"file",Location:"location",Visual:"visual"};function a(){let e={};return{bind:(t,s)=>{t&&s&&P(s)&&(Object.prototype.hasOwnProperty.call(e,t)?e[t].push(s):e[t]=[s])},trigger:(t,...s)=>{if(Object.prototype.hasOwnProperty.call(e,t)){const i=null!=s?s:[];e[t].forEach((e=>{try{e.call(null,...i)}catch(e){console.error(`${t} listener error`,e)}}))}},unbind:(t,s)=>{t?s||!Object.prototype.hasOwnProperty.call(e,t)?e[t]&&(e[t]=e[t].filter((e=>e!==s))):e[t].splice(0,e[t].length):e={}}}}const n={AuthExpiredToken:"AuthExpiredToken",AuthNoToken:"AuthNoToken",AuthNoChannelId:"AuthNochannelId",AuthNoUserId:"AuthNouserId",AuthNoExp:"AuthNoexp",AuthNoIat:"AuthNoiat",AuthInvalidChannelId:"AuthInvalidchannelId",AuthInvalidUserId:"AuthInvaliduserId",AuthInvalidExp:"AuthInvalidexp",AuthInvalidIat:"AuthInvalidiat",AuthEmptyChannelIdClaim:"AuthInvalidchannelId",AuthEmptyUserIdClaim:"AuthInvaliduserId",AuthNegativeExp:"AuthNegativeexp",AuthNegativeIat:"AuthNegativeiat",AuthExpLessThanIat:"AuthExpLessThanIat"};class r{constructor(e){this.token=e;const t=this.token.split(".");this.payload=JSON.parse(atob(t[1]))}getClaim(e){return this.payload[e]}}const c=Promise;class l{static getInstance(){return this.service||(this.service=new l),this.service}get(){return this.jws&&g(this.jws)?c.resolve(this.jws):new c(((e,t)=>{c.resolve(this.fetch()).then((s=>{this.jws=new r(s);try{if(function(e){e||m(n.AuthNoToken);const t="iat",s=e.getClaim(t);u(t,h,s);const i=e.getClaim(p);u(p,h,i),i<=s&&m(n.AuthExpLessThanIat);const o="channelId",a=e.getClaim(o);u(o,d,a);const r="userId",c=e.getClaim(r);u(r,d,c)}(this.jws),g(this.jws))return void e(this.jws);m(n.AuthExpiredToken)}catch(e){t(e)}}))}))}reset(){this.jws=void 0}setFetch(e){if(!P(e))throw new Error("'generateAuthToken' is not a function. Create a function that returns a Promise that resolves to a new JWT when called.");this.fetch=e,this.reset()}}const d="string",h="number",p="exp";function g(e){const t=Math.floor((Date.now()+2e4)/1e3);return e.getClaim(p)>t}function u(e,t,s){null==s&&m(`AuthNo${e}`),typeof s!==t&&m(`AuthInvalid${e}`),"number"==typeof s?s<=0&&m(`AuthNegative${e}`):s.length||m(`AuthEmpty${e}`)}function m(e){throw Error(e)}class b{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t})),Object.freeze(this)}}const f=window.setInterval,v=window.setTimeout,w=36e5,x=864e5;let y;const C=()=>{clearTimeout(y),clearInterval(y)},S=(e,t,s,i,o,a)=>{var n;let r=1;C(),e((null===(n=t[o])||void 0===n?void 0:n.replace("{0}",`${r}`))||""),y=f((()=>{var i;r++,s&&a&&r>=s?a(e,t):e((null===(i=t[o])||void 0===i?void 0:i.replace("{0}",`${r}`))||"")}),i)},k=(e,t)=>{S(e,t,60,6e4,"relTimeMin",T)},T=(e,t)=>{S(e,t,24,w,"relTimeHr",A)},A=(e,t)=>{S(e,t,30,x,"relTimeDay",I)},I=(e,t)=>{S(e,t,12,2592e6,"relTimeMon",E)},E=(e,t)=>{S(e,t,0,31536e6,"relTimeYr")},_=(e,t)=>{C(),e(t.relTimeNow||""),y=v((()=>{((e,t)=>{C(),e(t.relTimeMoment||""),y=v((()=>{k(e,t)}),5e4)})(e,t)}),1e4)},M={ar:"العربية",de:"Deutsch",en:"English",es:"Español",fr:"Français",it:"Italiano",nl:"Nederlands",bt:"Português",hi:"हिंदी"},L=e=>"object"==typeof e&&null!==e,P=e=>e instanceof Function,D=()=>/Android/i.test(navigator.userAgent),O=()=>/iPhone|iPad/i.test(navigator.userAgent),R=()=>D()||O();function B(e){const t=Object.keys(e);for(const s of t){const t=e[s];t&&"object"==typeof t&&B(t)}return Object.freeze(e)}function z(e){const t=[];if("object"==typeof e&&null!==e)for(const s of Object.keys(e))t.push(e[s]);return t}function F(e){const t=Object.getOwnPropertyNames(e);for(const s of t)Object.defineProperty(e,s,{configurable:!0,writable:!1});return e}function V(e,t,s){return e.replace(new RegExp(`(${s}: )(.*?)(;|})`,"g"),`$1${t}$3`)}const N=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],$=["January","February","March","April","May","June","July","August","September","October","November","December"];function U(e,{pattern:t,locale:s}){let i;i="string"==typeof e?new Date(e):e;const o=`${i.toLocaleDateString(s,{weekday:"short",month:"short",day:"numeric"}).replace(/,/g,"")}, ${i.toLocaleTimeString(s,{hour:"numeric",minute:"numeric",hour12:!0})}`;if("string"==typeof t)try{const e=i.getDate(),s=i.getDay(),o=N[s],a=i.getMonth()+1,n=$[a-1],r=`${i.getFullYear()}`,c=i.getHours(),l=i.getMinutes(),d=i.getSeconds(),h=i.getMilliseconds(),p=c>=12?"PM":"AM",g=function(e){let t=-e.getTimezoneOffset();const s=t<0;return t=Math.abs(t),`${s?"-":"+"}${`0${Math.floor(t/60)}:`.slice(-3)+("0"+t%60).slice(-2)}`}(i),u=c%12||12,m={DD:`0${e}`.slice(-2),Do:`${e}${G(e)}`,D:`${e}`,dddd:o,ddd:o.substring(0,3),d:`${s}`,MMMM:n,MMM:n.substring(0,3),MM:`0${a}`.slice(-2),M:`${a}`,YYYY:r,YY:r.slice(-2),HH:`0${c}`.slice(-2),H:`${c}`,hh:`0${u}`.slice(-2),h:`${u}`,mm:`0${l}`.slice(-2),m:`${l}`,ss:`0${d}`.slice(-2),s:`${d}`,SSS:`${h}`,SS:""+h%100,S:""+h%1e3,A:p,a:p.toLowerCase(),ZZ:g.replace(":",""),Z:g};return t.replace(/DD|Do|D|dddd|ddd|d|MMMM|MMM|MM|M|YYYY|YY|HH|H|hh|h|mm|m|ss|s|SSS|SS|S|A|a|ZZ|Z/g,(e=>m[e]))}catch(e){return o}return L(t)?i.toLocaleString(s,t):o}function H(e){const t=document.createElement("div");t.style.display="none",document.body.appendChild(t),t.innerHTML=e,W(t);const s=document.createElement("textarea");s.innerHTML=t.innerHTML;const i=s.value;return t.remove(),s.remove(),i}function j(e){return e.lastIndex=0,e}function W(e){for(let t=e.childElementCount-1;t>=0;t--){const s=e.children[t],i=window.getComputedStyle(s);"none"===i.display||"hidden"===i.visibility?s.remove():W(s)}}function G(e){switch(e){case 11:case 12:case 13:return"th";default:switch(e%10){case 1:return"st";case 2:return"nd";case 3:return"rd";default:return"th"}}}function q(e,t,s="#000"){const i=t.height,o=t.width,a=Math.floor(i/2);let n=function(e,t){const s=Math.ceil(t/2),i=e.length/s,o=[],a=[];for(let t=0;t<e.length;t+=i){const s=e.slice(t,t+i).map((e=>e*e)).reduce(((e,t)=>e+t),0)/i;o.push(s),a.unshift(s)}return o.splice(0,1),a.concat(o)}(e,31);n=function(e,t){return e.map((e=>e*t))}(n,i/255);const r=t.getContext("2d");if(r){r.fillStyle=s,r.clearRect(0,0,o,i),r.save();let e=0;n.forEach((t=>{const s=Math.ceil(t/2)+1;r.fillRect(e,a-s,2,2*s),e+=8})),r.save()}}function K(e,t,s,i){return function(e,t){const s=Object.keys(t).map((e=>`${e}=${t[e]}`));if(s.length)return`${e}?${s.join("&")}`;return e}(`${e}${t}${i}`,s)}function Y(e,t,s=!0,i="websdk"){return K(`ws${s?"s":""}://`,e,t,`/chat/v1/chats/sockets/${i}`)}function J(e,t,s=!0){return K(`http${s?"s":""}://`,e,t,"/chat/v1/chats/message")}const Z=(e,t)=>{const s=new Date(e),i=new Date(t);return s.getDate()===i.getDate()&&s.getMonth()===i.getMonth()&&s.getFullYear()===i.getFullYear()},X=()=>{const e=navigator.userAgent;return/android/i.test(e)?"android":/iPad|iPhone|iPod/.test(e)&&!window.MSStream?"ios":"desktop"},Q=e=>e.replace(/^https?:\/\//i,""),ee=(e,...t)=>t.reduce(((e,t)=>t(e)),e)},473:function(e,t,s){Object.defineProperty(t,"__esModule",{value:!0}),t.defaultSettings=void 0;var i=s(756),o=s(249),a="Please try sharing it again, or else type it in.";t.defaultSettings={badgePosition:{right:"-5px",top:"-5px"},clientAuthEnabled:!1,conversationBeginPosition:"bottom",disablePastActions:"all",displayActionsAsPills:!1,embedded:!1,embeddedVideo:!0,enableAgentSneakPreview:!1,enableAttachment:!0,enableAttachmentSecurity:!1,enableHeaderActionCollapse:!0,enableAutocomplete:!1,enableAutocompleteClientCache:!1,enableBotAudioResponse:!1,enableDefaultClientResponse:!1,enableClearMessage:!1,enableEndConversation:!0,enableHeadless:!1,enableLocalConversationHistory:!1,enableLongPolling:!1,enableSendTypingStatus:!1,enableSecureConnection:!0,enableSpeech:!1,enableSpeechAutoSend:!0,enableTabsSync:!0,enableTimestamp:!0,focusOnNewMessage:"input",height:"620px",i18n:{en:{agent:"Agent",agentMessage:"{0} says",attachment_audio:"Audio attachment",attachment_file:"File attachment",attachment_image:"Image attachment",attachment_video:"Video attachment",attachmentAudioFallback:"Your browser does not support embedded audio. However you can {0}download it{/0}.",attachmentVideoFallback:"Your browser does not support embedded video. However you can {0}download it{/0}.",audioResponseOff:"Turn audio response on",audioResponseOn:"Turn audio response off",avatarAgent:"Agent icon",avatarBot:"Bot icon",avatarUser:"User icon",card:"Card {0}",cardImagePlaceholder:"Card image",cardNavNext:"Next card",cardNavPrevious:"Previous card",chatTitle:"Chat",clear:"Clear conversation",close:"Close widget",closing:"Closing",connected:"Connected",connecting:"Connecting",connectionFailureMessage:"Sorry, the assistant is unavailable right now. If the issue persists, contact your help desk.",connectionRetryLabel:"Try Again",defaultGreetingMessage:"Hey, Nice to meet you! Allow me a moment to get back to you.",defaultWaitMessage:"I'm still working on your request. Thank you for your patience!",defaultSorryMessage:"I'm sorry. I can't get you the right content. Please try again.",disconnected:"Disconnected",download:"Download",editFieldErrorMessage:"Field input is invalid",editFormErrorMessage:"Some of the fields need your attention",endConversation:"End Conversation",endConversationConfirmMessage:"Are you sure you want to end the conversation?",endConversationDescription:"This will also clear your conversation history.",errorSpeechInvalidUrl:"ODA URL for connection is not set. Please pass 'URI' parameter during SDK initialization.",errorSpeechMultipleConnection:"Another voice recognition is ongoing. Can't start a new one.",errorSpeechTooMuchTimeout:"The voice message is too long to recognize and generate text.",errorSpeechUnavailable:"To allow voice messaging, update your browser settings to enable access to your microphone.",errorSpeechUnsupportedLocale:"The locale set for voice recognition is not supported. Please use a valid locale in 'speechLocale' setting.",inputPlaceholder:"Type a message",imageViewerClose:"Close image viewer",imageViewerOpen:"Open image viewer",itemIterator:"Item {0}",language_ar:"Arabic",language_de:"German",language_detect:"Detect Language",language_en:"English",language_hi:"Hindi",language_es:"Spanish",language_fr:"French",language_it:"Italian",language_nl:"Dutch",language_pt:"Portuguese",languageSelectDropdown:"Select chat language",linkField:"Click on the highlighted text to open Link for {0}",noResultText:"No more results",noSpeechTimeout:"The voice could not be detected to perform recognition.",noText:"No",openMap:"Open Map",previousChats:"End of previous conversation",ratingStar:"Rate {0} star",recognitionTextPlaceholder:"Speak your message",relTimeDay:"{0}d ago",relTimeHr:"{0}hr ago",relTimeMin:"{0}min ago",relTimeMoment:"A few seconds ago",relTimeMon:"{0}mth ago",relTimeNow:"Now",relTimeYr:"{0}yr ago",requestLocation:"Requesting location",requestLocationDeniedPermission:"To allow sharing your location, update your browser settings to enable access to your location. You can also type in the location instead.",requestLocationDeniedTimeout:"It is taking too long to get your location. ".concat(a),requestLocationDeniedUnavailable:"Your current location is unavailable. ".concat(a),retryMessage:"Try again",send:"Send message",shareAudio:"Share Audio",shareFailureMessage:"Sorry, sharing is not available on this device.",shareFile:"Share File",shareLocation:"Share Location",shareVisual:"Share Image/Video",skillMessage:"Skill says",showOptions:"Show Options",speak:"Speak a message",typingIndicator:"Waiting for response",upload:"Share popup",uploadFailed:"Upload Failed.",uploadFileSizeLimitExceeded:"File size should not be more than {0}MB.",uploadFileSizeZeroByte:"Files of size zero bytes can't be uploaded.",uploadUnsupportedFileType:"Unsupported file type.",userMessage:"I say",utteranceGeneric:"Message from skill.",webViewAccessibilityTitle:"In-widget WebView to display links",webViewClose:"Done",webViewErrorInfoDismiss:"Dismiss",webViewErrorInfoText:"Don’t see the page? {0}Click here{/0} to open it in a browser.",yesText:"Yes"}},initBotAudioMuted:!0,initMessageOptions:{sendAt:"expand"},isDebugMode:!1,locale:"en",messageCacheSizeLimit:2e3,name:"oda-chat",openChatOnLoad:!1,openLinksInNewWindow:!1,readMark:"✓",reconnectInterval:5,reconnectMaxAttempts:5,shareMenuItems:[o.ShareCategory.AUDIO,o.ShareCategory.FILE,o.ShareCategory.LOCATION,o.ShareCategory.VISUAL],showConnectionStatus:!1,showPrevConvStatus:!0,showTypingIndicator:!0,speechLocale:i.RecognitionLocale.EN_US,theme:o.WidgetTheme.DEFAULT,timestampMode:"default",defaultGreetingTimeout:5,defaultWaitMessageInterval:5,typingIndicatorTimeout:30,typingStatusInterval:3,typingDelay:0,upgradeToWebSocketInterval:300,webViewConfig:{},width:"375px",actionsLayout:"vertical",globalActionsLayout:"vertical",cardActionsLayout:"vertical",formActionsLayout:"vertical"}},424:function(e,t,s){var i=this&&this.__assign||function(){return i=Object.assign||function(e){for(var t,s=1,i=arguments.length;s<i;s++)for(var o in t=arguments[s])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},i.apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var o=s(756),a=s(249),n=s(350),r=s(49),c=s(473),l={avatarAgent:"agentAvatar",avatarBot:"botIcon",avatarUser:"personIcon",fileAudio:"audioIcon",fileImage:"imageIcon",fileGeneric:"fileIcon",fileVideo:"videoIcon",clearHistory:"clearMessageIcon",close:void 0,collapse:"closeIcon",download:"downloadIcon",error:"errorIcon",expandImage:"expandImageIcon",keyboard:"keyboardIcon",logo:"logoIcon",launch:"botButtonIcon",mic:"micIcon",rating:void 0,send:"sendIcon",shareMenu:"attachmentIcon",shareMenuAudio:void 0,shareMenuFile:void 0,shareMenuLocation:void 0,shareMenuVisual:void 0,ttsOff:"audioResponseOffIcon",ttsOn:"audioResponseOnIcon",typingIndicator:"chatBubbleIcon"};function d(e){for(var t={},s=0,i=Object.keys(e);s<i.length;s++){var o=i[s];t[o.toLowerCase()]=e[o]}return t}function h(e,t){var s=i(i({},e),t);if(t.i18n&&Object.keys(t.i18n).length){e.i18n=d(e.i18n),t.i18n=d(t.i18n);var o=new Set;Object.keys(e.i18n).forEach((function(e){o.add(e)})),Object.keys(t.i18n).forEach((function(e){o.add(e)})),s.i18n={},o.forEach((function(o){s.i18n[o]=i(i(i({},e.i18n.en),e.i18n[o]),t.i18n[o])}))}if(s.colors=i(i({},e.colors),t.colors),s.userId=t.userId||"user".concat(Math.floor(1e4+9e4*Math.random())).concat(Date.now()%1e5),s.icons=function(e){var t=e.icons||{};for(var s in l){var i=s,o=l[i];o in e&&(t[i]=e[o])}return t}(s),s.locale=(0,a.configureLocale)(s.locale,s.i18n),t.typingStatusInterval&&t.typingStatusInterval<e.typingStatusInterval&&(s.typingStatusInterval=e.typingStatusInterval),!s.position){var n="rtl"===window.getComputedStyle(document.body).direction;s.position=n?{left:"20px",bottom:"20px"}:{right:"20px",bottom:"20px"}}return s}function p(e,t){var s,i,l,d=this,m=h(c.defaultSettings,e),b=(0,n.generateEventDispatcher)(),f=!1,v=m.name,w=new a.DOMUtil(m);a.Logger.logLevel=m.isDebugMode?a.Logger.LOG_LEVEL.DEBUG:a.Logger.LOG_LEVEL.ERROR,a.Logger.appName=m.name,a.Logger.appVersion=a.SDK_VERSION;var x=new a.Logger("main"),y=new o.WebCore({URI:m.URI,channelId:m.channelId,userId:m.userId,isTLS:m.enableSecureConnection,channel:m.channel,enableAttachment:m.enableAttachment,enableAttachmentSecurity:m.enableAttachmentSecurity,isLongPoll:m.enableLongPolling,isTTS:m.enableBotAudioResponse,TTSService:m.ttsService,tokenGenerator:m.clientAuthEnabled?t:null,recognitionLocale:m.speechLocale,retryInterval:m.reconnectInterval,retryMaxAttempts:m.reconnectMaxAttempts});if(m.skillVoices&&(!m.ttsVoice||Array.isArray(m.ttsVoice)&&!m.ttsVoice.length)&&(m.ttsVoice=m.skillVoices),m.enableBotAudioResponse)try{m.ttsVoice&&y.setTTSVoice(m.ttsVoice)}catch(e){x.error("Failed to initialize TTS")}var C=(0,n.getValues)(o.RecognitionLocale),S=function(e){for(var t=[],s=1;s<arguments.length;s++)t[s-1]=arguments[s];1===t.length?x.error("Parameter ".concat(t," was not passed for ").concat(e," call. No action processed.")):x.error("Parameters ".concat(t.join(", ")," were not passed for ").concat(e," call. No action processed."))},k=function(e){b.trigger(a.ChatEvent.MESSAGE_SENT,e),b.trigger(a.ChatEvent.MESSAGE,e)},T=function(e){b.trigger(a.ChatEvent.MESSAGE_RECEIVED,e),b.trigger(a.ChatEvent.MESSAGE,e)},A=function(e){b.trigger(a.ChatEvent.NETWORK,e)},I=function(e){var t=l.innerText;t=(0,n.updateCSSVar)(t,e.top||"unset","--position-top"),t=(0,n.updateCSSVar)(t,e.left||"unset","--position-left"),t=(0,n.updateCSSVar)(t,e.right||"unset","--position-right"),t=(0,n.updateCSSVar)(t,e.bottom||"unset","--position-bottom"),l.innerText=t},E=function(e){if((s=new a.WidgetComponent(m,w,d.connect.bind(d),d.openChat.bind(d),d.closeChat.bind(d),M.bind(d),T.bind(d),k.bind(d),d.getUnreadMessagesCount.bind(d),A.bind(d),y,b)).styleSheet=l,s.render(),e)try{var t=document.getElementById(m.targetElement);s.embedInElement(m.targetElement),s.updateFullScreenWidth("".concat(t.clientWidth,"px")),window.addEventListener("resize",(0,a.debounce)((function(){s.updateFullScreenWidth("".concat(t.clientWidth,"px"))}),500))}catch(e){x.error("Target Element not specified",e)}else s.appendToElement(document.body),setTimeout((function(){s.orientWidgetAnimation()}),0),s.updateWidgetMaxHeight(),window.addEventListener("resize",(0,a.debounce)((function(){s.orientWidgetAnimation(),s.updateWidgetMaxHeight()}),500));var i=m.width,o=m.height;e||(i&&d.setWidth(i),o&&d.setHeight(o)),m.openChatOnLoad&&setTimeout((function(){d.openChat()}),0)},_=function(){b.trigger(a.ChatEvent.READY),_=function(){}};this.connect=function(e){var t,i=void 0===e?{}:e,o=i.URI,a=i.channelId,n=i.userId;return o||a||n?(!function(e,t,s){"string"==typeof e&&e.length&&(m.URI=e),"string"==typeof t&&t.length&&(m.channelId=t),"string"==typeof s&&s.length&&(m.userId=s)}(o,a,n),t=y.connect({URI:o,channelId:a,userId:n})):t=y.connect(),t.then((function(){x.debug("Connection ready")}),(function(){x.debug("Connection timeout"),s.showConnectionError()})).finally((function(){_()})),t},this.disconnect=function(){return m.enableSpeech&&d.stopVoiceRecording(),m.enableBotAudioResponse&&d.cancelTTS(),y.disconnect()},this.isConnected=function(){return y.isConnected()},this.openChat=function(){s.isOpen||(s.showChat(),f&&(d.connect(),f=!1)),b.trigger(a.ChatEvent.WIDGET_OPENED)},this.closeChat=function(){s.isOpen&&s.onClose(),b.trigger(a.ChatEvent.WIDGET_CLOSED)},this.endChat=function(){d.isConnected()&&s.sendExitEvent()};var M=function(){s.isOpen&&d.closeChat(),d.disconnect(),d.clearConversationHistory(),f=!0,b.trigger(a.ChatEvent.CHAT_END)};this.isChatOpened=function(){return s.isOpen},this.destroy=function(){if(d.disconnect(),d.closeChat(),s.remove(),document){l&&l.remove()}for(var e in b.trigger(a.ChatEvent.DESTROY),d.off(),d)d[e]&&delete d[e]},this.on=function(e,t){switch(e){case o.SpeechSynthesisServiceEvent.TTSStart:case o.SpeechSynthesisServiceEvent.TTSStop:y.on(e,t);break;default:b.bind(e,t)}},this.off=function(e,t){switch(e){case o.SpeechSynthesisServiceEvent.TTSStart:case o.SpeechSynthesisServiceEvent.TTSStop:y.off(e,t);break;default:b.unbind(e,t)}},this.sendAttachment=function(e){return e?s.uploadFile(e):(S("sendAttachment","file"),Promise.reject(new Error("Invalid Parameter")))},this.sendMessage=function(e,t){return e?s.sendMessage(e,t):(S("sendMessage","message"),Promise.reject(new Error("Invalid Parameter")))},this.sendUserTypingStatus=function(e,t){return e?y.sendUserTypingStatus(e,t):(S("sendUserTypingStatus","status"),Promise.reject(new Error("Invalid Parameter")))},this.updateUser=function(e){return e?y.updateUser(e,{sdkMetadata:{version:a.SDK_VERSION}}).then((function(e){return k(e)})):(S("updateUser","userDetails"),Promise.reject(new Error("Invalid Parameter")))},this.setUserAvatar=function(e){e?s.setUserAvatar(e):S("setUserAvatar","userAvatar")},this.setAgentDetails=function(e){e?s.setAgentDetails(e):S("setAgentDetails","agentDetails")},this.getAgentDetails=function(){return s.getAgentDetails()},this.setSkillVoices=function(e){if(!y.getTTSService())return u();var t=[];return e&&!Array.isArray(e)&&"string"==typeof(null==e?void 0:e.lang)?t=[e]:Array.isArray(e)&&(t=e),d.setTTSVoice(t)},this.setTTSService=function(e){var t=y.getTTSService();t&&t.cancel(),"string"==typeof e?y.setTTSService(e):y.setTTSService(function(e){return e&&(0,n.isFunction)(e.speak)&&(0,n.isFunction)(e.cancel)&&(0,n.isFunction)(e.getVoice)&&(0,n.isFunction)(e.getVoices)&&(0,n.isFunction)(e.setVoice)}(e)?e:null);var i=y.getTTSService();m.ttsService=i,s&&s.refreshTTS(),i&&(m.enableBotAudioResponse=!0,(0,a.isAnyVoiceAvailable)(i,m.ttsVoice).then((function(e){e||(m.ttsVoice=[]);var t=(0,a.syncTTSLocaleIfUnavailable)({hasRecognition:m.enableSpeech,hasSynthesis:m.enableBotAudioResponse,recognitionLocale:m.speechLocale,synthesisLocales:m.ttsVoice});t&&i.setVoice(t).catch((function(e){x.error(e)})),m.ttsVoice=t})))},this.getTTSVoices=function(){return y.getTTSVoices()},this.setTTSVoice=function(e){var t=y.getTTSService();return t?(0,a.isAnyVoiceAvailable)(t,m.ttsVoice).then((function(t){return m.ttsVoice=(0,a.syncTTSLocaleIfUnavailable)({hasRecognition:m.enableSpeech,hasSynthesis:m.enableBotAudioResponse,isReset:t,recognitionLocale:m.speechLocale,synthesisLocales:e}),y.setTTSVoice(e).catch((function(){return u()}))})):u()},this.getTTSVoice=function(){try{return y.getTTSVoice()}catch(e){throw Error(g)}},this.speakTTS=function(e){y.speakTTS(e,m.i18n[m.locale])},this.cancelTTS=function(){y.cancelTTS()},this.setPrimaryChatLanguage=function(e){if(null!==e&&"string"!=typeof e)throw Error("Please pass a language string or null as argument");d.isConnected()?s.setPrimaryChatLanguage(e):x.error("Not connected. Can not call setPrimaryChatLanguage.")},this.setDelegate=function(e){m.delegate=e},this.getConversationHistory=function(){var e=s.getMessages();return{messages:e,messagesCount:e.length,unreadCount:d.getUnreadMessagesCount(),userId:m.userId}},this.clearConversationHistory=function(e,t){void 0===t&&(t=!0),e&&"string"!=typeof e?x.error("Argument passed in clearConversationHistory() is not of type string. Returning without execution."):(e&&0!==e.length||(e=m.userId),t&&e===m.userId?s.clearConversationHistory():s.clearMessages(e,a.StorageType.LOCAL))},this.clearAllConversationsHistory=function(e){void 0===e&&(e=!0),s.clearAllMessage(),e&&s.clearConversationHistory()},this.getSuggestions=function(e){return m.enableAutocomplete?e?"string"!=typeof e&&"number"!=typeof e?Promise.reject("Invalid query parameter type passed for the getSuggestions call."):s.getSuggestions(e):Promise.reject("No query parameter passed for the getSuggestions call."):Promise.reject("Autocomplete suggestions not enabled.")},this.startVoiceRecording=function(e,t,s){return m.enableSpeech?e?t?y.startRecognition({onRecognitionText:function(t){e(t.message)},onAnalyserReady:null==s?void 0:s.onAnalyserReady,onVisualData:null==s?void 0:s.onAnalyserFrequencies,onSpeechNetworkChange:t}):Promise.reject(new Error("Second callback parameter, onSpeechNetworkChange not provided. Can not start recording")):Promise.reject(new Error("First callback parameter, onSpeechRecognition not provided. Can not start recording.")):Promise.reject(new Error("Speech-to-text feature is not enabled. Initialize the widget with enableSpeech: true to use the service."))},this.stopVoiceRecording=function(){if(!m.enableSpeech)throw new Error("Speech-to-text feature is not enabled. Speech recognition service is not running.");return y.stopRecognition()},this.setSpeechLocale=function(e){if(!m.enableSpeech)return!1;e=e.toLowerCase();var t=C.indexOf(e)>=0;if(m.speechLocale=e,y.setRecognitionLocale(e),s.setVoiceRecognitionService(t),t&&m.enableBotAudioResponse){var i=(0,a.syncTTSLocaleIfUnavailable)({hasRecognition:m.enableSpeech,hasSynthesis:m.enableBotAudioResponse,recognitionLocale:m.speechLocale,synthesisLocales:m.ttsVoice});i!==m.ttsVoice&&(m.ttsVoice=i,i.length&&y.setTTSVoice(i))}return t},this.getUnreadMessagesCount=function(){if(m.enableHeadless)return 0;var e=s.getUnreadMsgsCount();return e!==i&&(i=e,b.trigger(a.ChatEvent.UNREAD,e)),e},this.setAllMessagesAsRead=function(){m.enableHeadless||(d.getUnreadMessagesCount(),s.updateNotificationBadge(0))},this.showTypingIndicator=function(){if(!m.showTypingIndicator)throw new Error("Typing indicator is configured not to be shown.");if(m.enableHeadless)throw new Error("Typing indicator cannot be shown in headless mode.");d.isConnected()&&s.showTypingIndicator()},this.setWebViewConfig=function(e){if(m.enableHeadless)throw new Error("WebView cannot be configured in headless mode.");s.refreshWebView(e)},this.setUserInputMessage=function(e){if(m.enableHeadless)throw new Error("User input cannot be set in headless mode.");s.setUserInputMessage(e)},this.setUserInputPlaceholder=function(e){if(m.enableHeadless)throw new Error("Placeholder cannot be set in headless mode.");e?s.setUserInputPlaceholder(e):S("setUserInputPlaceholder","placeholder text")},this.setHeight=function(e){e?null==s||s.setHeight(e):S("setHeight","height")},this.setWidth=function(e){e?null==s||s.setWidth(e):S("setWidth","width")},this.setSize=function(e,t){e||t?null==s||s.setSize(e,t):S("setSize","width","height")},this.setMessagePadding=function(e){e?null==s||s.setMessagePadding(e):S("setMessagePadding","padding")},this.setChatBubbleIconHeight=function(e){e?null==s||s.setChatBubbleIconHeight(e):S("setChatBubbleIconHeight","height")},this.setChatBubbleIconWidth=function(e){e?null==s||s.setChatBubbleIconWidth(e):S("setChatBubbleIconWidth","width")},this.setChatBubbleIconSize=function(e,t){e||!t?null==s||s.setChatBubbleIconSize(e,t):S("setChatBubbleIconSize","width","height")};var L=".wrapper";this.setFont=function(e){if(e){var t="".concat(L,"{font:").concat(e,"}");(0,a.appendStyle)(t,l,v),m.font=e}else S("setFont","font")},this.setFontFamily=function(e){if(e){var t="".concat(L,"{font-family:").concat(e,"}");(0,a.appendStyle)(t,l,v),m.fontFamily=e}else S("setFontFamily","fontFamily")},this.setFontSize=function(e){if(e){var t="".concat(L,"{font-size:").concat(e,"}");(0,a.appendStyle)(t,l,v)}else S("setFontSize","fontSize")},this.setTextColor=function(e){if(e){var t=l.innerText;t=(0,n.updateCSSVar)(t,e,"--color-bot-text"),t=(0,n.updateCSSVar)(t,e,"--color-user-text"),l.innerText=t}else S("setTextColor","color")},this.setTextColorLight=function(e){if(e){var t=l.innerText;t=(0,n.updateCSSVar)(t,e,"--color-text-light"),l.innerText=t,m.colors.textLight=e}else S("setTextColorLight","color")},function(){if(x.debug("onLoad","load chat widget"),"undefined"!=typeof window){var e=!1,t=document.head.children;(l=document.createElement("style")).appendChild(document.createTextNode((0,a.configureColorCustomization)(m.colors,r.redwoodStyles.replace(/(\.)([a-zA-Z_-]+)(?=[^}]+{)/gi,"$1".concat(v,"-$2"))))),I(m.position);for(var s=0;s<t.length;s++){var i=t.item(s);if("style"===i.nodeName.toLowerCase()){document.head.insertBefore(l,i),e=!0;break}}e||document.head.appendChild(l),m.font&&d.setFont(m.font),m.fontFamily&&d.setFontFamily(m.fontFamily),m.fontSize&&d.setFontSize(m.fontSize)}E(m.embedded)}(),(0,n.setObjectReadOnly)(this);var P=window;P&&"function"==typeof P.define&&P.define.amd&&(P.WebSDK=p)}t.default=p;var g="Text-to-speech is not available.";function u(){return e=g,Promise.reject(Error(e));var e}p.EVENT=a.ChatEvent,p.SPEECH_LOCALE=o.RecognitionLocale,p.THEME=a.WidgetTheme,p.TTS=o.CoreTTS,p.Version=a.SDK_VERSION,(0,n.deepFreeze)(p)}},t={};function s(i){var o=t[i];if(void 0!==o)return o.exports;var a=t[i]={exports:{}};return e[i].call(a.exports,a,a.exports,s),a.exports}s.d=function(e,t){for(var i in t)s.o(t,i)&&!s.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var i=s(424);return i=i.default}()}));